"use strict";

exports.__esModule = true;
exports["default"] = exports.dateRender = void 0;

var _react = _interopRequireDefault(require("react"));

var _moment = _interopRequireDefault(require("moment"));

var _reactIntl = require("react-intl");

var _reactDatetime = require("@opuscapita/react-datetime");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

var dateRender = function dateRender(dateProps) {
  return _react["default"].createElement(_reactDatetime.DateInput, dateProps);
};

exports.dateRender = dateRender;

var dateIsValid = function dateIsValid(val) {
  return (0, _moment["default"])(val).isValid();
};

var dateIsValidFormat = function dateIsValidFormat(val, dateFormat) {
  return (0, _moment["default"])(val, dateFormat, true).isValid();
};

var className = 'oc-data-grid-date';
var _default = {
  // dateValueRender
  valRender: function valRender(rowIndex, dateFormat, valueRender) {
    return valueRender(rowIndex, function (v) {
      if (dateIsValidFormat(v, dateFormat)) {
        return _moment["default"].utc(v, dateFormat).format(dateFormat);
      }

      if (dateIsValid(v)) {
        return _moment["default"].utc(v).format(dateFormat);
      }

      return _react["default"].createElement(_reactIntl.FormattedMessage, {
        id: "Grid.InvalidDate"
      });
    });
  },
  // dateCellEdit
  cellEdit: function cellEdit(col, column, rowIndex, tabIndex, gridId, region, dateFormat, valueParser, functions, getComponentDisabledState) {
    var cellName = 'edit';

    var dateProps = _extends({
      className: className,
      dateFormat: dateFormat,
      locale: region,
      value: functions.getItemValue(rowIndex, col),
      onChange: functions.onCellValueChange(rowIndex, col, valueParser),
      inputRef: functions.handleCellRef(rowIndex, col),
      inputProps: {
        tabIndex: tabIndex,
        id: "ocDatagridEditInput-" + gridId + "-" + column.columnKey + "-" + rowIndex,
        onKeyDown: functions.onCellKeyDown(rowIndex, col),
        onBlur: functions.onCellBlur(rowIndex, col),
        onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
        style: column.style
      },
      disabled: getComponentDisabledState(rowIndex, col, cellName)
    }, col.editComponentProps);

    return dateRender(_extends({}, dateProps));
  },
  // dateCellCreate
  cellCreate: function cellCreate(col, column, rowIndex, tabIndex, gridId, region, dateFormat, valueParser, functions, getComponentDisabledState) {
    var cellName = 'create';

    var dateProps = _extends({
      className: className,
      dateFormat: dateFormat,
      locale: region,
      value: functions.getItemValue(rowIndex, col),
      onChange: functions.onCellValueChange(rowIndex, col, valueParser),
      inputRef: functions.handleCellRef(rowIndex, col),
      inputProps: {
        tabIndex: tabIndex,
        id: "ocDatagridCreateInput-" + gridId + "-" + column.columnKey + "-" + rowIndex,
        onKeyDown: functions.onCellKeyDown(rowIndex, col),
        onBlur: functions.onCellBlur(rowIndex, col),
        onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
        style: column.style
      },
      disabled: getComponentDisabledState(rowIndex, col, cellName)
    }, col.createComponentProps);

    return dateRender(_extends({}, dateProps));
  },
  // dateFilterCell
  cellFilter: function cellFilter(col, column, tabIndex, gridId, region, dateFormat, valueParser, functions) {
    var dateProps = _extends({
      className: className,
      dateFormat: dateFormat,
      value: functions.getItemValue(col),
      onChange: functions.onCellValueChange(col, valueParser),
      locale: region,
      inputProps: {
        tabIndex: tabIndex,
        id: "ocDatagridFilterInput-" + gridId + "-" + column.columnKey,
        style: column.style
      }
    }, col.filterComponentProps);

    return dateRender(_extends({}, dateProps));
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9jb2x1bW4tc2VydmljZS9jb2x1bW4tdHlwZXMvZGF0ZS1yZW5kZXJlcnMuanN4Il0sIm5hbWVzIjpbImRhdGVSZW5kZXIiLCJkYXRlUHJvcHMiLCJkYXRlSXNWYWxpZCIsInZhbCIsImlzVmFsaWQiLCJkYXRlSXNWYWxpZEZvcm1hdCIsImRhdGVGb3JtYXQiLCJjbGFzc05hbWUiLCJ2YWxSZW5kZXIiLCJyb3dJbmRleCIsInZhbHVlUmVuZGVyIiwidiIsIm1vbWVudCIsInV0YyIsImZvcm1hdCIsImNlbGxFZGl0IiwiY29sIiwiY29sdW1uIiwidGFiSW5kZXgiLCJncmlkSWQiLCJyZWdpb24iLCJ2YWx1ZVBhcnNlciIsImZ1bmN0aW9ucyIsImdldENvbXBvbmVudERpc2FibGVkU3RhdGUiLCJjZWxsTmFtZSIsImxvY2FsZSIsInZhbHVlIiwiZ2V0SXRlbVZhbHVlIiwib25DaGFuZ2UiLCJvbkNlbGxWYWx1ZUNoYW5nZSIsImlucHV0UmVmIiwiaGFuZGxlQ2VsbFJlZiIsImlucHV0UHJvcHMiLCJpZCIsImNvbHVtbktleSIsIm9uS2V5RG93biIsIm9uQ2VsbEtleURvd24iLCJvbkJsdXIiLCJvbkNlbGxCbHVyIiwib25Gb2N1cyIsIm9uQ2VsbEZvY3VzIiwiY29tcG9uZW50VHlwZSIsInN0eWxlIiwiZGlzYWJsZWQiLCJlZGl0Q29tcG9uZW50UHJvcHMiLCJjZWxsQ3JlYXRlIiwiY3JlYXRlQ29tcG9uZW50UHJvcHMiLCJjZWxsRmlsdGVyIiwiZmlsdGVyQ29tcG9uZW50UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVPLElBQU1BLFVBQVUsR0FBRyxTQUFiQSxVQUFhLENBQUFDLFNBQVM7QUFBQSxTQUFJLGdDQUFDLHdCQUFELEVBQWVBLFNBQWYsQ0FBSjtBQUFBLENBQTVCOzs7O0FBRVAsSUFBTUMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQUMsR0FB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Q0FBQ3lCO0FBTkosT0FQQztBQWViQyxNQUFBQSxRQUFRLEVBQUVwQix5QkFBeUIsQ0FBQ2QsUUFBRCxFQUFXTyxHQUFYLEVBQWdCUSxRQUFoQjtBQWZ0QixPQWdCVlIsR0FBRyxDQUFDOEIsb0JBaEJNLENBQWY7O0FBa0JBLFdBQU85QyxVQUFVLGNBQU1DLFNBQU4sRUFBakI7QUFDRCxHQWhGWTtBQWlGYjtBQUNBOEMsRUFBQUEsVUFsRmEsc0JBa0ZGL0IsR0FsRkUsRUFrRkdDLE1BbEZILEVBa0ZXQyxRQWxGWCxFQWtGcUJDLE1BbEZyQixFQWtGNkJDLE1BbEY3QixFQWtGcUNkLFVBbEZyQyxFQWtGaURlLFdBbEZqRCxFQWtGOERDLFNBbEY5RCxFQWtGeUU7QUFDcEYsUUFBTXJCLFNBQVM7QUFDYk0sTUFBQUEsU0FBUyxFQUFUQSxTQURhO0FBRWJELE1BQUFBLFVBQVUsRUFBVkEsVUFGYTtBQUdib0IsTUFBQUEsS0FBSyxFQUFFSixTQUFTLENBQUNLLFlBQVYsQ0FBdUJYLEdBQXZCLENBSE07QUFJYlksTUFBQUEsUUFBUSxFQUFFTixTQUFTLENBQUNPLGlCQUFWLENBQTRCYixHQUE1QixFQUFpQ0ssV0FBakMsQ0FKRztBQUtiSSxNQUFBQSxNQUFNLEVBQUVMLE1BTEs7QUFNYlksTUFBQUEsVUFBVSxFQUFFO0FBQ1ZkLFFBQUFBLFFBQVEsRUFBUkEsUUFEVTtBQUVWZSxRQUFBQSxFQUFFLDZCQUEyQmQsTUFBM0IsU0FBcUNGLE1BQU0sQ0FBQ2lCLFNBRnBDO0FBR1ZRLFFBQUFBLEtBQUssRUFBRXpCLE1BQU0sQ0FBQ3lCO0FBSEo7QUFOQyxPQVdWMUIsR0FBRyxDQUFDZ0Msb0JBWE0sQ0FBZjs7QUFhQSxXQUFPaEQsVUFBVSxjQUFNQyxTQUFOLEVBQWpCO0FBQ0Q7QUFqR1ksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBGb3JtYXR0ZWRNZXNzYWdlIGFzIE0gfSBmcm9tICdyZWFjdC1pbnRsJztcbmltcG9ydCB7IERhdGVJbnB1dCB9IGZyb20gJ0BvcHVzY2FwaXRhL3JlYWN0LWRhdGV0aW1lJztcblxuZXhwb3J0IGNvbnN0IGRhdGVSZW5kZXIgPSBkYXRlUHJvcHMgPT4gPERhdGVJbnB1dCB7Li4uZGF0ZVByb3BzfSAvPjtcblxuY29uc3QgZGF0ZUlzVmFsaWQgPSB2YWwgPT4gbW9tZW50KHZhbCkuaXNWYWxpZCgpO1xuXG5jb25zdCBkYXRlSXNWYWxpZEZvcm1hdCA9ICh2YWwsIGRhdGVGb3JtYXQpID0+IG1vbWVudCh2YWwsIGRhdGVGb3JtYXQsIHRydWUpLmlzVmFsaWQoKTtcblxuY29uc3QgY2xhc3NOYW1lID0gJ29jLWRhdGEtZ3JpZC1kYXRlJztcblxuZXhwb3J0IGRlZmF1bHQge1xuICAvLyBkYXRlVmFsdWVSZW5kZXJcbiAgdmFsUmVuZGVyKHJvd0luZGV4LCBkYXRlRm9ybWF0LCB2YWx1ZVJlbmRlcikge1xuICAgIHJldHVybiB2YWx1ZVJlbmRlcihyb3dJbmRleCwgKHYpID0+IHtcbiAgICAgIGlmIChkYXRlSXNWYWxpZEZvcm1hdCh2LCBkYXRlRm9ybWF0KSkge1xuICAgICAgICByZXR1cm4gbW9tZW50LnV0Yyh2LCBkYXRlRm9ybWF0KS5mb3JtYXQoZGF0ZUZvcm1hdCk7XG4gICAgICB9XG4gICAgICBpZiAoZGF0ZUlzVmFsaWQodikpIHtcbiAgICAgICAgcmV0dXJuIG1vbWVudC51dGModikuZm9ybWF0KGRhdGVGb3JtYXQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIDxNIGlkPVwiR3JpZC5JbnZhbGlkRGF0ZVwiIC8+O1xuICAgIH0pO1xuICB9LFxuICAvLyBkYXRlQ2VsbEVkaXRcbiAgY2VsbEVkaXQoXG4gICAgY29sLFxuICAgIGNvbHVtbixcbiAgICByb3dJbmRleCxcbiAgICB0YWJJbmRleCxcbiAgICBncmlkSWQsXG4gICAgcmVnaW9uLFxuICAgIGRhdGVGb3JtYXQsXG4gICAgdmFsdWVQYXJzZXIsXG4gICAgZnVuY3Rpb25zLFxuICAgIGdldENvbXBvbmVudERpc2FibGVkU3RhdGUsXG4gICkge1xuICAgIGNvbnN0IGNlbGxOYW1lID0gJ2VkaXQnO1xuICAgIGNvbnN0IGRhdGVQcm9wcyA9IHtcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGRhdGVGb3JtYXQsXG4gICAgICBsb2NhbGU6IHJlZ2lvbixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbnMuZ2V0SXRlbVZhbHVlKHJvd0luZGV4LCBjb2wpLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9ucy5vbkNlbGxWYWx1ZUNoYW5nZShyb3dJbmRleCwgY29sLCB2YWx1ZVBhcnNlciksXG4gICAgICBpbnB1dFJlZjogZnVuY3Rpb25zLmhhbmRsZUNlbGxSZWYocm93SW5kZXgsIGNvbCksXG4gICAgICBpbnB1dFByb3BzOiB7XG4gICAgICAgIHRhYkluZGV4LFxuICAgICAgICBpZDogYG9jRGF0YWdyaWRFZGl0SW5wdXQtJHtncmlkSWR9LSR7Y29sdW1uLmNvbHVtbktleX0tJHtyb3dJbmRleH1gLFxuICAgICAgICBvbktleURvd246IGZ1bmN0aW9ucy5vbkNlbGxLZXlEb3duKHJvd0luZGV4LCBjb2wpLFxuICAgICAgICBvbkJsdXI6IGZ1bmN0aW9ucy5vbkNlbGxCbHVyKHJvd0luZGV4LCBjb2wpLFxuICAgICAgICBvbkZvY3VzOiBmdW5jdGlvbnMub25DZWxsRm9jdXMoY2VsbE5hbWUsIGNvbC5jb21wb25lbnRUeXBlLCByb3dJbmRleCwgY29sdW1uLmNvbHVtbktleSksXG4gICAgICAgIHN0eWxlOiBjb2x1bW4uc3R5bGUsXG4gICAgICB9LFxuICAgICAgZGlzYWJsZWQ6IGdldENvbXBvbmVudERpc2FibGVkU3RhdGUocm93SW5kZXgsIGNvbCwgY2VsbE5hbWUpLFxuICAgICAgLi4uY29sLmVkaXRDb21wb25lbnRQcm9wcyxcbiAgICB9O1xuICAgIHJldHVybiBkYXRlUmVuZGVyKHsgLi4uZGF0ZVByb3BzIH0pO1xuICB9LFxuICAvLyBkYXRlQ2VsbENyZWF0ZVxuICBjZWxsQ3JlYXRlKFxuICAgIGNvbCxcbiAgICBjb2x1bW4sXG4gICAgcm93SW5kZXgsXG4gICAgdGFiSW5kZXgsXG4gICAgZ3JpZElkLFxuICAgIHJlZ2lvbixcbiAgICBkYXRlRm9ybWF0LFxuICAgIHZhbHVlUGFyc2VyLFxuICAgIGZ1bmN0aW9ucyxcbiAgICBnZXRDb21wb25lbnREaXNhYmxlZFN0YXRlLFxuICApIHtcbiAgICBjb25zdCBjZWxsTmFtZSA9ICdjcmVhdGUnO1xuICAgIGNvbnN0IGRhdGVQcm9wcyA9IHtcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGRhdGVGb3JtYXQsXG4gICAgICBsb2NhbGU6IHJlZ2lvbixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbnMuZ2V0SXRlbVZhbHVlKHJvd0luZGV4LCBjb2wpLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9ucy5vbkNlbGxWYWx1ZUNoYW5nZShyb3dJbmRleCwgY29sLCB2YWx1ZVBhcnNlciksXG4gICAgICBpbnB1dFJlZjogZnVuY3Rpb25zLmhhbmRsZUNlbGxSZWYocm93SW5kZXgsIGNvbCksXG4gICAgICBpbnB1dFByb3BzOiB7XG4gICAgICAgIHRhYkluZGV4LFxuICAgICAgICBpZDogYG9jRGF0YWdyaWRDcmVhdGVJbnB1dC0ke2dyaWRJZH0tJHtjb2x1bW4uY29sdW1uS2V5fS0ke3Jvd0luZGV4fWAsXG4gICAgICAgIG9uS2V5RG93bjogZnVuY3Rpb25zLm9uQ2VsbEtleURvd24ocm93SW5kZXgsIGNvbCksXG4gICAgICAgIG9uQmx1cjogZnVuY3Rpb25zLm9uQ2VsbEJsdXIocm93SW5kZXgsIGNvbCksXG4gICAgICAgIG9uRm9jdXM6IGZ1bmN0aW9ucy5vbkNlbGxGb2N1cyhjZWxsTmFtZSwgY29sLmNvbXBvbmVudFR5cGUsIHJvd0luZGV4LCBjb2x1bW4uY29sdW1uS2V5KSxcbiAgICAgICAgc3R5bGU6IGNvbHVtbi5zdHlsZSxcbiAgICAgIH0sXG4gICAgICBkaXNhYmxlZDogZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZShyb3dJbmRleCwgY29sLCBjZWxsTmFtZSksXG4gICAgICAuLi5jb2wuY3JlYXRlQ29tcG9uZW50UHJvcHMsXG4gICAgfTtcbiAgICByZXR1cm4gZGF0ZVJlbmRlcih7IC4uLmRhdGVQcm9wcyB9KTtcbiAgfSxcbiAgLy8gZGF0ZUZpbHRlckNlbGxcbiAgY2VsbEZpbHRlcihjb2wsIGNvbHVtbiwgdGFiSW5kZXgsIGdyaWRJZCwgcmVnaW9uLCBkYXRlRm9ybWF0LCB2YWx1ZVBhcnNlciwgZnVuY3Rpb25zKSB7XG4gICAgY29uc3QgZGF0ZVByb3BzID0ge1xuICAgICAgY2xhc3NOYW1lLFxuICAgICAgZGF0ZUZvcm1hdCxcbiAgICAgIHZhbHVlOiBmdW5jdGlvbnMuZ2V0SXRlbVZhbHVlKGNvbCksXG4gICAgICBvbkNoYW5nZTogZnVuY3Rpb25zLm9uQ2VsbFZhbHVlQ2hhbmdlKGNvbCwgdmFsdWVQYXJzZXIpLFxuICAgICAgbG9jYWxlOiByZWdpb24sXG4gICAgICBpbnB1dFByb3BzOiB7XG4gICAgICAgIHRhYkluZGV4LFxuICAgICAgICBpZDogYG9jRGF0YWdyaWRGaWx0ZXJJbnB1dC0ke2dyaWRJZH0tJHtjb2x1bW4uY29sdW1uS2V5fWAsXG4gICAgICAgIHN0eWxlOiBjb2x1bW4uc3R5bGUsXG4gICAgICB9LFxuICAgICAgLi4uY29sLmZpbHRlckNvbXBvbmVudFByb3BzLFxuICAgIH07XG4gICAgcmV0dXJuIGRhdGVSZW5kZXIoeyAuLi5kYXRlUHJvcHMgfSk7XG4gIH0sXG59O1xuIl19