'use strict';

exports.__esModule = true;
exports.creatableSelectRender = exports.selectRender = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactFloatingSelect = require('@opuscapita/react-floating-select');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var selectRender = exports.selectRender = function selectRender(selectProps) {
  return _react2.default.createElement(_reactFloatingSelect.FloatingSelectPortal, selectProps);
};

var creatableSelectRender = exports.creatableSelectRender = function creatableSelectRender(selectProps) {
  return _react2.default.createElement(_reactFloatingSelect.FloatingSelectPortalCreatable, selectProps);
};

exports.default = {
  cellEdit: function cellEdit(col, column, rowIndex, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions, getComponentDisabledState) {
    var cellName = 'edit';
    var opts = col.editSelectOptionsMod && selectOptions ? col.editSelectOptionsMod(selectOptions.slice(), rowIndex, col) : selectOptions;
    var fsProps = _extends({
      name: 'ocDatagridEditInput-' + gridId + '-' + column.columnKey + '-' + rowIndex,
      options: opts,
      value: functions.getItemValue(rowIndex, col, { selectOptions: selectOptions }),
      onChange: functions.onCellValueChange(rowIndex, col, editValueParser),
      onBlur: functions.onCellBlur(rowIndex, col),
      onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
      onKeyDown: functions.onCellKeyDown(rowIndex, col),
      isSearchable: selectOptions && selectOptions.length > 9,
      isClearable: !col.isRequired,
      backSpaceRemovesValue: false,
      tabSelectsValue: false,
      openMenuOnFocus: false,
      ref: functions.handleCellRef(rowIndex, col),
      isDisabled: getComponentDisabledState(rowIndex, col, cellName),
      tabIndex: tabIndex
    }, col.editComponentProps, selectTranslations);

    if (col.isCreatableSelect) return creatableSelectRender(_extends({}, fsProps));
    return selectRender(_extends({}, fsProps));
  },
  cellCreate: function cellCreate(col, column, rowIndex, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions, getComponentDisabledState) {
    var cellName = 'create';
    var opts = col.createSelectOptionsMod && selectOptions ? col.createSelectOptionsMod(selectOptions.slice(), rowIndex, col) : selectOptions;
    var fsProps = _extends({
      name: 'ocDatagridCreateInput-' + gridId + '-' + column.columnKey + '-' + rowIndex,
      options: opts,
      value: functions.getItemValue(rowIndex, col, { selectOptions: selectOptions }),
      onChange: functions.onCellValueChange(rowIndex, col, editValueParser),
      onBlur: functions.onCellBlur(rowIndex, col),
      onKeyDown: functions.onCellKeyDown(rowIndex, col),
      onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
      isSearchable: selectOptions && selectOptions.length > 9,
      isClearable: !col.isRequired,
      backspaceRemovesValue: false,
      tabSelectsValue: false,
      openMenuOnFocus: false,
      ref: functions.handleCellRef(rowIndex, col),
      isDisabled: getComponentDisabledState(rowIndex, col, cellName),
      tabIndex: tabIndex
    }, col.createComponentProps, selectTranslations);

    if (col.isCreatableSelect) return creatableSelectRender(_extends({}, fsProps));
    return selectRender(_extends({}, fsProps));
  },
  cellFilter: function cellFilter(col, column, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions) {
    var opts = col.filterSelectOptionsMod && selectOptions ? col.filterSelectOptionsMod(selectOptions.slice(), col) : selectOptions;
    var fsProps = _extends({
      name: 'ocDatagridFilterInput-' + gridId + '-' + column.columnKey,
      options: opts,
      value: functions.getItemValue(col, { selectOptions: selectOptions }),
      onChange: functions.onCellValueChange(col, editValueParser),
      isSearchable: selectOptions && selectOptions.length > 9,
      isClearable: true,
      tabSelectsValue: false,
      tabIndex: tabIndex
    }, col.filterComponentProps, selectTranslations);

    return selectRender(_extends({}, fsProps));
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9jb2x1bW4tc2VydmljZS9jb2x1bW4tdHlwZXMvc2VsZWN0LXJlbmRlcmVycy5qc3giXSwibmFtZXMiOlsic2VsZWN0UmVuZGVyIiwic2VsZWN0UHJvcHMiLCJjcmVhdGFibGVTZWxlY3RSZW5kZXIiLCJjZWxsRWRpdCIsImNvbCIsImNvbHVtbiIsInJvd0luZGV4IiwidGFiSW5kZXgiLCJncmlkSWQiLCJzZWxlY3RPcHRpb25zIiwic2VsZWN0VHJhbnNsYXRpb25zIiwiZWRpdFZhbHVlUGFyc2VyIiwiZnVuY3Rpb25zIiwiZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZSIsImNlbGxOYW1lIiwib3B0cyIsImVkaXRTZWxlY3RPcHRpb25zTW9kIiwic2xpY2UiLCJmc1Byb3BzIiwibmFtZSIsImNvbHVtbktleSIsIm9wdGlvbnMiLCJ2YWx1ZSIsImdldEl0ZW1WYWx1ZSIsIm9uQ2hhbmdlIiwib25DZWxsVmFsdWVDaGFuZ2UiLCJvbkJsdXIiLCJvbkNlbGxCbHVyIiwib25Gb2N1cyIsIm9uQ2VsbEZvY3VzIiwiY29tcG9uZW50VHlwZSIsIm9uS2V5RG93biIsIm9uQ2VsbEtleURvd24iLCJpc1NlYXJjaGFibGUiLCJsZW5ndGgiLCJpc0NsZWFyYWJsZSIsImlzUmVxdWlyZWQiLCJiYWNrU3BhY2VSZW1vdmVzVmFsdWUiLCJ0YWJTZWxlY3RzVmFsdWUiLCJvcGVuTWVudU9uRm9jdXMiLCJyZWYiLCJoYW5kbGVDZWxsUmVmIiwiaXNEaXNhYmxlZCIsImVkaXRDb21wb25lbnRQcm9wcyIsImlzQ3JlYXRhYmxlU2VsZWN0IiwiY2VsbENyZWF0ZSIsImNyZWF0ZVNlbGVjdE9wdGlvbnNNb2QiLCJiYWNrc3BhY2VSZW1vdmVzVmFsdWUiLCJjcmVhdGVDb21wb25lbnRQcm9wcyIsImNlbGxGaWx0ZXIiLCJmaWx0ZXJTZWxlY3RPcHRpb25zTW9kIiwiZmlsdGVyQ29tcG9uZW50UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7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WEssYUFGRjtBQUdBLFFBQU1TO0FBQ0pDLHVDQUErQlgsTUFBL0IsU0FBeUNILE9BQU9lLFNBRDVDO0FBRUpDLGVBQVNOLElBRkw7QUFHSk8sYUFBT1YsVUFBVVcsWUFBVixDQUF1Qm5CLEdBQXZCLEVBQTRCLEVBQUVLLDRCQUFGLEVBQTVCLENBSEg7QUFJSmUsZ0JBQVVaLFVBQVVhLGlCQUFWLENBQTRCckIsR0FBNUIsRUFBaUNPLGVBQWpDLENBSk47QUFLSnNCLG9CQUFjeEIsaUJBQWtCQSxjQUFjeUIsTUFBZCxHQUF1QixDQUxuRDtBQU1KQyxtQkFBYSxJQU5UO0FBT0pHLHVCQUFpQixLQVBiO0FBUUovQjtBQVJJLE9BU0RILElBQUkrQyxvQkFUSCxFQVVEekMsa0JBVkMsQ0FBTjs7QUFhQSxXQUFPViwwQkFBa0JrQixPQUFsQixFQUFQO0FBQ0Q7QUE1R1ksQyIsImZpbGUiOiJzZWxlY3QtcmVuZGVyZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEZsb2F0aW5nU2VsZWN0UG9ydGFsLFxuICBGbG9hdGluZ1NlbGVjdFBvcnRhbENyZWF0YWJsZSxcbn0gZnJvbSAnQG9wdXNjYXBpdGEvcmVhY3QtZmxvYXRpbmctc2VsZWN0JztcblxuZXhwb3J0IGNvbnN0IHNlbGVjdFJlbmRlciA9IHNlbGVjdFByb3BzID0+IChcbiAgPEZsb2F0aW5nU2VsZWN0UG9ydGFsIHsuLi5zZWxlY3RQcm9wc30gLz5cbik7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGFibGVTZWxlY3RSZW5kZXIgPSBzZWxlY3RQcm9wcyA9PiAoXG4gIDxGbG9hdGluZ1NlbGVjdFBvcnRhbENyZWF0YWJsZSB7Li4uc2VsZWN0UHJvcHN9IC8+XG4pO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGNlbGxFZGl0KFxuICAgIGNvbCxcbiAgICBjb2x1bW4sXG4gICAgcm93SW5kZXgsXG4gICAgdGFiSW5kZXgsXG4gICAgZ3JpZElkLFxuICAgIHNlbGVjdE9wdGlvbnMsXG4gICAgc2VsZWN0VHJhbnNsYXRpb25zLFxuICAgIGVkaXRWYWx1ZVBhcnNlcixcbiAgICBmdW5jdGlvbnMsXG4gICAgZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZSxcbiAgKSB7XG4gICAgY29uc3QgY2VsbE5hbWUgPSAnZWRpdCc7XG4gICAgY29uc3Qgb3B0cyA9IGNvbC5lZGl0U2VsZWN0T3B0aW9uc01vZCAmJiBzZWxlY3RPcHRpb25zID9cbiAgICAgIGNvbC5lZGl0U2VsZWN0T3B0aW9uc01vZChzZWxlY3RPcHRpb25zLnNsaWNlKCksIHJvd0luZGV4LCBjb2wpIDpcbiAgICAgIHNlbGVjdE9wdGlvbnM7XG4gICAgY29uc3QgZnNQcm9wcyA9IHtcbiAgICAgIG5hbWU6IGBvY0RhdGFncmlkRWRpdElucHV0LSR7Z3JpZElkfS0ke2NvbHVtbi5jb2x1bW5LZXl9LSR7cm93SW5kZXh9YCxcbiAgICAgIG9wdGlvbnM6IG9wdHMsXG4gICAgICB2YWx1ZTogZnVuY3Rpb25zLmdldEl0ZW1WYWx1ZShyb3dJbmRleCwgY29sLCB7IHNlbGVjdE9wdGlvbnMgfSksXG4gICAgICBvbkNoYW5nZTogZnVuY3Rpb25zLm9uQ2VsbFZhbHVlQ2hhbmdlKHJvd0luZGV4LCBjb2wsIGVkaXRWYWx1ZVBhcnNlciksXG4gICAgICBvbkJsdXI6IGZ1bmN0aW9ucy5vbkNlbGxCbHVyKHJvd0luZGV4LCBjb2wpLFxuICAgICAgb25Gb2N1czogZnVuY3Rpb25zLm9uQ2VsbEZvY3VzKGNlbGxOYW1lLCBjb2wuY29tcG9uZW50VHlwZSwgcm93SW5kZXgsIGNvbHVtbi5jb2x1bW5LZXkpLFxuICAgICAgb25LZXlEb3duOiBmdW5jdGlvbnMub25DZWxsS2V5RG93bihyb3dJbmRleCwgY29sKSxcbiAgICAgIGlzU2VhcmNoYWJsZTogc2VsZWN0T3B0aW9ucyAmJiAoc2VsZWN0T3B0aW9ucy5sZW5ndGggPiA5KSxcbiAgICAgIGlzQ2xlYXJhYmxlOiAhY29sLmlzUmVxdWlyZWQsXG4gICAgICBiYWNrU3BhY2VSZW1vdmVzVmFsdWU6IGZhbHNlLFxuICAgICAgdGFiU2VsZWN0c1ZhbHVlOiBmYWxzZSxcbiAgICAgIG9wZW5NZW51T25Gb2N1czogZmFsc2UsXG4gICAgICByZWY6IGZ1bmN0aW9ucy5oYW5kbGVDZWxsUmVmKHJvd0luZGV4LCBjb2wpLFxuICAgICAgaXNEaXNhYmxlZDogZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZShyb3dJbmRleCwgY29sLCBjZWxsTmFtZSksXG4gICAgICB0YWJJbmRleCxcbiAgICAgIC4uLmNvbC5lZGl0Q29tcG9uZW50UHJvcHMsXG4gICAgICAuLi5zZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgfTtcblxuICAgIGlmIChjb2wuaXNDcmVhdGFibGVTZWxlY3QpIHJldHVybiBjcmVhdGFibGVTZWxlY3RSZW5kZXIoeyAuLi5mc1Byb3BzIH0pO1xuICAgIHJldHVybiBzZWxlY3RSZW5kZXIoeyAuLi5mc1Byb3BzIH0pO1xuICB9LFxuXG4gIGNlbGxDcmVhdGUoXG4gICAgY29sLFxuICAgIGNvbHVtbixcbiAgICByb3dJbmRleCxcbiAgICB0YWJJbmRleCxcbiAgICBncmlkSWQsXG4gICAgc2VsZWN0T3B0aW9ucyxcbiAgICBzZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgZWRpdFZhbHVlUGFyc2VyLFxuICAgIGZ1bmN0aW9ucyxcbiAgICBnZXRDb21wb25lbnREaXNhYmxlZFN0YXRlLFxuICApIHtcbiAgICBjb25zdCBjZWxsTmFtZSA9ICdjcmVhdGUnO1xuICAgIGNvbnN0IG9wdHMgPSBjb2wuY3JlYXRlU2VsZWN0T3B0aW9uc01vZCAmJiBzZWxlY3RPcHRpb25zID9cbiAgICAgIGNvbC5jcmVhdGVTZWxlY3RPcHRpb25zTW9kKHNlbGVjdE9wdGlvbnMuc2xpY2UoKSwgcm93SW5kZXgsIGNvbCkgOlxuICAgICAgc2VsZWN0T3B0aW9ucztcbiAgICBjb25zdCBmc1Byb3BzID0ge1xuICAgICAgbmFtZTogYG9jRGF0YWdyaWRDcmVhdGVJbnB1dC0ke2dyaWRJZH0tJHtjb2x1bW4uY29sdW1uS2V5fS0ke3Jvd0luZGV4fWAsXG4gICAgICBvcHRpb25zOiBvcHRzLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9ucy5nZXRJdGVtVmFsdWUocm93SW5kZXgsIGNvbCwgeyBzZWxlY3RPcHRpb25zIH0pLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9ucy5vbkNlbGxWYWx1ZUNoYW5nZShyb3dJbmRleCwgY29sLCBlZGl0VmFsdWVQYXJzZXIpLFxuICAgICAgb25CbHVyOiBmdW5jdGlvbnMub25DZWxsQmx1cihyb3dJbmRleCwgY29sKSxcbiAgICAgIG9uS2V5RG93bjogZnVuY3Rpb25zLm9uQ2VsbEtleURvd24ocm93SW5kZXgsIGNvbCksXG4gICAgICBvbkZvY3VzOiBmdW5jdGlvbnMub25DZWxsRm9jdXMoY2VsbE5hbWUsIGNvbC5jb21wb25lbnRUeXBlLCByb3dJbmRleCwgY29sdW1uLmNvbHVtbktleSksXG4gICAgICBpc1NlYXJjaGFibGU6IHNlbGVjdE9wdGlvbnMgJiYgKHNlbGVjdE9wdGlvbnMubGVuZ3RoID4gOSksXG4gICAgICBpc0NsZWFyYWJsZTogIWNvbC5pc1JlcXVpcmVkLFxuICAgICAgYmFja3NwYWNlUmVtb3Zlc1ZhbHVlOiBmYWxzZSxcbiAgICAgIHRhYlNlbGVjdHNWYWx1ZTogZmFsc2UsXG4gICAgICBvcGVuTWVudU9uRm9jdXM6IGZhbHNlLFxuICAgICAgcmVmOiBmdW5jdGlvbnMuaGFuZGxlQ2VsbFJlZihyb3dJbmRleCwgY29sKSxcbiAgICAgIGlzRGlzYWJsZWQ6IGdldENvbXBvbmVudERpc2FibGVkU3RhdGUocm93SW5kZXgsIGNvbCwgY2VsbE5hbWUpLFxuICAgICAgdGFiSW5kZXgsXG4gICAgICAuLi5jb2wuY3JlYXRlQ29tcG9uZW50UHJvcHMsXG4gICAgICAuLi5zZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgfTtcblxuICAgIGlmIChjb2wuaXNDcmVhdGFibGVTZWxlY3QpIHJldHVybiBjcmVhdGFibGVTZWxlY3RSZW5kZXIoeyAuLi5mc1Byb3BzIH0pO1xuICAgIHJldHVybiBzZWxlY3RSZW5kZXIoeyAuLi5mc1Byb3BzIH0pO1xuICB9LFxuXG4gIGNlbGxGaWx0ZXIoXG4gICAgY29sLFxuICAgIGNvbHVtbixcbiAgICB0YWJJbmRleCxcbiAgICBncmlkSWQsXG4gICAgc2VsZWN0T3B0aW9ucyxcbiAgICBzZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgZWRpdFZhbHVlUGFyc2VyLFxuICAgIGZ1bmN0aW9ucyxcbiAgKSB7XG4gICAgY29uc3Qgb3B0cyA9IGNvbC5maWx0ZXJTZWxlY3RPcHRpb25zTW9kICYmIHNlbGVjdE9wdGlvbnMgP1xuICAgICAgY29sLmZpbHRlclNlbGVjdE9wdGlvbnNNb2Qoc2VsZWN0T3B0aW9ucy5zbGljZSgpLCBjb2wpIDpcbiAgICAgIHNlbGVjdE9wdGlvbnM7XG4gICAgY29uc3QgZnNQcm9wcyA9IHtcbiAgICAgIG5hbWU6IGBvY0RhdGFncmlkRmlsdGVySW5wdXQtJHtncmlkSWR9LSR7Y29sdW1uLmNvbHVtbktleX1gLFxuICAgICAgb3B0aW9uczogb3B0cyxcbiAgICAgIHZhbHVlOiBmdW5jdGlvbnMuZ2V0SXRlbVZhbHVlKGNvbCwgeyBzZWxlY3RPcHRpb25zIH0pLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9ucy5vbkNlbGxWYWx1ZUNoYW5nZShjb2wsIGVkaXRWYWx1ZVBhcnNlciksXG4gICAgICBpc1NlYXJjaGFibGU6IHNlbGVjdE9wdGlvbnMgJiYgKHNlbGVjdE9wdGlvbnMubGVuZ3RoID4gOSksXG4gICAgICBpc0NsZWFyYWJsZTogdHJ1ZSxcbiAgICAgIHRhYlNlbGVjdHNWYWx1ZTogZmFsc2UsXG4gICAgICB0YWJJbmRleCxcbiAgICAgIC4uLmNvbC5maWx0ZXJDb21wb25lbnRQcm9wcyxcbiAgICAgIC4uLnNlbGVjdFRyYW5zbGF0aW9ucyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHNlbGVjdFJlbmRlcih7IC4uLmZzUHJvcHMgfSk7XG4gIH0sXG5cbn07XG4iXX0=