"use strict";

exports.__esModule = true;
exports["default"] = exports.creatableSelectRender = exports.selectRender = void 0;

var _react = _interopRequireDefault(require("react"));

var _reactFloatingSelect = require("@opuscapita/react-floating-select");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

var selectRender = function selectRender(selectProps) {
  return _react["default"].createElement(_reactFloatingSelect.FloatingSelectPortal, selectProps);
};

exports.selectRender = selectRender;

var creatableSelectRender = function creatableSelectRender(selectProps) {
  return _react["default"].createElement(_reactFloatingSelect.FloatingSelectPortalCreatable, selectProps);
};

exports.creatableSelectRender = creatableSelectRender;
var _default = {
  valRender: function valRender(rowIndex, selectOptions, valueRender) {
    if (selectOptions === void 0) {
      selectOptions = [];
    }

    return valueRender(rowIndex, function (v) {
      var option = selectOptions.find(function (o) {
        return o.value === v;
      });
      return option ? option.label : null;
    });
  },
  cellEdit: function cellEdit(col, column, rowIndex, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions, getComponentDisabledState) {
    var cellName = 'edit';
    var opts = col.editSelectOptionsMod && selectOptions ? col.editSelectOptionsMod(selectOptions.slice(), rowIndex, col) : selectOptions;

    var fsProps = _extends({
      name: "ocDatagridEditInput-" + gridId + "-" + column.columnKey + "-" + rowIndex,
      options: opts,
      value: functions.getItemValue(rowIndex, col, {
        selectOptions: opts
      }),
      onChange: functions.onCellValueChange(rowIndex, col, editValueParser),
      onBlur: functions.onCellBlur(rowIndex, col),
      onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
      onKeyDown: functions.onCellKeyDown(rowIndex, col),
      isSearchable: true,
      isClearable: !col.isRequired,
      backSpaceRemovesValue: false,
      tabSelectsValue: false,
      openMenuOnFocus: false,
      ref: functions.handleCellRef(rowIndex, col),
      isDisabled: getComponentDisabledState(rowIndex, col, cellName),
      tabIndex: tabIndex
    }, selectTranslations, {}, col.editComponentProps);

    if (col.isCreatableSelect) return creatableSelectRender(_extends({}, fsProps));
    return selectRender(_extends({}, fsProps));
  },
  cellCreate: function cellCreate(col, column, rowIndex, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions, getComponentDisabledState) {
    var cellName = 'create';
    var opts = col.createSelectOptionsMod && selectOptions ? col.createSelectOptionsMod(selectOptions.slice(), rowIndex, col) : selectOptions;

    var fsProps = _extends({
      name: "ocDatagridCreateInput-" + gridId + "-" + column.columnKey + "-" + rowIndex,
      options: opts,
      value: functions.getItemValue(rowIndex, col, {
        selectOptions: opts
      }),
      onChange: functions.onCellValueChange(rowIndex, col, editValueParser),
      onBlur: functions.onCellBlur(rowIndex, col),
      onKeyDown: functions.onCellKeyDown(rowIndex, col),
      onFocus: functions.onCellFocus(cellName, col.componentType, rowIndex, column.columnKey),
      isSearchable: true,
      isClearable: !col.isRequired,
      backspaceRemovesValue: false,
      tabSelectsValue: false,
      openMenuOnFocus: false,
      ref: functions.handleCellRef(rowIndex, col),
      isDisabled: getComponentDisabledState(rowIndex, col, cellName),
      tabIndex: tabIndex
    }, selectTranslations, {}, col.createComponentProps);

    if (col.isCreatableSelect) return creatableSelectRender(_extends({}, fsProps));
    return selectRender(_extends({}, fsProps));
  },
  cellFilter: function cellFilter(col, column, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions) {
    var opts = col.filterSelectOptionsMod && selectOptions ? col.filterSelectOptionsMod(selectOptions.slice(), col) : selectOptions;

    var fsProps = _extends({
      name: "ocDatagridFilterInput-" + gridId + "-" + column.columnKey,
      options: opts,
      value: functions.getItemValue(col, {
        selectOptions: opts
      }),
      onChange: functions.onCellValueChange(col, editValueParser),
      isSearchable: true,
      isClearable: true,
      tabSelectsValue: false,
      tabIndex: tabIndex
    }, selectTranslations, {}, col.filterComponentProps);

    return selectRender(_extends({}, fsProps));
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9jb2x1bW4tc2VydmljZS9jb2x1bW4tdHlwZXMvc2VsZWN0LXJlbmRlcmVycy5qc3giXSwibmFtZXMiOlsic2VsZWN0UmVuZGVyIiwic2VsZWN0UHJvcHMiLCJjcmVhdGFibGVTZWxlY3RSZW5kZXIiLCJ2YWxSZW5kZXIiLCJyb3dJbmRleCIsInNlbGVjdE9wdGlvbnMiLCJ2YWx1ZVJlbmRlciIsInYiLCJvcHRpb24iLCJmaW5kIiwibyIsInZhbHVlIiwibGFiZWwiLCJjZWxsRWRpdCIsImNvbCIsImNvbHVtbiIsInRhYkluZGV4IiwiZ3JpZElkIiwic2VsZWN0VHJhbnNsYXRpb25zIiwiZWRpdFZhbHVlUGFyc2VyIiwiZnVuY3Rpb25zIiwiZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZSIsImNlbGxOYW1lIiwib3B0cyIsImVkaXRTZWxlY3RPcHRpb25zTW9kIiwic2xpY2UiLCJmc1Byb3BzIiwibmFtZSIsImNvbHVtbktleSIsIm9wdGlvbnMiLCJnZXRJdGVtVmFsdWUiLCJvbkNoYW5nZSIsIm9uQ2VsbFZhbHVlQ2hhbmdlIiwib25CbHVyIiwib25DZWxsQmx1ciIsIm9uRm9jdXMiLCJvbkNlbGxGb2N1cyIsImNvbXBvbmVudFR5cGUiLCJvbktleURvd24iLCJvbkNlbGxLZXlEb3duIiwiaXNTZWFyY2hhYmxlIiwiaXNDbGVhcmFibGUiLCJpc1JlcXVpcmVkIiwiYmFja1NwYWNlUmVtb3Zlc1ZhbHVlIiwidGFiU2VsZWN0c1ZhbHVlIiwib3Blbk1lbnVPbkZvY3VzIiwicmVmIiwiaGFuZGxlQ2VsbFJlZiIsImlzRGlzYWJsZWQiLCJlZGl0Q29tcG9uZW50UHJvcHMiLCJpc0NyZWF0YWJsZVNlbGVjdCIsImNlbGxDcmVhdGUiLCJjcmVhdGVTZWxlY3RPcHRpb25zTW9kIiwiYmFja3NwYWNlUmVtb3Zlc1ZhbHVlIiwiY3JlYXRlQ29tcG9uZW50UHJvcHMiLCJjZWxsRmlsdGVyIiwiZmlsdGVyU2VsZWN0T3B0aW9uc01vZCIsImZpbHRlckNvbXBvbmVudFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBOztBQUNBOzs7Ozs7QUFLTyxJQUFNQSxZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFBQyxXQUFXO0FBQUEsU0FBSSxnQ0FBQyx5Q0FBRCxFQUEwQkEsV0FBMUIsQ0FBSjtBQUFBLENBQWhDOzs7O0FBRUEsSUFBTUMscUJBQXFCLEdBQUcsU0FBeEJBLHFCQUF3QixDQUFBRCxXQUFXO0FBQUEsU0FDOUMsZ0NBQUMsa0RBQUQsRUFBbUNBLFdBQW5DLENBRDhDO0FBQUEsQ0FBekM7OztlQUlRO0FBQ2JFLEVBQUFBLFNBRGEscUJBRVhDLFFBRlcsRUFHWEMsYUFIVyxFQUlYQyxXQUpXLEVBS1g7QUFBQSxRQUZBRCxhQUVBO0FBRkFBLE1BQUFBLGFBRUEsR0FGZ0IsRUFFaEI7QUFBQTs7QUFDQSxXQUFPQyxXQUFXLENBQUNGLFFBQUQsRUFBVyxVQUFDRyxDQUFELEVBQU87QUFDbEMsVUFBTUMsTUFBTSxHQUFHSCxhQUFhLENBQUNJLElBQWQsQ0FBbUIsVUFBQUMsQ0FBQztBQUFBLGVBQUlBLENBQUMsQ0FBQ0MsS0FBRixLQUFZSixDQUFoQjtBQUFBLE9BQXBCLENBQWY7QUFDQSxhQUFPQyxNQUFNLEdBQUdBLE1BQU0sQ0FBQ0ksS0FBVixHQUFrQixJQUEvQjtBQUNELEtBSGlCLENBQWxCO0FBSUQsR0FWWTtBQVdiQyxFQUFBQSxRQVhhLG9CQVlYQyxHQVpXLEVBYVhDLE1BYlcsRUFjWFgsUUFkVyxFQWVYWSxRQWZXLEVBZ0JYQyxNQWhCVyxFQWlCWFosYUFqQlcsRUFrQlhhLGtCQWxCVyxFQW1CWEMsZUFuQlcsRUFvQlhDLFNBcEJXLEVBcUJYQyx5QkFyQlcsRUFzQlg7QUFDQSxRQUFNQyxRQUFRLEdBQUcsTUFBakI7QUFDQSxRQUFNQyxJQUFJLEdBQUdULEdBQUcsQ0FBQ1Usb0JBQUosSUFBNEJuQixhQUE1QixHQUNUUyxHQUFHLENBQUNVLG9CQUFKLENBQXlCbkIsYUFBYSxDQUFDb0IsS0FBZCxFQUF6QixFQUFnRHJCLFFBQWhELEVBQTBEVSxHQUExRCxDQURTLEdBRVRULGFBRko7O0FBR0EsUUFBTXFCLE9BQU87QUFDWEMsTUFBQUEsSUFBSSwyQkFBeUJWLE1BQXpCLFNBQW1DRixNQUFNLENBQUNhLFNBQTFDLFNBQXVEeEIsUUFEaEQ7QUFFWHlCLE1BQUFBLE9BQU8sRUFBRU4sSUFGRTtBQUdYWixNQUFBQSxLQUFLLEVBQUVTLFNBQVMsQ0FBQ1UsWUFBVixDQUF1QjFCLFFBQXZCLEVBQWlDVSxHQUFqQyxFQUFzQztBQUFFVCxRQUFBQSxhQUFhLEVBQUVrQjtBQUFqQixPQUF0QyxDQUhJO0FBSVhRLE1BQUFBLFFBQVEsRUFBRVgsU0FBUyxDQUFDWSxpQkFBVixDQUE0QjVCLFFBQTVCLEVBQXNDVSxHQUF0QyxFQUEyQ0ssZUFBM0MsQ0FKQztBQUtYYyxNQUFBQSxNQUFNLEVBQUViLFNBQVMsQ0FBQ2MsVUFBVixDQUFxQjlCLFFBQXJCLEVBQStCVSxHQUEvQixDQUxHO0FBTVhxQixNQUFBQSxPQUFPLEVBQUVmLFNBQVMsQ0FBQ2dCLFdBQVYsQ0FBc0JkLFFBQXRCLEVBQWdDUixHQUFHLENBQUN1QixhQUFwQyxFQUFtRGpDLFFBQW5ELEVBQTZEVyxNQUFNLENBQUNhLFNBQXBFLENBTkU7QUFPWFUsTUFBQUEsU0FBUyxFQUFFbEIsU0FBUyxDQUFDbUIsYUFBVixDQUF3Qm5DLFFBQXhCLEVBQWtDVSxHQUFsQyxDQVBBO0FBUVgwQixNQUFBQSxZQUFZLEVBQUUsSUFSSDtBQVNYQyxNQUFBQSxXQUFXLEVBQUUsQ0FBQzNCLEdBQUcsQ0FBQzRCLFVBVFA7QUFVWEMsTUFBQUEscUJBQXFCLEVBQUUsS0FWWjtBQVdYQyxNQUFBQSxlQUFlLEVBQUUsS0FYTjtBQVlYQyxNQUFBQSxlQUFlLEVBQUUsS0FaTjtBQWFYQyxNQUFBQSxHQUFHLEVBQUUxQixTQUFTLENBQUMyQixhQUFWLENBQXdCM0MsUUFBeEIsRUFBa0NVLEdBQWxDLENBYk07QUFjWGtDLE1BQUFBLFVBQVUsRUFBRTNCLHlCQUF5QixDQUFDakIsUUFBRCxFQUFXVSxHQUFYLEVBQWdCUSxRQUFoQixDQWQxQjtBQWVYTixNQUFBQSxRQUFRLEVBQVJBO0FBZlcsT0FnQlJFLGtCQWhCUSxNQWlCUkosR0FBRyxDQUFDbUMsa0JBakJJLENBQWI7O0FBb0JBLFFBQUluQyxHQUFHLENBQUNvQyxpQkFBUixFQUEyQixPQUFPaEQscUJBQXFCLGNBQU13QixPQUFOLEVBQTVCO0FBQzNCLFdBQU8xQixZQUFZLGNBQU0wQixPQUFOLEVBQW5CO0FBQ0QsR0FqRFk7QUFtRGJ5QixFQUFBQSxVQW5EYSxzQkFvRFhyQyxHQXBEVyxFQXFEWEMsTUFyRFcsRUFzRFhYLFFBdERXLEVBdURYWSxRQXZEVyxFQXdEWEMsTUF4RFcsRUF5RFhaLGFBekRXLEVBMERYYSxrQkExRFcsRUEyRFhDLGVBM0RXLEVBNERYQyxTQTVEVyxFQTZEWEMseUJBN0RXLEVBOERYO0FBQ0EsUUFBTUMsUUFBUSxHQUFHLFFBQWpCO0FBQ0EsUUFBTUMsSUFBSSxHQUFHVCxHQUFHLENBQUNzQyxzQkFBSixJQUE4Qi9DLGFBQTlCLEdBQ1RTLEdBQUcsQ0FBQ3NDLHNCQUFKLENBQTJCL0MsYUFBYSxDQUFDb0IsS0FBZCxFQUEzQixFQUFrRHJCLFFBQWxELEVBQTREVSxHQUE1RCxDQURTLEdBRVRULGFBRko7O0FBR0EsUUFBTXFCLE9BQU87QUFDWEMsTUFBQUEsSUFBSSw2QkFBMkJWLE1BQTNCLFNBQXFDRixNQUFNLENBQUNhLFNBQTVDLFNBQXlEeEIsUUFEbEQ7QUFFWHlCLE1BQUFBLE9BQU8sRUFBRU4sSUFGRTtBQUdYWixNQUFBQSxLQUFLLEVBQUVTLFNBQVMsQ0FBQ1UsWUFBVixDQUF1QjFCLFFBQXZCLEVBQWlDVSxHQUFqQyxFQUFzQztBQUFFVCxRQUFBQSxhQUFhLEVBQUVrQjtBQUFqQixPQUF0QyxDQUhJO0FBSVhRLE1BQUFBLFFBQVEsRUFBRVgsU0FBUyxDQUFDWSxpQkFBVixDQUE0QjVCLFFBQTVCLEVBQXNDVSxHQUF0QyxFQUEyQ0ssZUFBM0MsQ0FKQztBQUtYYyxNQUFBQSxNQUFNLEVBQUViLFNBQVMsQ0FBQ2MsVUFBVixDQUFxQjlCLFFBQXJCLEVBQStCVSxHQUEvQixDQUxHO0FBTVh3QixNQUFBQSxTQUFTLEVBQUVsQixTQUFTLENBQUNtQixhQUFWLENBQXdCbkMsUUFBeEIsRUFBa0NVLEdBQWxDLENBTkE7QUFPWHFCLE1BQUFBLE9BQU8sRUFBRWYsU0FBUyxDQUFDZ0IsV0FBVixDQUFzQmQsUUFBdEIsRUFBZ0NSLEdBQUcsQ0FBQ3VCLGFBQXBDLEVBQW1EakMsUUFBbkQsRUFBNkRXLE1BQU0sQ0FBQ2EsU0FBcEUsQ0FQRTtBQVFYWSxNQUFBQSxZQUFZLEVBQUUsSUFSSDtBQVNYQyxNQUFBQSxXQUFXLEVBQUUsQ0FBQzNCLEdBQUcsQ0FBQzRCLFVBVFA7QUFVWFcsTUFBQUEscUJBQXFCLEVBQUUsS0FWWjtBQVdYVCxNQUFBQSxlQUFlLEVBQUUsS0FYTjtBQVlYQyxNQUFBQSxlQUFlLEVBQUUsS0FaTjtBQWFYQyxNQUFBQSxHQUFHLEVBQUUxQixTQUFTLENBQUMyQixhQUFWLENBQXdCM0MsUUFBeEIsRUFBa0NVLEdBQWxDLENBYk07QUFjWGtDLE1BQUFBLFVBQVUsRUFBRTNCLHlCQUF5QixDQUFDakIsUUFBRCxFQUFXVSxHQUFYLEVBQWdCUSxRQUFoQixDQWQxQjtBQWVYTixNQUFBQSxRQUFRLEVBQVJBO0FBZlcsT0FnQlJFLGtCQWhCUSxNQWlCUkosR0FBRyxDQUFDd0Msb0JBakJJLENBQWI7O0FBb0JBLFFBQUl4QyxHQUFHLENBQUNvQyxpQkFBUixFQUEyQixPQUFPaEQscUJBQXFCLGNBQU13QixPQUFOLEVBQTVCO0FBQzNCLFdBQU8xQixZQUFZLGNBQU0wQixPQUFOLEVBQW5CO0FBQ0QsR0F6Rlk7QUEyRmI2QixFQUFBQSxVQTNGYSxzQkE0Rlh6QyxHQTVGVyxFQTZGWEMsTUE3RlcsRUE4RlhDLFFBOUZXLEVBK0ZYQyxNQS9GVyxFQWdHWFosYUFoR1csRUFpR1hhLGtCQWpHVyxFQWtHWEMsZUFsR1csRUFtR1hDLFNBbkdXLEVBb0dYO0FBQ0EsUUFBTUcsSUFBSSxHQUFHVCxHQUFHLENBQUMwQyxzQkFBSixJQUE4Qm5ELGFBQTlCLEdBQ1RTLEdBQUcsQ0FBQzBDLHNCQUFKLENBQTJCbkQsYUFBYSxDQUFDb0IsS0FBZCxFQUEzQixFQUFrRFgsR0FBbEQsQ0FEUyxHQUVUVCxhQUZKOztBQUdBLFFBQU1xQixPQUFPO0FBQ1hDLE1BQUFBLElBQUksNkJBQTJCVixNQUEzQixTQUFxQ0YsTUFBTSxDQUFDYSxTQURyQztBQUVYQyxNQUFBQSxPQUFPLEVBQUVOLElBRkU7QUFHWFosTUFBQUEsS0FBSyxFQUFFUyxTQUFTLENBQUNVLFlBQVYsQ0FBdUJoQixHQUF2QixFQUE0QjtBQUFFVCxRQUFBQSxhQUFhLEVBQUVrQjtBQUFqQixPQUE1QixDQUhJO0FBSVhRLE1BQUFBLFFBQVEsRUFBRVgsU0FBUyxDQUFDWSxpQkFBVixDQUE0QmxCLEdBQTVCLEVBQWlDSyxlQUFqQyxDQUpDO0FBS1hxQixNQUFBQSxZQUFZLEVBQUUsSUFMSDtBQU1YQyxNQUFBQSxXQUFXLEVBQUUsSUFORjtBQU9YRyxNQUFBQSxlQUFlLEVBQUUsS0FQTjtBQVFYNUIsTUFBQUEsUUFBUSxFQUFSQTtBQVJXLE9BU1JFLGtCQVRRLE1BVVJKLEdBQUcsQ0FBQzJDLG9CQVZJLENBQWI7O0FBYUEsV0FBT3pELFlBQVksY0FBTTBCLE9BQU4sRUFBbkI7QUFDRDtBQXRIWSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEZsb2F0aW5nU2VsZWN0UG9ydGFsLFxuICBGbG9hdGluZ1NlbGVjdFBvcnRhbENyZWF0YWJsZSxcbn0gZnJvbSAnQG9wdXNjYXBpdGEvcmVhY3QtZmxvYXRpbmctc2VsZWN0JztcblxuZXhwb3J0IGNvbnN0IHNlbGVjdFJlbmRlciA9IHNlbGVjdFByb3BzID0+IDxGbG9hdGluZ1NlbGVjdFBvcnRhbCB7Li4uc2VsZWN0UHJvcHN9IC8+O1xuXG5leHBvcnQgY29uc3QgY3JlYXRhYmxlU2VsZWN0UmVuZGVyID0gc2VsZWN0UHJvcHMgPT4gKFxuICA8RmxvYXRpbmdTZWxlY3RQb3J0YWxDcmVhdGFibGUgey4uLnNlbGVjdFByb3BzfSAvPlxuKTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICB2YWxSZW5kZXIoXG4gICAgcm93SW5kZXgsXG4gICAgc2VsZWN0T3B0aW9ucyA9IFtdLFxuICAgIHZhbHVlUmVuZGVyLFxuICApIHtcbiAgICByZXR1cm4gdmFsdWVSZW5kZXIocm93SW5kZXgsICh2KSA9PiB7XG4gICAgICBjb25zdCBvcHRpb24gPSBzZWxlY3RPcHRpb25zLmZpbmQobyA9PiBvLnZhbHVlID09PSB2KTtcbiAgICAgIHJldHVybiBvcHRpb24gPyBvcHRpb24ubGFiZWwgOiBudWxsO1xuICAgIH0pO1xuICB9LFxuICBjZWxsRWRpdChcbiAgICBjb2wsXG4gICAgY29sdW1uLFxuICAgIHJvd0luZGV4LFxuICAgIHRhYkluZGV4LFxuICAgIGdyaWRJZCxcbiAgICBzZWxlY3RPcHRpb25zLFxuICAgIHNlbGVjdFRyYW5zbGF0aW9ucyxcbiAgICBlZGl0VmFsdWVQYXJzZXIsXG4gICAgZnVuY3Rpb25zLFxuICAgIGdldENvbXBvbmVudERpc2FibGVkU3RhdGUsXG4gICkge1xuICAgIGNvbnN0IGNlbGxOYW1lID0gJ2VkaXQnO1xuICAgIGNvbnN0IG9wdHMgPSBjb2wuZWRpdFNlbGVjdE9wdGlvbnNNb2QgJiYgc2VsZWN0T3B0aW9uc1xuICAgICAgPyBjb2wuZWRpdFNlbGVjdE9wdGlvbnNNb2Qoc2VsZWN0T3B0aW9ucy5zbGljZSgpLCByb3dJbmRleCwgY29sKVxuICAgICAgOiBzZWxlY3RPcHRpb25zO1xuICAgIGNvbnN0IGZzUHJvcHMgPSB7XG4gICAgICBuYW1lOiBgb2NEYXRhZ3JpZEVkaXRJbnB1dC0ke2dyaWRJZH0tJHtjb2x1bW4uY29sdW1uS2V5fS0ke3Jvd0luZGV4fWAsXG4gICAgICBvcHRpb25zOiBvcHRzLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9ucy5nZXRJdGVtVmFsdWUocm93SW5kZXgsIGNvbCwgeyBzZWxlY3RPcHRpb25zOiBvcHRzIH0pLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9ucy5vbkNlbGxWYWx1ZUNoYW5nZShyb3dJbmRleCwgY29sLCBlZGl0VmFsdWVQYXJzZXIpLFxuICAgICAgb25CbHVyOiBmdW5jdGlvbnMub25DZWxsQmx1cihyb3dJbmRleCwgY29sKSxcbiAgICAgIG9uRm9jdXM6IGZ1bmN0aW9ucy5vbkNlbGxGb2N1cyhjZWxsTmFtZSwgY29sLmNvbXBvbmVudFR5cGUsIHJvd0luZGV4LCBjb2x1bW4uY29sdW1uS2V5KSxcbiAgICAgIG9uS2V5RG93bjogZnVuY3Rpb25zLm9uQ2VsbEtleURvd24ocm93SW5kZXgsIGNvbCksXG4gICAgICBpc1NlYXJjaGFibGU6IHRydWUsXG4gICAgICBpc0NsZWFyYWJsZTogIWNvbC5pc1JlcXVpcmVkLFxuICAgICAgYmFja1NwYWNlUmVtb3Zlc1ZhbHVlOiBmYWxzZSxcbiAgICAgIHRhYlNlbGVjdHNWYWx1ZTogZmFsc2UsXG4gICAgICBvcGVuTWVudU9uRm9jdXM6IGZhbHNlLFxuICAgICAgcmVmOiBmdW5jdGlvbnMuaGFuZGxlQ2VsbFJlZihyb3dJbmRleCwgY29sKSxcbiAgICAgIGlzRGlzYWJsZWQ6IGdldENvbXBvbmVudERpc2FibGVkU3RhdGUocm93SW5kZXgsIGNvbCwgY2VsbE5hbWUpLFxuICAgICAgdGFiSW5kZXgsXG4gICAgICAuLi5zZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgICAuLi5jb2wuZWRpdENvbXBvbmVudFByb3BzLFxuICAgIH07XG5cbiAgICBpZiAoY29sLmlzQ3JlYXRhYmxlU2VsZWN0KSByZXR1cm4gY3JlYXRhYmxlU2VsZWN0UmVuZGVyKHsgLi4uZnNQcm9wcyB9KTtcbiAgICByZXR1cm4gc2VsZWN0UmVuZGVyKHsgLi4uZnNQcm9wcyB9KTtcbiAgfSxcblxuICBjZWxsQ3JlYXRlKFxuICAgIGNvbCxcbiAgICBjb2x1bW4sXG4gICAgcm93SW5kZXgsXG4gICAgdGFiSW5kZXgsXG4gICAgZ3JpZElkLFxuICAgIHNlbGVjdE9wdGlvbnMsXG4gICAgc2VsZWN0VHJhbnNsYXRpb25zLFxuICAgIGVkaXRWYWx1ZVBhcnNlcixcbiAgICBmdW5jdGlvbnMsXG4gICAgZ2V0Q29tcG9uZW50RGlzYWJsZWRTdGF0ZSxcbiAgKSB7XG4gICAgY29uc3QgY2VsbE5hbWUgPSAnY3JlYXRlJztcbiAgICBjb25zdCBvcHRzID0gY29sLmNyZWF0ZVNlbGVjdE9wdGlvbnNNb2QgJiYgc2VsZWN0T3B0aW9uc1xuICAgICAgPyBjb2wuY3JlYXRlU2VsZWN0T3B0aW9uc01vZChzZWxlY3RPcHRpb25zLnNsaWNlKCksIHJvd0luZGV4LCBjb2wpXG4gICAgICA6IHNlbGVjdE9wdGlvbnM7XG4gICAgY29uc3QgZnNQcm9wcyA9IHtcbiAgICAgIG5hbWU6IGBvY0RhdGFncmlkQ3JlYXRlSW5wdXQtJHtncmlkSWR9LSR7Y29sdW1uLmNvbHVtbktleX0tJHtyb3dJbmRleH1gLFxuICAgICAgb3B0aW9uczogb3B0cyxcbiAgICAgIHZhbHVlOiBmdW5jdGlvbnMuZ2V0SXRlbVZhbHVlKHJvd0luZGV4LCBjb2wsIHsgc2VsZWN0T3B0aW9uczogb3B0cyB9KSxcbiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbnMub25DZWxsVmFsdWVDaGFuZ2Uocm93SW5kZXgsIGNvbCwgZWRpdFZhbHVlUGFyc2VyKSxcbiAgICAgIG9uQmx1cjogZnVuY3Rpb25zLm9uQ2VsbEJsdXIocm93SW5kZXgsIGNvbCksXG4gICAgICBvbktleURvd246IGZ1bmN0aW9ucy5vbkNlbGxLZXlEb3duKHJvd0luZGV4LCBjb2wpLFxuICAgICAgb25Gb2N1czogZnVuY3Rpb25zLm9uQ2VsbEZvY3VzKGNlbGxOYW1lLCBjb2wuY29tcG9uZW50VHlwZSwgcm93SW5kZXgsIGNvbHVtbi5jb2x1bW5LZXkpLFxuICAgICAgaXNTZWFyY2hhYmxlOiB0cnVlLFxuICAgICAgaXNDbGVhcmFibGU6ICFjb2wuaXNSZXF1aXJlZCxcbiAgICAgIGJhY2tzcGFjZVJlbW92ZXNWYWx1ZTogZmFsc2UsXG4gICAgICB0YWJTZWxlY3RzVmFsdWU6IGZhbHNlLFxuICAgICAgb3Blbk1lbnVPbkZvY3VzOiBmYWxzZSxcbiAgICAgIHJlZjogZnVuY3Rpb25zLmhhbmRsZUNlbGxSZWYocm93SW5kZXgsIGNvbCksXG4gICAgICBpc0Rpc2FibGVkOiBnZXRDb21wb25lbnREaXNhYmxlZFN0YXRlKHJvd0luZGV4LCBjb2wsIGNlbGxOYW1lKSxcbiAgICAgIHRhYkluZGV4LFxuICAgICAgLi4uc2VsZWN0VHJhbnNsYXRpb25zLFxuICAgICAgLi4uY29sLmNyZWF0ZUNvbXBvbmVudFByb3BzLFxuICAgIH07XG5cbiAgICBpZiAoY29sLmlzQ3JlYXRhYmxlU2VsZWN0KSByZXR1cm4gY3JlYXRhYmxlU2VsZWN0UmVuZGVyKHsgLi4uZnNQcm9wcyB9KTtcbiAgICByZXR1cm4gc2VsZWN0UmVuZGVyKHsgLi4uZnNQcm9wcyB9KTtcbiAgfSxcblxuICBjZWxsRmlsdGVyKFxuICAgIGNvbCxcbiAgICBjb2x1bW4sXG4gICAgdGFiSW5kZXgsXG4gICAgZ3JpZElkLFxuICAgIHNlbGVjdE9wdGlvbnMsXG4gICAgc2VsZWN0VHJhbnNsYXRpb25zLFxuICAgIGVkaXRWYWx1ZVBhcnNlcixcbiAgICBmdW5jdGlvbnMsXG4gICkge1xuICAgIGNvbnN0IG9wdHMgPSBjb2wuZmlsdGVyU2VsZWN0T3B0aW9uc01vZCAmJiBzZWxlY3RPcHRpb25zXG4gICAgICA/IGNvbC5maWx0ZXJTZWxlY3RPcHRpb25zTW9kKHNlbGVjdE9wdGlvbnMuc2xpY2UoKSwgY29sKVxuICAgICAgOiBzZWxlY3RPcHRpb25zO1xuICAgIGNvbnN0IGZzUHJvcHMgPSB7XG4gICAgICBuYW1lOiBgb2NEYXRhZ3JpZEZpbHRlcklucHV0LSR7Z3JpZElkfS0ke2NvbHVtbi5jb2x1bW5LZXl9YCxcbiAgICAgIG9wdGlvbnM6IG9wdHMsXG4gICAgICB2YWx1ZTogZnVuY3Rpb25zLmdldEl0ZW1WYWx1ZShjb2wsIHsgc2VsZWN0T3B0aW9uczogb3B0cyB9KSxcbiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbnMub25DZWxsVmFsdWVDaGFuZ2UoY29sLCBlZGl0VmFsdWVQYXJzZXIpLFxuICAgICAgaXNTZWFyY2hhYmxlOiB0cnVlLFxuICAgICAgaXNDbGVhcmFibGU6IHRydWUsXG4gICAgICB0YWJTZWxlY3RzVmFsdWU6IGZhbHNlLFxuICAgICAgdGFiSW5kZXgsXG4gICAgICAuLi5zZWxlY3RUcmFuc2xhdGlvbnMsXG4gICAgICAuLi5jb2wuZmlsdGVyQ29tcG9uZW50UHJvcHMsXG4gICAgfTtcblxuICAgIHJldHVybiBzZWxlY3RSZW5kZXIoeyAuLi5mc1Byb3BzIH0pO1xuICB9LFxufTtcbiJdfQ==