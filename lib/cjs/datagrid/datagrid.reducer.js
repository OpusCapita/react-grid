'use strict';

exports.__esModule = true;
exports.default = datagridReducer;

var _immutable = require('immutable');

var _immutable2 = _interopRequireDefault(_immutable);

var _datagrid = require('./datagrid.actions');

var _datagrid2 = require('./datagrid.constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _datagrid2.INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case _datagrid.TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_FORCE_REFRESH:
      // no need to alter redux state on force refesh
      return state;

    case _datagrid.TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], _immutable2.default.fromJS(action.config)).setIn([action.id, 'selectedItems'], _immutable2.default.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], (0, _immutable.Map)({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case _datagrid.TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], (0, _immutable.List)([_immutable2.default.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case _datagrid.TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], (0, _immutable.List)(), function (items) {
        return items.push(_immutable2.default.fromJS(action.columnDefaultValues));
      });

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_ITEM:
      return state.deleteIn([action.id, 'data', action.index]).deleteIn([action.id, 'allData', action.index]);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], (0, _immutable.List)()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], (0, _immutable.Map)({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_EXTEND_DATA:
      {
        var allData = state.getIn([action.id, 'allData']);
        var extendedData = allData.concat(action.data);
        return state.setIn([action.id, 'data'], extendedData).setIn([action.id, 'allData'], extendedData);
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = _immutable2.default.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData2 = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = _immutable2.default.fromJS(savedItemJS);
          var foundIndex = _allData2.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData2 = _allData2.push(savedItem);
          } else {
            _allData2 = _allData2.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData2).setIn([action.id, 'allData'], _allData2).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], _immutable2.default.fromJS(action.messages));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case _datagrid.TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], (0, _immutable.List)()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], (0, _immutable.List)(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)([dataId]));
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], (0, _immutable.List)()).size === state.getIn([action.id, 'data'], (0, _immutable.List)()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], (0, _immutable.List)()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], (0, _immutable.Map)({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], (0, _immutable.Map)({ isFiltering: true }));
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case _datagrid.TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case _datagrid.TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], _immutable2.default.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbImRhdGFncmlkUmVkdWNlciIsInN0YXRlIiwiSU5JVElBTF9TVEFURSIsImFjdGlvbiIsInR5cGUiLCJUWVBFUyIsIlBMQVRGT1JNX0RBVEFHUklEX0lOVkFMSURBVEUiLCJkZWxldGVJbiIsImlkIiwiUExBVEZPUk1fREFUQUdSSURfRk9SQ0VfUkVGUkVTSCIsIlBMQVRGT1JNX0RBVEFHUklEX1NFVF9EQVRBIiwic2V0SW4iLCJkYXRhIiwiSW1tdXRhYmxlIiwiZnJvbUpTIiwiY29uZmlnIiwic2VsZWN0ZWRJdGVtcyIsIm1lcmdlSW4iLCJpc0VkaXRpbmciLCJpc0NyZWF0aW5nIiwiaXNCdXN5IiwiUExBVEZPUk1fREFUQUdSSURfQlVTWSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFQURZIiwiUExBVEZPUk1fREFUQUdSSURfQVBQTFlfU09SVCIsImFsbERhdGEiLCJQTEFURk9STV9EQVRBR1JJRF9TT1JUX0NIQU5HRSIsInNvcnRDb2x1bW4iLCJzb3J0T3JkZXIiLCJQTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OIiwiY29sdW1uV2lkdGhzIiwiUExBVEZPUk1fREFUQUdSSURfRURJVCIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURSIsImNvbHVtbkRlZmF1bHRWYWx1ZXMiLCJQTEFURk9STV9EQVRBR1JJRF9BRERfTkVXX0lURU0iLCJ1cGRhdGVJbiIsIml0ZW1zIiwicHVzaCIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9JVEVNIiwiaW5kZXgiLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU0iLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU1TIiwiZ2V0SW4iLCJmaWx0ZXIiLCJ2YWwiLCJpZHgiLCJpbmRleGVzIiwiaW5kZXhPZiIsIlBMQVRGT1JNX0RBVEFHUklEX0NBTkNFTCIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkUiLCJQTEFURk9STV9EQVRBR1JJRF9FWFRFTkRfREFUQSIsImV4dGVuZGVkRGF0YSIsImNvbmNhdCIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfU1VDQ0VTUyIsInNhdmVkSXRlbXMiLCJmb3JFYWNoIiwic2F2ZWRJdGVtSlMiLCJzYXZlZEl0ZW0iLCJmb3VuZEluZGV4IiwiZmluZEluZGV4IiwiZCIsImlkS2V5UGF0aCIsIm1lcmdlRGVlcEluIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9QQVJUSUFMX1NVQ0NFU1MiLCJjcmVhdGVEYXRhIiwiZWRpdERhdGEiLCJnZXQiLCJ1bmRlZmluZWQiLCJkZWxldGUiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX0ZBSUwiLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkUiLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfU1VDQ0VTUyIsImZpbHRlck5vdCIsInJlbW92ZWRJZHMiLCJpdGVtIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX0ZBSUwiLCJQTEFURk9STV9EQVRBR1JJRF9FRElUX0NFTExfVkFMVUVfQ0hBTkdFIiwiZGF0YUlkIiwia2V5UGF0aCIsInZhbHVlIiwiUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfVkFMVUVfQ0hBTkdFIiwicm93SW5kZXgiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRSIsIm1lc3NhZ2VUeXBlIiwibWVzc2FnZUlkIiwidmFsdWVzIiwibWVzc2FnZVZhbHVlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFUyIsIm1lc3NhZ2VzIiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9ISURFX01FU1NBR0UiLCJyb3dNZXNzYWdlIiwic2l6ZSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1NIT1dfTUVTU0FHRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX0hJREVfTUVTU0FHRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0VMRUNUSU9OX0NIQU5HRSIsInNlbGVjdGVkQ2VsbCIsIlBMQVRGT1JNX0RBVEFHUklEX0lURU1fU0VMRUNUSU9OX0NIQU5HRSIsIm5ld1N0YXRlIiwic2hpZnRQcmVzc2VkIiwibGFzdFJvd0luZGV4Iiwic2VsZWN0Um93SWRzIiwiaSIsImN0cmxQcmVzc2VkIiwiUExBVEZPUk1fREFUQUdSSURfU0VMRUNUX0FMTF9JVEVNU19DSEFOR0UiLCJtYXAiLCJQTEFURk9STV9EQVRBR1JJRF9DTEVBUl9TRUxFQ1RFRF9JVEVNUyIsIlBMQVRGT1JNX0RBVEFHUklEX1RPR0dMRV9GSUxURVJJTkciLCJpc0ZpbHRlcmluZyIsIlBMQVRGT1JNX0RBVEFHUklEX0ZJTFRFUl9EQVRBX0NIQU5HRSIsImZpbHRlckRhdGEiLCJQTEFURk9STV9EQVRBR1JJRF9BUFBMWV9GSUxURVJTIiwiUExBVEZPUk1fREFUQUdSSURfVVBEQVRFX0VYSVNUSU5HX0NFTExfVkFMVUUiLCJoYXNJbiIsIlBMQVRGT1JNX0RBVEFHUklEX1NFVF9FRElUX0RBVEEiLCJjZWxsTWVzc2FnZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTiIsIlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19TQVZFIiwiY29sdW1uT3JkZXIiXSwibWFwcGluZ3MiOiI7OztrQkFJd0JBLGU7O0FBSnhCOzs7O0FBQ0E7O0FBQ0E7Ozs7QUFFZSxTQUFTQSxlQUFULEdBQXdEO0FBQUEsTUFBL0JDLEtBQStCLHVFQUF2QkMsd0JBQXVCO0FBQUEsTUFBUkMsTUFBUTs7QUFDckUsVUFBUUEsT0FBT0MsSUFBZjtBQUNFLFNBQUtDLGdCQUFNQyw0QkFBWDtBQUNFLGFBQU9MLE1BQ0pNLFFBREksQ0FDSyxDQUFDSixPQUFPSyxFQUFSLEVBQVksTUFBWixDQURMLEVBRUpELFFBRkksQ0FFSyxDQUFDSixPQUFPSyxFQUFSLEVBQVksU0FBWixDQUZMLEVBR0pELFFBSEks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QUFPbEgsTUFBTU0sUUFBTixDQUFlLENBQUNKLE9BQU9LLEVBQVIsRUFBWSxTQUFaLEVBQXVCLHFCQUF2QixDQUFmLENBQVA7O0FBRUYsU0FBS0gsZ0JBQU0rRyxzQ0FBWDtBQUNFLGFBQU9uSCxNQUNKVSxLQURJLENBQ0UsQ0FBQ1IsT0FBT0ssRUFBUixFQUFZLFFBQVosRUFBc0IsZ0JBQXRCLENBREYsRUFDMkNLLG9CQUFVQyxNQUFWLENBQWlCWCxPQUFPa0gsV0FBeEIsQ0FEM0MsQ0FBUDs7QUFHRjtBQUNFLGFBQU9wSCxLQUFQO0FBbGFKO0FBb2FEIiwiZmlsZSI6ImRhdGFncmlkLnJlZHVjZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSW1tdXRhYmxlLCB7IE1hcCwgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XG5pbXBvcnQgeyBUWVBFUyB9IGZyb20gJy4vZGF0YWdyaWQuYWN0aW9ucyc7XG5pbXBvcnQgeyBJTklUSUFMX1NUQVRFIH0gZnJvbSAnLi9kYXRhZ3JpZC5jb25zdGFudHMnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkYXRhZ3JpZFJlZHVjZXIoc3RhdGUgPSBJTklUSUFMX1NUQVRFLCBhY3Rpb24pIHtcbiAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfSU5WQUxJREFURTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRk9SQ0VfUkVGUkVTSDpcbiAgICAgIC8vIG5vIG5lZWQgdG8gYWx0ZXIgcmVkdXggc3RhdGUgb24gZm9yY2UgcmVmZXNoXG4gICAgICByZXR1cm4gc3RhdGU7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFVF9EQVRBOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBhY3Rpb24uZGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFjdGlvbi5kYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZyddLCBJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb25maWcpKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uc2VsZWN0ZWRJdGVtcykpXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcbiAgICAgICAgICBpc0VkaXRpbmc6IGZhbHNlLFxuICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLFxuICAgICAgICAgIGlzQnVzeTogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRDZWxsJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9CVVNZOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVBRFk6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQVBQTFlfU09SVDpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhY3Rpb24uYWxsRGF0YSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NPUlRfQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ3NvcnRpbmdEYXRhJ10sIE1hcCh7XG4gICAgICAgICAgc29ydENvbHVtbjogYWN0aW9uLnNvcnRDb2x1bW4sXG4gICAgICAgICAgc29ydE9yZGVyOiBhY3Rpb24uc29ydE9yZGVyLFxuICAgICAgICB9KSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFU0laRV9DT0xVTU46XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdjb2x1bW5XaWR0aHMnXSwgYWN0aW9uLmNvbHVtbldpZHRocyk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0VESVQ6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNFZGl0aW5nJ10sIHRydWUpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DUkVBVEU6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10sIExpc3QoW0ltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbHVtbkRlZmF1bHRWYWx1ZXMpXSkpXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRDZWxsJ10pXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcbiAgICAgICAgICBpc0NyZWF0aW5nOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQUREX05FV19JVEVNOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC51cGRhdGVJbihbXG4gICAgICAgICAgYWN0aW9uLmlkLFxuICAgICAgICAgICdjcmVhdGVEYXRhJyxcbiAgICAgICAgXSwgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbHVtbkRlZmF1bHRWYWx1ZXMpKSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9JVEVNOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5pbmRleF0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YScsIGFjdGlvbi5pbmRleF0pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU06XG4gICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnLCBhY3Rpb24uaW5kZXhdKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUzpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSxcbiAgICAgICAgICBzdGF0ZVxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10sIExpc3QoKSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHZhbCwgaWR4KSA9PiBhY3Rpb24uaW5kZXhlcy5pbmRleE9mKGlkeCkgPT09IC0xKSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0FOQ0VMOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIE1hcCh7XG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgfSkpXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRVhURU5EX0RBVEE6IHtcbiAgICAgIGNvbnN0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcbiAgICAgIGNvbnN0IGV4dGVuZGVkRGF0YSA9IGFsbERhdGEuY29uY2F0KGFjdGlvbi5kYXRhKTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgZXh0ZW5kZWREYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgZXh0ZW5kZWREYXRhKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfU1VDQ0VTUzoge1xuICAgICAgbGV0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcbiAgICAgIGFjdGlvbi5zYXZlZEl0ZW1zLmZvckVhY2goKHNhdmVkSXRlbUpTKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkSXRlbSA9IEltbXV0YWJsZS5mcm9tSlMoc2F2ZWRJdGVtSlMpO1xuICAgICAgICBjb25zdCBmb3VuZEluZGV4ID0gYWxsRGF0YS5maW5kSW5kZXgoZCA9PiAoXG4gICAgICAgICAgZC5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSA9PT0gc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpXG4gICAgICAgICkpO1xuICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5wdXNoKHNhdmVkSXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEubWVyZ2VEZWVwSW4oW2ZvdW5kSW5kZXhdLCBzYXZlZEl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWxsRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcbiAgICAgICAgICBpc0J1c3k6IGZhbHNlLFxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXG4gICAgICAgICAgaXNDcmVhdGluZzogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9QQVJUSUFMX1NVQ0NFU1M6IHtcbiAgICAgIGxldCBhbGxEYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSk7XG4gICAgICBsZXQgY3JlYXRlRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pO1xuICAgICAgbGV0IGVkaXREYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pO1xuICAgICAgY29uc3QgaXNDcmVhdGluZyA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQ3JlYXRpbmcnXSk7XG4gICAgICBhY3Rpb24uc2F2ZWRJdGVtcy5mb3JFYWNoKChzYXZlZEl0ZW1KUykgPT4ge1xuICAgICAgICBjb25zdCBzYXZlZEl0ZW0gPSBJbW11dGFibGUuZnJvbUpTKHNhdmVkSXRlbUpTKTtcbiAgICAgICAgbGV0IGZvdW5kSW5kZXggPSBhbGxEYXRhLmZpbmRJbmRleChkID0+IChcbiAgICAgICAgICBkLmdldEluKGFjdGlvbi5pZEtleVBhdGgpID09PSBzYXZlZEl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aClcbiAgICAgICAgKSk7XG4gICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLnB1c2goc2F2ZWRJdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5tZXJnZURlZXBJbihbZm91bmRJbmRleF0sIHNhdmVkSXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQ3JlYXRpbmcpIHtcbiAgICAgICAgICBmb3VuZEluZGV4ID0gc2F2ZWRJdGVtLmdldCgncm93SW5kZXgnKTtcbiAgICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gdW5kZWZpbmVkICYmIGZvdW5kSW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNyZWF0ZURhdGEgPSBjcmVhdGVEYXRhLmRlbGV0ZShmb3VuZEluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWRpdERhdGEgPSBlZGl0RGF0YS5kZWxldGUoc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhbGxEYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgY3JlYXRlRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddLCBlZGl0RGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFX0ZBSUw6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX1NVQ0NFU1M6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSlcbiAgICAgICAgLnVwZGF0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10sIGRhdGEgPT4gZGF0YS5maWx0ZXJOb3QoaXRlbSA9PiAoXG4gICAgICAgICAgYWN0aW9uLnJlbW92ZWRJZHMuaW5kZXhPZihpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSA+IC0xXG4gICAgICAgICkpKVxuICAgICAgICAudXBkYXRlSW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgZGF0YSA9PiBkYXRhLmZpbHRlck5vdChpdGVtID0+IChcbiAgICAgICAgICBhY3Rpb24ucmVtb3ZlZElkcy5pbmRleE9mKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpID4gLTFcbiAgICAgICAgKSkpXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX0ZBSUw6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRURJVF9DRUxMX1ZBTFVFX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2VkaXREYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfVkFMVUVfQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YScsIGFjdGlvbi5yb3dJbmRleCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICB7IGlkOiBhY3Rpb24ubWVzc2FnZUlkLCB2YWx1ZXM6IGFjdGlvbi5tZXNzYWdlVmFsdWVzIH0sXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFUzpcbiAgICAgIHJldHVybiBzdGF0ZS5tZXJnZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24ubWVzc2FnZXMpKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9ISURFX01FU1NBR0U6IHtcbiAgICAgIGlmIChhY3Rpb24ubWVzc2FnZVR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XG4gICAgICB9XG4gICAgICBpZiAoYWN0aW9uLmRhdGFJZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZV0pO1xuICAgICAgfVxuICAgICAgbGV0IHJvd01lc3NhZ2UgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkXSk7XG4gICAgICBpZiAocm93TWVzc2FnZSkge1xuICAgICAgICBpZiAoYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByb3dNZXNzYWdlID0gcm93TWVzc2FnZS5kZWxldGVJbihhY3Rpb24ua2V5UGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvd01lc3NhZ2Uuc2l6ZSA9PT0gMCB8fCAhYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkXSxcbiAgICAgICAgICByb3dNZXNzYWdlLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfU0hPV19NRVNTQUdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICB7IGlkOiBhY3Rpb24ubWVzc2FnZUlkLCB2YWx1ZXM6IGFjdGlvbi5tZXNzYWdlVmFsdWVzIH0sXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX0hJREVfTUVTU0FHRToge1xuICAgICAgaWYgKGFjdGlvbi5tZXNzYWdlVHlwZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY3Rpb24ucm93SW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGVdKTtcbiAgICAgIH1cbiAgICAgIGxldCByb3dNZXNzYWdlID0gc3RhdGUuZ2V0SW4oW1xuICAgICAgICBhY3Rpb24uaWQsXG4gICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxuICAgICAgICBhY3Rpb24ubWVzc2FnZVR5cGUsXG4gICAgICAgIGFjdGlvbi5yb3dJbmRleCxcbiAgICAgIF0pO1xuICAgICAgaWYgKHJvd01lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcm93TWVzc2FnZSA9IHJvd01lc3NhZ2UuZGVsZXRlSW4oYWN0aW9uLmtleVBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyb3dNZXNzYWdlLnNpemUgPT09IDAgfHwgIWFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFtcbiAgICAgICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxuICAgICAgICAgICAgYWN0aW9uLm1lc3NhZ2VUeXBlLFxuICAgICAgICAgICAgYWN0aW9uLnJvd0luZGV4LFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXhdLFxuICAgICAgICAgIHJvd01lc3NhZ2UsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX1NFTEVDVElPTl9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddLCBhY3Rpb24uc2VsZWN0ZWRDZWxsKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfSVRFTV9TRUxFQ1RJT05fQ0hBTkdFOiB7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2xhc3RDbGlja2VkUm93SW5kZXgnXSwgYWN0aW9uLnJvd0luZGV4KTtcblxuICAgICAgLy8gSGFuZGxlIGNhc2Ugd2hlcmUgc2hpZnQga2V5IGlzIHByZXNzZWRcbiAgICAgIC8vIFNlbGVjdCBhbGwgcm93cyBmcm9tIGxhc3RDbGlja2VkUm93IHRvIGN1cnJlbnRseSBjbGlja2VkIHJvd1xuICAgICAgaWYgKGFjdGlvbi5zaGlmdFByZXNzZWQpIHtcbiAgICAgICAgY29uc3QgbGFzdFJvd0luZGV4ID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnbGFzdENsaWNrZWRSb3dJbmRleCddLCBmYWxzZSk7XG4gICAgICAgIGlmIChsYXN0Um93SW5kZXggIT09IGZhbHNlKSB7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0Um93SWRzID0gW107XG4gICAgICAgICAgaWYgKGxhc3RSb3dJbmRleCA8IGFjdGlvbi5yb3dJbmRleCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGxhc3RSb3dJbmRleDsgaSA8PSBhY3Rpb24ucm93SW5kZXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgICAgICAgICAgaWYgKGRhdGFJZCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFjdGlvbi5yb3dJbmRleDsgaSA8PSBsYXN0Um93SW5kZXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgICAgICAgICAgaWYgKGRhdGFJZCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICAgIExpc3Qoc2VsZWN0Um93SWRzKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBzdGF0ZVxuICAgICAgICAuZ2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSwgTGlzdCgpKS5pbmRleE9mKGRhdGFJZCk7XG4gICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgaWYgKGFjdGlvbi5jdHJsUHJlc3NlZCkge1xuICAgICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgICAgLnVwZGF0ZUluKFxuICAgICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgICAgICBMaXN0KCksIGl0ZW1zID0+IGl0ZW1zLnB1c2goZGF0YUlkKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgLnNldEluKFxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICAgIExpc3QoW2RhdGFJZF0pLFxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYWN0aW9uLmN0cmxQcmVzc2VkKSB7XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgIC51cGRhdGVJbihcbiAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICBpdGVtcyA9PiBpdGVtcy5kZWxldGUoZm91bmRJbmRleCksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFTEVDVF9BTExfSVRFTVNfQ0hBTkdFOlxuICAgICAgaWYgKFxuICAgICAgICBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLCBMaXN0KCkpLnNpemVcbiAgICAgICAgPT09IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSkuc2l6ZVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICBzdGF0ZVxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSlcbiAgICAgICAgICAgIC5tYXAoaXRlbSA9PiBpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0xFQVJfU0VMRUNURURfSVRFTVM6XG4gICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1RPR0dMRV9GSUxURVJJTkc6IHtcbiAgICAgIGlmICghYWN0aW9uLmlzRmlsdGVyaW5nKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSwgTWFwKHsgaXNGaWx0ZXJpbmc6IGZhbHNlIH0pKVxuICAgICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLCBNYXAoeyBpc0ZpbHRlcmluZzogdHJ1ZSB9KSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9GSUxURVJfREFUQV9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YScsICdmaWx0ZXJEYXRhJ10sXG4gICAgICAgICAgYWN0aW9uLmZpbHRlckRhdGEsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX0ZJTFRFUlM6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdkYXRhJ10sXG4gICAgICAgICAgYWN0aW9uLmRhdGEsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1VQREFURV9FWElTVElOR19DRUxMX1ZBTFVFOiB7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnYWxsRGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICBhY3Rpb24udmFsdWUsXG4gICAgICAgICk7XG4gICAgICBpZiAoc3RhdGUuaGFzSW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0pKSB7XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgIC5zZXRJbihcbiAgICAgICAgICAgIFthY3Rpb24uaWQsICdkYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgICAgYWN0aW9uLnZhbHVlLFxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TRVRfRURJVF9EQVRBOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0VkaXRpbmcnXSwgdHJ1ZSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddLCBhY3Rpb24uZGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSwgYWN0aW9uLmNlbGxNZXNzYWdlcyk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9PUEVOOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnLCAnb3BlbiddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX0NMT1NFOlxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19TQVZFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ3Zpc2libGVDb2x1bW5zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbHVtbk9yZGVyKSk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59XG4iXX0=