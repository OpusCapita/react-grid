'use strict';

exports.__esModule = true;
exports.default = datagridReducer;

var _immutable = require('immutable');

var _immutable2 = _interopRequireDefault(_immutable);

var _datagrid = require('./datagrid.actions');

var _datagrid2 = require('./datagrid.constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _datagrid2.INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case _datagrid.TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], _immutable2.default.fromJS(action.config)).setIn([action.id, 'selectedItems'], _immutable2.default.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], (0, _immutable.Map)({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case _datagrid.TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], (0, _immutable.List)([_immutable2.default.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case _datagrid.TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], (0, _immutable.List)(), function (items) {
        return items.push(_immutable2.default.fromJS(action.columnDefaultValues));
      });

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], (0, _immutable.List)()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], (0, _immutable.Map)({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = _immutable2.default.fromJS(savedItemJS);
          var foundIndex = allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            allData = allData.push(savedItem);
          } else {
            allData = allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], allData).setIn([action.id, 'allData'], allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = _immutable2.default.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case _datagrid.TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], _immutable2.default.fromJS(action.messages));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case _datagrid.TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case _datagrid.TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], (0, _immutable.List)()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], (0, _immutable.List)(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], (0, _immutable.List)([dataId]));
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], (0, _immutable.List)()).size === state.getIn([action.id, 'data'], (0, _immutable.List)()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], (0, _immutable.List)()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case _datagrid.TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], (0, _immutable.Map)({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], (0, _immutable.Map)({ isFiltering: true }));
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case _datagrid.TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case _datagrid.TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case _datagrid.TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case _datagrid.TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], _immutable2.default.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbImRhdGFncmlkUmVkdWNlciIsInN0YXRlIiwiYWN0aW9uIiwidHlwZSIsIlBMQVRGT1JNX0RBVEFHUklEX0lOVkFMSURBVEUiLCJkZWxldGVJbiIsImlkIiwiUExBVEZPUk1fREFUQUdSSURfU0VUX0RBVEEiLCJzZXRJbiIsImRhdGEiLCJmcm9tSlMiLCJjb25maWciLCJzZWxlY3RlZEl0ZW1zIiwibWVyZ2VJbiIsImlzRWRpdGluZyIsImlzQ3JlYXRpbmciLCJpc0J1c3kiLCJQTEFURk9STV9EQVRBR1JJRF9CVVNZIiwiUExBVEZPUk1fREFUQUdSSURfUkVBRFkiLCJQTEFURk9STV9EQVRBR1JJRF9BUFBMWV9TT1JUIiwiYWxsRGF0YSIsIlBMQVRGT1JNX0RBVEFHUklEX1NPUlRfQ0hBTkdFIiwic29ydENvbHVtbiIsInNvcnRPcmRlciIsIlBMQVRGT1JNX0RBVEFHUklEX1JFU0laRV9DT0xVTU4iLCJjb2x1bW5XaWR0aHMiLCJQTEFURk9STV9EQVRBR1JJRF9FRElUIiwiUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFIiwiY29sdW1uRGVmYXVsdFZhbHVlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0FERF9ORVdfSVRFTSIsInVwZGF0ZUluIiwiaXRlbXMiLCJwdXNoIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNIiwiaW5kZXgiLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU1TIiwiZ2V0SW4iLCJmaWx0ZXIiLCJ2YWwiLCJpZHgiLCJpbmRleGVzIiwiaW5kZXhPZiIsIlBMQVRGT1JNX0RBVEFHUklEX0NBTkNFTCIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkUiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX1NVQ0NFU1MiLCJzYXZlZEl0ZW1zIiwiZm9yRWFjaCIsInNhdmVkSXRlbUpTIiwic2F2ZWRJdGVtIiwiZm91bmRJbmRleCIsImZpbmRJbmRleCIsImQiLCJpZEtleVBhdGgiLCJtZXJnZURlZXBJbiIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfUEFSVElBTF9TVUNDRVNTIiwiY3JlYXRlRGF0YSIsImVkaXREYXRhIiwiZ2V0IiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX1NVQ0NFU1MiLCJmaWx0ZXJOb3QiLCJyZW1vdmVkSWRzIiwiaXRlbSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfRURJVF9DRUxMX1ZBTFVFX0NIQU5HRSIsImRhdGFJZCIsImtleVBhdGgiLCJ2YWx1ZSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRSIsInJvd0luZGV4IiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0UiLCJtZXNzYWdlVHlwZSIsIm1lc3NhZ2VJZCIsInZhbHVlcyIsIm1lc3NhZ2VWYWx1ZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRVMiLCJtZXNzYWdlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfSElERV9NRVNTQUdFIiwicm93TWVzc2FnZSIsInNpemUiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9TSE9XX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9ISURFX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NFTEVDVElPTl9DSEFOR0UiLCJzZWxlY3RlZENlbGwiLCJQTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0UiLCJuZXdTdGF0ZSIsInNoaWZ0UHJlc3NlZCIsImxhc3RSb3dJbmRleCIsInNlbGVjdFJvd0lkcyIsImkiLCJjdHJsUHJlc3NlZCIsIlBMQVRGT1JNX0RBVEFHUklEX1NFTEVDVF9BTExfSVRFTVNfQ0hBTkdFIiwibWFwIiwiUExBVEZPUk1fREFUQUdSSURfQ0xFQVJfU0VMRUNURURfSVRFTVMiLCJQTEFURk9STV9EQVRBR1JJRF9UT0dHTEVfRklMVEVSSU5HIiwiaXNGaWx0ZXJpbmciLCJQTEFURk9STV9EQVRBR1JJRF9GSUxURVJfREFUQV9DSEFOR0UiLCJmaWx0ZXJEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfQVBQTFlfRklMVEVSUyIsIlBMQVRGT1JNX0RBVEFHUklEX1VQREFURV9FWElTVElOR19DRUxMX1ZBTFVFIiwiaGFzSW4iLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfRURJVF9EQVRBIiwiY2VsbE1lc3NhZ2VzIiwiUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX09QRU4iLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfQ0xPU0UiLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRSIsImNvbHVtbk9yZGVyIl0sIm1hcHBpbmdzIjoiOzs7a0JBSXdCQSxlOztBQUp4Qjs7OztBQUNBOztBQUNBOzs7O0FBRWUsU0FBU0EsZUFBVCxHQUF3RDtBQUFBLE1BQS9CQyxLQUErQjtBQUFBLE1BQVJDLE1BQVE7O0FBQ3JFLFVBQVFBLE9BQU9DLElBQWY7QUFDRSxTQUFLLGdCQUFNQyw0QkFBWDtBQUNFLGFBQU9ILE1BQ0pJLFFBREksQ0FDSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksTUFBWixDQURMLEVBRUpELFFBRkksQ0FFSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksU0FBWixDQUZMLEVBR0pELFFBSEksQ0FHSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksU0FBWixDQUhMLEVBSUpELFFBSkksQ0FJSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksY0FBWixDQUpMLEVBS0pELFFBTEksQ0FLSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksVUFBWixDQUxMLEVBTUpELFFBTkksQ0FNSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksWUFB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QUFPSSxFQUFSLEVBQVksU0FBWixFQUF1QixxQkFBdkIsRUFBOEMsTUFBOUMsQ0FBWixFQUFtRSxJQUFuRSxDQUFQOztBQUVGLFNBQUssZ0JBQU1xRyw2Q0FBWDtBQUNFLGFBQU8xRyxNQUFNSSxRQUFOLENBQWUsQ0FBQ0gsT0FBT0ksRUFBUixFQUFZLFNBQVosRUFBdUIscUJBQXZCLENBQWYsQ0FBUDs7QUFFRixTQUFLLGdCQUFNc0csc0NBQVg7QUFDRSxhQUFPM0csTUFDSk8sS0FESSxDQUNFLENBQUNOLE9BQU9JLEVBQVIsRUFBWSxRQUFaLEVBQXNCLGdCQUF0QixDQURGLEVBQzJDLG9CQUFVSSxNQUFWLENBQWlCUixPQUFPMkcsV0FBeEIsQ0FEM0MsQ0FBUDs7QUFHRjtBQUNFLGFBQU81RyxLQUFQO0FBalpKO0FBbVpEIiwiZmlsZSI6ImRhdGFncmlkLnJlZHVjZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSW1tdXRhYmxlLCB7IE1hcCwgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XHJcbmltcG9ydCB7IFRZUEVTIH0gZnJvbSAnLi9kYXRhZ3JpZC5hY3Rpb25zJztcclxuaW1wb3J0IHsgSU5JVElBTF9TVEFURSB9IGZyb20gJy4vZGF0YWdyaWQuY29uc3RhbnRzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGRhdGFncmlkUmVkdWNlcihzdGF0ZSA9IElOSVRJQUxfU1RBVEUsIGFjdGlvbikge1xyXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfSU5WQUxJREFURTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFVF9EQVRBOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFjdGlvbi5kYXRhKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbmZpZykpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLnNlbGVjdGVkSXRlbXMpKVxyXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcclxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGlzQnVzeTogZmFsc2UsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQlVTWTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFQURZOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQ6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBhY3Rpb24uZGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWN0aW9uLmFsbERhdGEpO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU09SVF9DSEFOR0U6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ3NvcnRpbmdEYXRhJ10sIE1hcCh7XHJcbiAgICAgICAgICBzb3J0Q29sdW1uOiBhY3Rpb24uc29ydENvbHVtbixcclxuICAgICAgICAgIHNvcnRPcmRlcjogYWN0aW9uLnNvcnRPcmRlcixcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdjb2x1bW5XaWR0aHMnXSwgYWN0aW9uLmNvbHVtbldpZHRocyk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNFZGl0aW5nJ10sIHRydWUpO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgTGlzdChbSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29sdW1uRGVmYXVsdFZhbHVlcyldKSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxyXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcclxuICAgICAgICAgIGlzQ3JlYXRpbmc6IHRydWUsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9BRERfTkVXX0lURU06XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC51cGRhdGVJbihbXHJcbiAgICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgICAnY3JlYXRlRGF0YScsXHJcbiAgICAgICAgXSwgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbHVtbkRlZmF1bHRWYWx1ZXMpKSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU06XHJcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YScsIGFjdGlvbi5pbmRleF0pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUzpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSxcclxuICAgICAgICAgIHN0YXRlXHJcbiAgICAgICAgICAgIC5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KCkpXHJcbiAgICAgICAgICAgIC5maWx0ZXIoKHZhbCwgaWR4KSA9PiBhY3Rpb24uaW5kZXhlcy5pbmRleE9mKGlkeCkgPT09IC0xKSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0FOQ0VMOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCBNYXAoe1xyXG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLFxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfU1VDQ0VTUzoge1xyXG4gICAgICBsZXQgYWxsRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pO1xyXG4gICAgICBhY3Rpb24uc2F2ZWRJdGVtcy5mb3JFYWNoKChzYXZlZEl0ZW1KUykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNhdmVkSXRlbSA9IEltbXV0YWJsZS5mcm9tSlMoc2F2ZWRJdGVtSlMpO1xyXG4gICAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBhbGxEYXRhLmZpbmRJbmRleChkID0+IChcclxuICAgICAgICAgIGQuZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IHNhdmVkSXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKVxyXG4gICAgICAgICkpO1xyXG4gICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEucHVzaChzYXZlZEl0ZW0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5tZXJnZURlZXBJbihbZm91bmRJbmRleF0sIHNhdmVkSXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFsbERhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFsbERhdGEpXHJcbiAgICAgICAgLm1lcmdlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSwge1xyXG4gICAgICAgICAgaXNCdXN5OiBmYWxzZSxcclxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9QQVJUSUFMX1NVQ0NFU1M6IHtcclxuICAgICAgbGV0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcclxuICAgICAgbGV0IGNyZWF0ZURhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKTtcclxuICAgICAgbGV0IGVkaXREYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pO1xyXG4gICAgICBjb25zdCBpc0NyZWF0aW5nID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNDcmVhdGluZyddKTtcclxuICAgICAgYWN0aW9uLnNhdmVkSXRlbXMuZm9yRWFjaCgoc2F2ZWRJdGVtSlMpID0+IHtcclxuICAgICAgICBjb25zdCBzYXZlZEl0ZW0gPSBJbW11dGFibGUuZnJvbUpTKHNhdmVkSXRlbUpTKTtcclxuICAgICAgICBsZXQgZm91bmRJbmRleCA9IGFsbERhdGEuZmluZEluZGV4KGQgPT4gKFxyXG4gICAgICAgICAgZC5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSA9PT0gc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpXHJcbiAgICAgICAgKSk7XHJcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5wdXNoKHNhdmVkSXRlbSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLm1lcmdlRGVlcEluKFtmb3VuZEluZGV4XSwgc2F2ZWRJdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzQ3JlYXRpbmcpIHtcclxuICAgICAgICAgIGZvdW5kSW5kZXggPSBzYXZlZEl0ZW0uZ2V0KCdyb3dJbmRleCcpO1xyXG4gICAgICAgICAgaWYgKGZvdW5kSW5kZXggIT09IHVuZGVmaW5lZCAmJiBmb3VuZEluZGV4ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGEgPSBjcmVhdGVEYXRhLmRlbGV0ZShmb3VuZEluZGV4KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZWRpdERhdGEgPSBlZGl0RGF0YS5kZWxldGUoc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWxsRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWxsRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgY3JlYXRlRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10sIGVkaXREYXRhKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9TVUNDRVNTOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKVxyXG4gICAgICAgIC51cGRhdGVJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBkYXRhID0+IGRhdGEuZmlsdGVyTm90KGl0ZW0gPT4gKFxyXG4gICAgICAgICAgYWN0aW9uLnJlbW92ZWRJZHMuaW5kZXhPZihpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSA+IC0xXHJcbiAgICAgICAgKSkpXHJcbiAgICAgICAgLnVwZGF0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGRhdGEgPT4gZGF0YS5maWx0ZXJOb3QoaXRlbSA9PiAoXHJcbiAgICAgICAgICBhY3Rpb24ucmVtb3ZlZElkcy5pbmRleE9mKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpID4gLTFcclxuICAgICAgICApKSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfRkFJTDpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUX0NFTExfVkFMVUVfQ0hBTkdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnZWRpdERhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXHJcbiAgICAgICAgICBhY3Rpb24udmFsdWUsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0U6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0VTOlxyXG4gICAgICByZXR1cm4gc3RhdGUubWVyZ2VJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLm1lc3NhZ2VzKSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX0hJREVfTUVTU0FHRToge1xyXG4gICAgICBpZiAoYWN0aW9uLm1lc3NhZ2VUeXBlID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFjdGlvbi5kYXRhSWQgPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZV0pO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCByb3dNZXNzYWdlID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0pO1xyXG4gICAgICBpZiAocm93TWVzc2FnZSkge1xyXG4gICAgICAgIGlmIChhY3Rpb24ua2V5UGF0aCkge1xyXG4gICAgICAgICAgcm93TWVzc2FnZSA9IHJvd01lc3NhZ2UuZGVsZXRlSW4oYWN0aW9uLmtleVBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocm93TWVzc2FnZS5zaXplID09PSAwIHx8ICFhY3Rpb24ua2V5UGF0aCkge1xyXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0sXHJcbiAgICAgICAgICByb3dNZXNzYWdlLFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfU0hPV19NRVNTQUdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfSElERV9NRVNTQUdFOiB7XHJcbiAgICAgIGlmIChhY3Rpb24ubWVzc2FnZVR5cGUgPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYWN0aW9uLnJvd0luZGV4ID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGVdKTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgcm93TWVzc2FnZSA9IHN0YXRlLmdldEluKFtcclxuICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsXHJcbiAgICAgICAgYWN0aW9uLm1lc3NhZ2VUeXBlLFxyXG4gICAgICAgIGFjdGlvbi5yb3dJbmRleCxcclxuICAgICAgXSk7XHJcbiAgICAgIGlmIChyb3dNZXNzYWdlKSB7XHJcbiAgICAgICAgaWYgKGFjdGlvbi5rZXlQYXRoKSB7XHJcbiAgICAgICAgICByb3dNZXNzYWdlID0gcm93TWVzc2FnZS5kZWxldGVJbihhY3Rpb24ua2V5UGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyb3dNZXNzYWdlLnNpemUgPT09IDAgfHwgIWFjdGlvbi5rZXlQYXRoKSB7XHJcbiAgICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW1xyXG4gICAgICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxyXG4gICAgICAgICAgICBhY3Rpb24ubWVzc2FnZVR5cGUsXHJcbiAgICAgICAgICAgIGFjdGlvbi5yb3dJbmRleCxcclxuICAgICAgICAgIF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RhdGUuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXhdLFxyXG4gICAgICAgICAgcm93TWVzc2FnZSxcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0VMRUNUSU9OX0NIQU5HRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSwgYWN0aW9uLnNlbGVjdGVkQ2VsbCk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0U6IHtcclxuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGFjdGlvbi5yb3dJbmRleCk7XHJcblxyXG4gICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSBzaGlmdCBrZXkgaXMgcHJlc3NlZFxyXG4gICAgICAvLyBTZWxlY3QgYWxsIHJvd3MgZnJvbSBsYXN0Q2xpY2tlZFJvdyB0byBjdXJyZW50bHkgY2xpY2tlZCByb3dcclxuICAgICAgaWYgKGFjdGlvbi5zaGlmdFByZXNzZWQpIHtcclxuICAgICAgICBjb25zdCBsYXN0Um93SW5kZXggPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGZhbHNlKTtcclxuICAgICAgICBpZiAobGFzdFJvd0luZGV4ICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0Um93SWRzID0gW107XHJcbiAgICAgICAgICBpZiAobGFzdFJvd0luZGV4IDwgYWN0aW9uLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBsYXN0Um93SW5kZXg7IGkgPD0gYWN0aW9uLnJvd0luZGV4OyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcclxuICAgICAgICAgICAgICBpZiAoZGF0YUlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RSb3dJZHMucHVzaChkYXRhSWQpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFjdGlvbi5yb3dJbmRleDsgaSA8PSBsYXN0Um93SW5kZXg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGRhdGFJZCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJywgaSwgLi4uYWN0aW9uLmlkS2V5UGF0aF0pO1xyXG4gICAgICAgICAgICAgIGlmIChkYXRhSWQpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICAgICAgTGlzdChzZWxlY3RSb3dJZHMpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcclxuICAgICAgY29uc3QgZm91bmRJbmRleCA9IHN0YXRlXHJcbiAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIExpc3QoKSkuaW5kZXhPZihkYXRhSWQpO1xyXG4gICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcclxuICAgICAgICBpZiAoYWN0aW9uLmN0cmxQcmVzc2VkKSB7XHJcbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgICAgLnVwZGF0ZUluKFxyXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICAgICAgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKGRhdGFJZCksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcclxuICAgICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFjdGlvbi5jdHJsUHJlc3NlZCkge1xyXG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgICAgLnVwZGF0ZUluKFxyXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgICBpdGVtcyA9PiBpdGVtcy5kZWxldGUoZm91bmRJbmRleCksXHJcbiAgICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VMRUNUX0FMTF9JVEVNU19DSEFOR0U6XHJcbiAgICAgIGlmIChcclxuICAgICAgICBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLCBMaXN0KCkpLnNpemVcclxuICAgICAgICA9PT0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgTGlzdCgpKS5zaXplXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgc3RhdGVcclxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSlcclxuICAgICAgICAgICAgLm1hcChpdGVtID0+IGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpLFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DTEVBUl9TRUxFQ1RFRF9JVEVNUzpcclxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVE9HR0xFX0ZJTFRFUklORzoge1xyXG4gICAgICBpZiAoIWFjdGlvbi5pc0ZpbHRlcmluZykge1xyXG4gICAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLCBNYXAoeyBpc0ZpbHRlcmluZzogZmFsc2UgfSkpXHJcbiAgICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSkpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSwgTWFwKHsgaXNGaWx0ZXJpbmc6IHRydWUgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRklMVEVSX0RBVEFfQ0hBTkdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnLCAnZmlsdGVyRGF0YSddLFxyXG4gICAgICAgICAgYWN0aW9uLmZpbHRlckRhdGEsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX0ZJTFRFUlM6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdkYXRhJ10sXHJcbiAgICAgICAgICBhY3Rpb24uZGF0YSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVVBEQVRFX0VYSVNUSU5HX0NFTExfVkFMVUU6IHtcclxuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdhbGxEYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxyXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxyXG4gICAgICAgICk7XHJcbiAgICAgIGlmIChzdGF0ZS5oYXNJbihbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSkpIHtcclxuICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgIC5zZXRJbihcclxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXHJcbiAgICAgICAgICAgIGFjdGlvbi52YWx1ZSxcclxuICAgICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ld1N0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VUX0VESVRfREFUQTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSwgYWN0aW9uLmRhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSwgYWN0aW9uLmNlbGxNZXNzYWdlcyk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTjpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnLCAnb3BlbiddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnXSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAndmlzaWJsZUNvbHVtbnMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29sdW1uT3JkZXIpKTtcclxuXHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgfVxyXG59XHJcbiJdfQ==