function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

import React from 'react';
import { fromJS, List } from 'immutable';
import { OverlayTrigger, Tooltip } from 'react-bootstrap';
import { FloatingSelectInfinite, FloatingSelectPortal } from '@opuscapita/react-floating-select';
import Checkbox from '@opuscapita/react-checkbox'; // TODO: cellCreate, cellEdit renderers -> multiselect dropdown as cellFilter has

var MultiValueContainer = function MultiValueContainer(label, optionsCount) {
  return function (properties) {
    return properties.selectProps.value && properties.selectProps.value.findIndex(function (selectProp) {
      return selectProp.value === properties.data.value;
    }) === 0 ? React.createElement("span", null, label.replace('<n>', "(" + properties.selectProps.value.length + "/" + optionsCount + ")")) : null;
  };
};

export default {
  valRender: function valRender(col, column, rowIndex, gridId, selectOptions, valueRender) {
    if (selectOptions === void 0) {
      selectOptions = [];
    }

    return valueRender(rowIndex, function (values) {
      // normalize values as Immutable List
      var vals = values;

      if (Array.isArray(values)) {
        vals = fromJS(values);
      }

      if (!List.isList(vals)) {
        vals = fromJS([values]);
      } // No items return empty string


      if (!vals.size) return ''; // If only one is selected render value normally

      if (vals.size === 1) {
        var option = selectOptions.find(function (o) {
          return o.value === vals.get(0);
        });
        return option ? option.label : null;
      } // Multiple values selected, render '3 selected'


      var selectedText = col.translations && col.translations.itemsSelected || 'selected';
      var valueText = React.createElement("span", null, vals.size + " " + selectedText); // without tooltip

      if (col.isMultiselectTooltipDisabled) {
        return valueText;
      } // with tooltip


      return React.createElement(OverlayTrigger, {
        placement: "top",
        overlay: React.createElement(Tooltip, {
          id: "ocDatagridMultiselectTooltip-" + gridId + "-" + column.columnKey + "-" + rowIndex
        }, React.createElement("div", {
          style: {
            textAlign: 'left'
          }
        }, selectOptions.filter(function (o) {
          return vals.includes(o.value);
        }).map(function (v) {
          return React.createElement(React.Fragment, {
            key: v.value
          }, React.createElement("span", null, v.label), React.createElement("br", null));
        }))),
        delay: 500
      }, valueText);
    });
  },
  cellFilter: function cellFilter(col, column, tabIndex, gridId, selectOptions, selectTranslations, editValueParser, functions) {
    var opts = col.filterSelectOptionsMod && selectOptions ? col.filterSelectOptionsMod(selectOptions.slice(), col) : selectOptions;
    var value = functions.getItemMultiValue(col); // eslint-disable-next-line react/prop-types

    var Option = function Option(_ref) {
      var _ref$data = _ref.data,
          checked = _ref$data.checked,
          label = _ref$data.label,
          innerProps = _ref.innerProps;
      return React.createElement("span", innerProps, React.createElement(Checkbox, {
        onChange: function onChange() {},
        label: label,
        checked: checked
      }));
    };

    var options = opts.map(function (option) {
      return _extends({}, option, {
        checked: value && value.some(function (o) {
          return option.value === o.value;
        })
      });
    });

    var fsProps = _extends({}, col.filterComponentProps, selectTranslations, {
      components: {
        MultiValueContainer: MultiValueContainer(selectTranslations.selected, (options || []).length),
        Option: Option
      },
      hideSelectedOptions: false,
      isSearchable: selectOptions && selectOptions.length > 9,
      isClearable: true,
      isMulti: true,
      name: "ocDatagridFilterInput-" + gridId + "-" + column.columnKey,
      onChange: functions.onCellMultiValueChange(col, editValueParser),
      onBlur: functions.onCellMultiValueBlur(col),
      options: options,
      tabSelectsValue: false,
      tabIndex: tabIndex,
      value: value,
      closeMenuOnSelect: false
    });

    return column.virtualized ? React.createElement(FloatingSelectInfinite, fsProps) : React.createElement(FloatingSelectPortal, fsProps);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9jb2x1bW4tc2VydmljZS9jb2x1bW4tdHlwZXMvbXVsdGlzZWxlY3QtcmVuZGVyZXJzLmpzeCJdLCJuYW1lcyI6WyJSZWFjdCIsImZyb21KUyIsIkxpc3QiLCJPdmVybGF5VHJpZ2dlciIsIlRvb2x0aXAiLCJGbG9hdGluZ1NlbGVjdEluZmluaXRlIiwiRmxvYXRpbmdTZWxlY3RQb3J0YWwiLCJDaGVja2JveCIsIk11bHRpVmFsdWVDb250YWluZXIiLCJsYWJlbCIsIm9wdGlvbnNDb3VudCIsInByb3BlcnRpZXMiLCJzZWxlY3RQcm9wcyIsInZhbHVlIiwiZmluZEluZGV4Iiwic2VsZWN0UHJvcCIsImRhdGEiLCJyZXBsYWNlIiwibGVuZ3RoIiwidmFsUmVuZGVyIiwiY29sIiwiY29sdW1uIiwicm93SW5kZXgiLCJncmlkSWQiLCJzZWxlY3RPcHRpb25zIiwidmFsdWVSZW5kZXIiLCJ2YWx1ZXMiLCJ2YWxzIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNMaXN0Iiwic2l6ZSIsIm9wdGlvbiIsImZpbmQiLCJvIiwiZ2V0Iiwic2VsZWN0ZWRUZXh0IiwidHJhbnNsYXRpb25zIiwiaXRlbXNTZWxlY3RlZCIsInZhbHVlVGV4dCIsImlzTXVsdGlzZWxlY3RUb29sdGlwRGlzYWJsZWQiLCJjb2x1bW5LZXkiLCJ0ZXh0QWxpZ24iLCJmaWx0ZXIiLCJpbmNsdWRlcyIsIm1hcCIsInYiLCJjZWxsRmlsdGVyIiwidGFiSW5kZXgiLCJzZWxlY3RUcmFuc2xhdGlvbnMiLCJlZGl0VmFsdWVQYXJzZXIiLCJmdW5jdGlvbnMiLCJvcHRzIiwiZmlsdGVyU2VsZWN0T3B0aW9uc01vZCIsInNsaWNlIiwiZ2V0SXRlbU11bHRpVmFsdWUiLCJPcHRpb24iLCJjaGVja2VkIiwiaW5uZXJQcm9wcyIsIm9wdGlvbnMiLCJzb21lIiwiZnNQcm9wcyIsImZpbHRlckNvbXBvbmVudFByb3BzIiwiY29tcG9uZW50cyIsInNlbGVjdGVkIiwiaGlkZVNlbGVjdGVkT3B0aW9ucyIsImlzU2VhcmNoYWJsZSIsImlzQ2xlYXJhYmxlIiwiaXNNdWx0aSIsIm5hbWUiLCJvbkNoYW5nZSIsIm9uQ2VsbE11bHRpVmFsdWVDaGFuZ2UiLCJvbkJsdXIiLCJvbkNlbGxNdWx0aVZhbHVlQmx1ciIsInRhYlNlbGVjdHNWYWx1ZSIsImNsb3NlTWVudU9uU2VsZWN0IiwidmlydHVhbGl6ZWQiXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBT0EsS0FBUCxNQUFrQixPQUFsQjtBQUNBLFNBQVNDLE1BQVQsRUFBaUJDLElBQWpCLFFBQTZCLFdBQTdCO0FBQ0EsU0FBU0MsY0FBVCxFQUF5QkMsT0FBekIsUUFBd0MsaUJBQXhDO0FBQ0EsU0FBU0Msc0JBQVQsRUFBaUNDLG9CQUFqQyxRQUE2RCxtQ0FBN0Q7QUFDQSxPQUFPQyxRQUFQLE1BQXFCLDRCQUFyQixDLENBRUE7O0FBRUEsSUFBTUMsbUJBQW1CLEdBQUcsU0FBdEJBLG1CQUFzQixDQUFDQyxLQUFELEVBQVFDLFlBQVI7QUFBQSxTQUF5QixVQUFBQyxVQUFVO0FBQUEsV0FBS0EsVUFBVSxDQUFDQyxXQUFYLENBQXVCQyxLQUF2QixJQUMvREYsVUFBVSxDQUFDQyxXQUFYLENBQXVCQyxLQUF2QixDQUE2QkMsU0FBN0IsQ0FDRCxVQUFBQyxVQUFVO0FBQUEsYUFBSUEsVUFBVSxDQUFDRixLQUFYLEtBQXFCRixVQUFVLENBQUNLLElBQVgsQ0FBZ0JILEtBQXpDO0FBQUEsS0FEVCxNQUVHLENBSDRELEdBSWhFLGtDQUFPSixLQUFLLENBQUNRLE9BQU4sQ0FBYyxLQUFkLFFBQXlCTixVQUFVLENBQUNDLFdBQVgsQ0FBdUJDLEtBQXZCLENBQTZCSyxNQUF0RCxTQUFnRVIsWUFBaEUsT0FBUCxDQUpnRSxHQUs5RCxJQUx5RDtBQUFBLEdBQW5DO0FBQUEsQ0FBNUI7O0FBT0EsZUFBZTtBQUNiUyxFQUFBQSxTQURhLHFCQUVYQyxHQUZXLEVBR1hDLE1BSFcsRUFJWEMsUUFKVyxFQUtYQyxNQUxXLEVBTVhDLGFBTlcsRUFPWEMsV0FQ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QVcsRUFBRSxJQVZGO0FBV1hDLE1BQUFBLE9BQU8sRUFBRSxJQVhFO0FBWVhDLE1BQUFBLElBQUksNkJBQTJCOUMsTUFBM0IsU0FBcUNGLE1BQU0sQ0FBQ29CLFNBWnJDO0FBYVg2QixNQUFBQSxRQUFRLEVBQUVuQixTQUFTLENBQUNvQixzQkFBVixDQUFpQ25ELEdBQWpDLEVBQXNDOEIsZUFBdEMsQ0FiQztBQWNYc0IsTUFBQUEsTUFBTSxFQUFFckIsU0FBUyxDQUFDc0Isb0JBQVYsQ0FBK0JyRCxHQUEvQixDQWRHO0FBZVh1QyxNQUFBQSxPQUFPLEVBQVBBLE9BZlc7QUFnQlhlLE1BQUFBLGVBQWUsRUFBRSxLQWhCTjtBQWlCWDFCLE1BQUFBLFFBQVEsRUFBUkEsUUFqQlc7QUFrQlhuQyxNQUFBQSxLQUFLLEVBQUxBLEtBbEJXO0FBbUJYOEQsTUFBQUEsaUJBQWlCLEVBQUU7QUFuQlIsTUFBYjs7QUFxQkEsV0FBT3RELE1BQU0sQ0FBQ3VELFdBQVAsR0FDSCxvQkFBQyxzQkFBRCxFQUE0QmYsT0FBNUIsQ0FERyxHQUVILG9CQUFDLG9CQUFELEVBQTBCQSxPQUExQixDQUZKO0FBR0Q7QUE3R1ksQ0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBmcm9tSlMsIExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgT3ZlcmxheVRyaWdnZXIsIFRvb2x0aXAgfSBmcm9tICdyZWFjdC1ib290c3RyYXAnO1xuaW1wb3J0IHsgRmxvYXRpbmdTZWxlY3RJbmZpbml0ZSwgRmxvYXRpbmdTZWxlY3RQb3J0YWwgfSBmcm9tICdAb3B1c2NhcGl0YS9yZWFjdC1mbG9hdGluZy1zZWxlY3QnO1xuaW1wb3J0IENoZWNrYm94IGZyb20gJ0BvcHVzY2FwaXRhL3JlYWN0LWNoZWNrYm94JztcblxuLy8gVE9ETzogY2VsbENyZWF0ZSwgY2VsbEVkaXQgcmVuZGVyZXJzIC0+IG11bHRpc2VsZWN0IGRyb3Bkb3duIGFzIGNlbGxGaWx0ZXIgaGFzXG5cbmNvbnN0IE11bHRpVmFsdWVDb250YWluZXIgPSAobGFiZWwsIG9wdGlvbnNDb3VudCkgPT4gcHJvcGVydGllcyA9PiAocHJvcGVydGllcy5zZWxlY3RQcm9wcy52YWx1ZVxuICAmJiBwcm9wZXJ0aWVzLnNlbGVjdFByb3BzLnZhbHVlLmZpbmRJbmRleChcbiAgICBzZWxlY3RQcm9wID0+IHNlbGVjdFByb3AudmFsdWUgPT09IHByb3BlcnRpZXMuZGF0YS52YWx1ZSxcbiAgKSA9PT0gMCA/IChcbiAgICA8c3Bhbj57bGFiZWwucmVwbGFjZSgnPG4+JywgYCgke3Byb3BlcnRpZXMuc2VsZWN0UHJvcHMudmFsdWUubGVuZ3RofS8ke29wdGlvbnNDb3VudH0pYCl9PC9zcGFuPlxuICApIDogbnVsbCk7XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgdmFsUmVuZGVyKFxuICAgIGNvbCxcbiAgICBjb2x1bW4sXG4gICAgcm93SW5kZXgsXG4gICAgZ3JpZElkLFxuICAgIHNlbGVjdE9wdGlvbnMgPSBbXSxcbiAgICB2YWx1ZVJlbmRlcixcbiAgKSB7XG4gICAgcmV0dXJuIHZhbHVlUmVuZGVyKHJvd0luZGV4LCAodmFsdWVzKSA9PiB7XG4gICAgICAvLyBub3JtYWxpemUgdmFsdWVzIGFzIEltbXV0YWJsZSBMaXN0XG4gICAgICBsZXQgdmFscyA9IHZhbHVlcztcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgICAgdmFscyA9IGZyb21KUyh2YWx1ZXMpO1xuICAgICAgfVxuICAgICAgaWYgKCFMaXN0LmlzTGlzdCh2YWxzKSkge1xuICAgICAgICB2YWxzID0gZnJvbUpTKFt2YWx1ZXNdKTtcbiAgICAgIH1cbiAgICAgIC8vIE5vIGl0ZW1zIHJldHVybiBlbXB0eSBzdHJpbmdcbiAgICAgIGlmICghdmFscy5zaXplKSByZXR1cm4gJyc7XG4gICAgICAvLyBJZiBvbmx5IG9uZSBpcyBzZWxlY3RlZCByZW5kZXIgdmFsdWUgbm9ybWFsbHlcbiAgICAgIGlmICh2YWxzLnNpemUgPT09IDEpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gc2VsZWN0T3B0aW9ucy5maW5kKG8gPT4gby52YWx1ZSA9PT0gdmFscy5nZXQoMCkpO1xuICAgICAgICByZXR1cm4gb3B0aW9uID8gb3B0aW9uLmxhYmVsIDogbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIE11bHRpcGxlIHZhbHVlcyBzZWxlY3RlZCwgcmVuZGVyICczIHNlbGVjdGVkJ1xuICAgICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gKGNvbC50cmFuc2xhdGlvbnMgJiYgY29sLnRyYW5zbGF0aW9ucy5pdGVtc1NlbGVjdGVkKSB8fCAnc2VsZWN0ZWQnO1xuICAgICAgY29uc3QgdmFsdWVUZXh0ID0gKFxuICAgICAgICA8c3Bhbj5cbiAgICAgICAgICB7YCR7dmFscy5zaXplfSAke3NlbGVjdGVkVGV4dH1gfVxuICAgICAgICA8L3NwYW4+XG4gICAgICApO1xuICAgICAgLy8gd2l0aG91dCB0b29sdGlwXG4gICAgICBpZiAoY29sLmlzTXVsdGlzZWxlY3RUb29sdGlwRGlzYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlVGV4dDtcbiAgICAgIH1cbiAgICAgIC8vIHdpdGggdG9vbHRpcFxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPE92ZXJsYXlUcmlnZ2VyXG4gICAgICAgICAgcGxhY2VtZW50PVwidG9wXCJcbiAgICAgICAgICBvdmVybGF5PXsoXG4gICAgICAgICAgICA8VG9vbHRpcCBpZD17YG9jRGF0YWdyaWRNdWx0aXNlbGVjdFRvb2x0aXAtJHtncmlkSWR9LSR7Y29sdW1uLmNvbHVtbktleX0tJHtyb3dJbmRleH1gfT5cbiAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICdsZWZ0JyB9fT5cbiAgICAgICAgICAgICAgICB7c2VsZWN0T3B0aW9ucy5maWx0ZXIobyA9PiB2YWxzLmluY2x1ZGVzKG8udmFsdWUpKS5tYXAodiA9PiAoXG4gICAgICAgICAgICAgICAgICA8UmVhY3QuRnJhZ21lbnQga2V5PXt2LnZhbHVlfT5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgICAgICAge3YubGFiZWx9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICApfVxuICAgICAgICAgIGRlbGF5PXs1MDB9XG4gICAgICAgID5cbiAgICAgICAgICB7dmFsdWVUZXh0fVxuICAgICAgICA8L092ZXJsYXlUcmlnZ2VyPlxuICAgICAgKTtcbiAgICB9KTtcbiAgfSxcbiAgY2VsbEZpbHRlcihcbiAgICBjb2wsXG4gICAgY29sdW1uLFxuICAgIHRhYkluZGV4LFxuICAgIGdyaWRJZCxcbiAgICBzZWxlY3RPcHRpb25zLFxuICAgIHNlbGVjdFRyYW5zbGF0aW9ucyxcbiAgICBlZGl0VmFsdWVQYXJzZXIsXG4gICAgZnVuY3Rpb25zLFxuICApIHtcbiAgICBjb25zdCBvcHRzID0gY29sLmZpbHRlclNlbGVjdE9wdGlvbnNNb2QgJiYgc2VsZWN0T3B0aW9uc1xuICAgICAgPyBjb2wuZmlsdGVyU2VsZWN0T3B0aW9uc01vZChzZWxlY3RPcHRpb25zLnNsaWNlKCksIGNvbClcbiAgICAgIDogc2VsZWN0T3B0aW9ucztcbiAgICBjb25zdCB2YWx1ZSA9IGZ1bmN0aW9ucy5nZXRJdGVtTXVsdGlWYWx1ZShjb2wpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG4gICAgY29uc3QgT3B0aW9uID0gKHsgZGF0YTogeyBjaGVja2VkLCBsYWJlbCB9LCBpbm5lclByb3BzIH0pID0+IChcbiAgICAgIDxzcGFuIHsuLi5pbm5lclByb3BzfT5cbiAgICAgICAgPENoZWNrYm94IG9uQ2hhbmdlPXsoKSA9PiB7fX0gbGFiZWw9e2xhYmVsfSBjaGVja2VkPXtjaGVja2VkfSAvPlxuICAgICAgPC9zcGFuPlxuICAgICk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdHMubWFwKFxuICAgICAgb3B0aW9uID0+ICh7IC4uLm9wdGlvbiwgY2hlY2tlZDogKHZhbHVlICYmIHZhbHVlLnNvbWUobyA9PiBvcHRpb24udmFsdWUgPT09IG8udmFsdWUpKSB9KSxcbiAgICApO1xuXG4gICAgY29uc3QgZnNQcm9wcyA9IHtcbiAgICAgIC4uLmNvbC5maWx0ZXJDb21wb25lbnRQcm9wcyxcbiAgICAgIC4uLnNlbGVjdFRyYW5zbGF0aW9ucyxcbiAgICAgIGNvbXBvbmVudHM6IHtcbiAgICAgICAgTXVsdGlWYWx1ZUNvbnRhaW5lcjogTXVsdGlWYWx1ZUNvbnRhaW5lcihzZWxlY3RUcmFuc2xhdGlvbnMuc2VsZWN0ZWQsXG4gICAgICAgICAgKG9wdGlvbnMgfHwgW10pLmxlbmd0aCksXG4gICAgICAgIE9wdGlvbixcbiAgICAgIH0sXG4gICAgICBoaWRlU2VsZWN0ZWRPcHRpb25zOiBmYWxzZSxcbiAgICAgIGlzU2VhcmNoYWJsZTogc2VsZWN0T3B0aW9ucyAmJiBzZWxlY3RPcHRpb25zLmxlbmd0aCA+IDksXG4gICAgICBpc0NsZWFyYWJsZTogdHJ1ZSxcbiAgICAgIGlzTXVsdGk6IHRydWUsXG4gICAgICBuYW1lOiBgb2NEYXRhZ3JpZEZpbHRlcklucHV0LSR7Z3JpZElkfS0ke2NvbHVtbi5jb2x1bW5LZXl9YCxcbiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbnMub25DZWxsTXVsdGlWYWx1ZUNoYW5nZShjb2wsIGVkaXRWYWx1ZVBhcnNlciksXG4gICAgICBvbkJsdXI6IGZ1bmN0aW9ucy5vbkNlbGxNdWx0aVZhbHVlQmx1cihjb2wpLFxuICAgICAgb3B0aW9ucyxcbiAgICAgIHRhYlNlbGVjdHNWYWx1ZTogZmFsc2UsXG4gICAgICB0YWJJbmRleCxcbiAgICAgIHZhbHVlLFxuICAgICAgY2xvc2VNZW51T25TZWxlY3Q6IGZhbHNlLFxuICAgIH07XG4gICAgcmV0dXJuIGNvbHVtbi52aXJ0dWFsaXplZFxuICAgICAgPyA8RmxvYXRpbmdTZWxlY3RJbmZpbml0ZSB7Li4uZnNQcm9wc30gLz5cbiAgICAgIDogPEZsb2F0aW5nU2VsZWN0UG9ydGFsIHsuLi5mc1Byb3BzfSAvPjtcbiAgfSxcbn07XG4iXX0=