import Immutable, { Map, List } from 'immutable';
import { TYPES } from './datagrid.actions';
import { INITIAL_STATE } from './datagrid.constants';

export default function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_FORCE_REFRESH:
      // no need to alter redux state on force refesh
      return state;

    case TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], Immutable.fromJS(action.config)).setIn([action.id, 'selectedItems'], Immutable.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], Map({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], List([Immutable.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], List(), function (items) {
        return items.push(Immutable.fromJS(action.columnDefaultValues));
      });

    case TYPES.PLATFORM_DATAGRID_REMOVE_ITEM:
      {
        var allDataIndex = state.getIn([action.id, 'allData'], List()).findIndex(function (item) {
          return item.getIn(action.idKeyPath) === action.rowId;
        });
        var dataIndex = state.getIn([action.id, 'data'], List()).findIndex(function (item) {
          return item.getIn(action.idKeyPath) === action.rowId;
        });
        return state.deleteIn([action.id, 'data', dataIndex]).deleteIn([action.id, 'allData', allDataIndex]).deleteIn([action.id, 'editData', action.rowId]);
      }

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], List()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], Map({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_EXTEND_DATA:
      {
        var allData = state.getIn([action.id, 'allData']);
        var extendedData = allData.concat(action.data);
        return state.setIn([action.id, 'data'], extendedData).setIn([action.id, 'allData'], extendedData);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData2 = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData2.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData2 = _allData2.push(savedItem);
          } else {
            _allData2 = _allData2.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData2).setIn([action.id, 'allData'], _allData2).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], Immutable.fromJS(action.messages));

    case TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], List(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], List()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], List(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], List([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], List([dataId]));
      }

    case TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], List()).size === state.getIn([action.id, 'data'], List()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], List()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: true }));
      }

    case TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case TYPES.PLATFORM_DATAGRID_SET_FILTERS:
      return state.setIn([action.id, 'config', 'filteringData'], action.filteringData);

    case TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], Immutable.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbIkltbXV0YWJsZSIsIk1hcCIsIkxpc3QiLCJUWVBFUyIsIklOSVRJQUxfU1RBVEUiLCJkYXRhZ3JpZFJlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInR5cGUiLCJQTEFURk9STV9EQVRBR1JJRF9JTlZBTElEQVRFIiwiZGVsZXRlSW4iLCJpZCIsIlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0giLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQSIsInNldEluIiwiZGF0YSIsImZyb21KUyIsImNvbmZpZyIsInNlbGVjdGVkSXRlbXMiLCJtZXJnZUluIiwiaXNFZGl0aW5nIiwiaXNDcmVhdGluZyIsImlzQnVzeSIsIlBMQVRGT1JNX0RBVEFHUklEX0JVU1kiLCJQTEFURk9STV9EQVRBR1JJRF9SRUFEWSIsIlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQiLCJhbGxEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfU09SVF9DSEFOR0UiLCJzb3J0Q29sdW1uIiwic29ydE9yZGVyIiwiUExBVEZPUk1fREFUQUdSSURfUkVTSVpFX0NPTFVNTiIsImNvbHVtbldpZHRocyIsIlBMQVRGT1JNX0RBVEFHUklEX0VESVQiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEUiLCJjb2x1bW5EZWZhdWx0VmFsdWVzIiwiUExBVEZPUk1fREFUQUdSSURfQUREX05FV19JVEVNIiwidXBkYXRlSW4iLCJpdGVtcyIsInB1c2giLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTSIsImFsbERhdGFJbmRleCIsImdldEluIiwiZmluZEluZGV4IiwiaXRlbSIsImlkS2V5UGF0aCIsInJvd0lkIiwiZGF0YUluZGV4IiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNIiwiaW5kZXgiLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU1TIiwiZmlsdGVyIiwidmFsIiwiaWR4IiwiaW5kZXhlcyIsImluZGV4T2YiLCJQTEFURk9STV9EQVRBR1JJRF9DQU5DRUwiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFIiwiUExBVEZPUk1fREFUQUdSSURfRVhURU5EX0RBVEEiLCJleHRlbmRlZERhdGEiLCJjb25jYXQiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX1NVQ0NFU1MiLCJzYXZlZEl0ZW1zIiwiZm9yRWFjaCIsInNhdmVkSXRlbUpTIiwic2F2ZWRJdGVtIiwiZm91bmRJbmRleCIsImQiLCJtZXJnZURlZXBJbiIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfUEFSVElBTF9TVUNDRVNTIiwiY3JlYXRlRGF0YSIsImVkaXREYXRhIiwiZ2V0IiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX1NVQ0NFU1MiLCJmaWx0ZXJOb3QiLCJyZW1vdmVkSWRzIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX0ZBSUwiLCJQTEFURk9STV9EQVRBR1JJRF9FRElUX0NFTExfVkFMVUVfQ0hBTkdFIiwiZGF0YUlkIiwia2V5UGF0aCIsInZhbHVlIiwiUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfVkFMVUVfQ0hBTkdFIiwicm93SW5kZXgiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRSIsIm1lc3NhZ2VUeXBlIiwibWVzc2FnZUlkIiwidmFsdWVzIiwibWVzc2FnZVZhbHVlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFUyIsIm1lc3NhZ2VzIiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9ISURFX01FU1NBR0UiLCJyb3dNZXNzYWdlIiwic2l6ZSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1NIT1dfTUVTU0FHRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX0hJREVfTUVTU0FHRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0VMRUNUSU9OX0NIQU5HRSIsInNlbGVjdGVkQ2VsbCIsIlBMQVRGT1JNX0RBVEFHUklEX0lURU1fU0VMRUNUSU9OX0NIQU5HRSIsIm5ld1N0YXRlIiwic2hpZnRQcmVzc2VkIiwibGFzdFJvd0luZGV4Iiwic2VsZWN0Um93SWRzIiwiaSIsImN0cmxQcmVzc2VkIiwiUExBVEZPUk1fREFUQUdSSURfU0VMRUNUX0FMTF9JVEVNU19DSEFOR0UiLCJtYXAiLCJQTEFURk9STV9EQVRBR1JJRF9DTEVBUl9TRUxFQ1RFRF9JVEVNUyIsIlBMQVRGT1JNX0RBVEFHUklEX1RPR0dMRV9GSUxURVJJTkciLCJpc0ZpbHRlcmluZyIsIlBMQVRGT1JNX0RBVEFHUklEX0ZJTFRFUl9EQVRBX0NIQU5HRSIsImZpbHRlckRhdGEiLCJQTEFURk9STV9EQVRBR1JJRF9BUFBMWV9GSUxURVJTIiwiUExBVEZPUk1fREFUQUdSSURfU0VUX0ZJTFRFUlMiLCJmaWx0ZXJpbmdEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfVVBEQVRFX0VYSVNUSU5HX0NFTExfVkFMVUUiLCJoYXNJbiIsIlBMQVRGT1JNX0RBVEFHUklEX1NFVF9FRElUX0RBVEEiLCJjZWxsTWVzc2FnZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTiIsIlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRSIsIlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19TQVZFIiwiY29sdW1uT3JkZXIiXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLFNBQVAsSUFBb0JDLEdBQXBCLEVBQXlCQyxJQUF6QixRQUFxQyxXQUFyQztBQUNBLFNBQVNDLEtBQVQsUUFBc0Isb0JBQXRCO0FBQ0EsU0FBU0MsYUFBVCxRQUE4QixzQkFBOUI7O0FBRUEsZUFBZSxTQUFTQyxlQUFULEdBQXdEO0FBQUEsTUFBL0JDLEtBQStCLHVFQUF2QkYsYUFBdUI7QUFBQSxN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QVA7O0FBR0Y7QUFDRSxhQUFPdEgsS0FBUDtBQS9hSjtBQWliRCIsImZpbGUiOiJkYXRhZ3JpZC5yZWR1Y2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEltbXV0YWJsZSwgeyBNYXAsIExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuL2RhdGFncmlkLmFjdGlvbnMnO1xuaW1wb3J0IHsgSU5JVElBTF9TVEFURSB9IGZyb20gJy4vZGF0YWdyaWQuY29uc3RhbnRzJztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZGF0YWdyaWRSZWR1Y2VyKHN0YXRlID0gSU5JVElBTF9TVEFURSwgYWN0aW9uKSB7XG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0lOVkFMSURBVEU6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0g6XG4gICAgICAvLyBubyBuZWVkIHRvIGFsdGVyIHJlZHV4IHN0YXRlIG9uIGZvcmNlIHJlZmVzaFxuICAgICAgcmV0dXJuIHN0YXRlO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhY3Rpb24uZGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29uZmlnKSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLnNlbGVjdGVkSXRlbXMpKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0J1c3k6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQlVTWTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFQURZOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQ6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFjdGlvbi5kYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWN0aW9uLmFsbERhdGEpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TT1JUX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdzb3J0aW5nRGF0YSddLCBNYXAoe1xuICAgICAgICAgIHNvcnRDb2x1bW46IGFjdGlvbi5zb3J0Q29sdW1uLFxuICAgICAgICAgIHNvcnRPcmRlcjogYWN0aW9uLnNvcnRPcmRlcixcbiAgICAgICAgfSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnY29sdW1uV2lkdGhzJ10sIGFjdGlvbi5jb2x1bW5XaWR0aHMpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KFtJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKV0pKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNDcmVhdGluZzogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FERF9ORVdfSVRFTTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAudXBkYXRlSW4oW1xuICAgICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgICAnY3JlYXRlRGF0YScsXG4gICAgICAgIF0sIExpc3QoKSwgaXRlbXMgPT4gaXRlbXMucHVzaChJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTToge1xuICAgICAgY29uc3QgYWxsRGF0YUluZGV4ID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgTGlzdCgpKVxuICAgICAgICAuZmluZEluZGV4KGl0ZW0gPT4gKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IGFjdGlvbi5yb3dJZCkpO1xuICAgICAgY29uc3QgZGF0YUluZGV4ID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgTGlzdCgpKVxuICAgICAgICAuZmluZEluZGV4KGl0ZW0gPT4gKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IGFjdGlvbi5yb3dJZCkpO1xuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZGF0YScsIGRhdGFJbmRleF0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YScsIGFsbERhdGFJbmRleF0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnLCBhY3Rpb24ucm93SWRdKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9ORVdfSVRFTTpcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YScsIGFjdGlvbi5pbmRleF0pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU1TOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLFxuICAgICAgICAgIHN0YXRlXG4gICAgICAgICAgICAuZ2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgTGlzdCgpKVxuICAgICAgICAgICAgLmZpbHRlcigodmFsLCBpZHgpID0+IGFjdGlvbi5pbmRleGVzLmluZGV4T2YoaWR4KSA9PT0gLTEpLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DQU5DRUw6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLm1lcmdlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSwgTWFwKHtcbiAgICAgICAgICBpc0VkaXRpbmc6IGZhbHNlLFxuICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLFxuICAgICAgICB9KSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCAnZXJyb3InXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCAnZXJyb3InXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkU6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIHRydWUpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FWFRFTkRfREFUQToge1xuICAgICAgY29uc3QgYWxsRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pO1xuICAgICAgY29uc3QgZXh0ZW5kZWREYXRhID0gYWxsRGF0YS5jb25jYXQoYWN0aW9uLmRhdGEpO1xuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBleHRlbmRlZERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBleHRlbmRlZERhdGEpO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9TVUNDRVNTOiB7XG4gICAgICBsZXQgYWxsRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pO1xuICAgICAgYWN0aW9uLnNhdmVkSXRlbXMuZm9yRWFjaCgoc2F2ZWRJdGVtSlMpID0+IHtcbiAgICAgICAgY29uc3Qgc2F2ZWRJdGVtID0gSW1tdXRhYmxlLmZyb21KUyhzYXZlZEl0ZW1KUyk7XG4gICAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBhbGxEYXRhLmZpbmRJbmRleChkID0+IChcbiAgICAgICAgICBkLmdldEluKGFjdGlvbi5pZEtleVBhdGgpID09PSBzYXZlZEl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aClcbiAgICAgICAgKSk7XG4gICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLnB1c2goc2F2ZWRJdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5tZXJnZURlZXBJbihbZm91bmRJbmRleF0sIHNhdmVkSXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBhbGxEYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWxsRGF0YSlcbiAgICAgICAgLm1lcmdlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSwge1xuICAgICAgICAgIGlzQnVzeTogZmFsc2UsXG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCAnZXJyb3InXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCAnZXJyb3InXSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFX1BBUlRJQUxfU1VDQ0VTUzoge1xuICAgICAgbGV0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcbiAgICAgIGxldCBjcmVhdGVEYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSk7XG4gICAgICBsZXQgZWRpdERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSk7XG4gICAgICBjb25zdCBpc0NyZWF0aW5nID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNDcmVhdGluZyddKTtcbiAgICAgIGFjdGlvbi5zYXZlZEl0ZW1zLmZvckVhY2goKHNhdmVkSXRlbUpTKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkSXRlbSA9IEltbXV0YWJsZS5mcm9tSlMoc2F2ZWRJdGVtSlMpO1xuICAgICAgICBsZXQgZm91bmRJbmRleCA9IGFsbERhdGEuZmluZEluZGV4KGQgPT4gKFxuICAgICAgICAgIGQuZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IHNhdmVkSXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKVxuICAgICAgICApKTtcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEucHVzaChzYXZlZEl0ZW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLm1lcmdlRGVlcEluKFtmb3VuZEluZGV4XSwgc2F2ZWRJdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDcmVhdGluZykge1xuICAgICAgICAgIGZvdW5kSW5kZXggPSBzYXZlZEl0ZW0uZ2V0KCdyb3dJbmRleCcpO1xuICAgICAgICAgIGlmIChmb3VuZEluZGV4ICE9PSB1bmRlZmluZWQgJiYgZm91bmRJbmRleCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY3JlYXRlRGF0YSA9IGNyZWF0ZURhdGEuZGVsZXRlKGZvdW5kSW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlZGl0RGF0YSA9IGVkaXREYXRhLmRlbGV0ZShzYXZlZEl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWxsRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBjcmVhdGVEYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10sIGVkaXREYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfRkFJTDpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkU6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIHRydWUpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfU1VDQ0VTUzpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKVxuICAgICAgICAudXBkYXRlSW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgZGF0YSA9PiBkYXRhLmZpbHRlck5vdChpdGVtID0+IChcbiAgICAgICAgICBhY3Rpb24ucmVtb3ZlZElkcy5pbmRleE9mKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpID4gLTFcbiAgICAgICAgKSkpXG4gICAgICAgIC51cGRhdGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBkYXRhID0+IGRhdGEuZmlsdGVyTm90KGl0ZW0gPT4gKFxuICAgICAgICAgIGFjdGlvbi5yZW1vdmVkSWRzLmluZGV4T2YoaXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSkgPiAtMVxuICAgICAgICApKSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfRkFJTDpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUX0NFTExfVkFMVUVfQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnZWRpdERhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9WQUxVRV9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJywgYWN0aW9uLnJvd0luZGV4LCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0VTOlxuICAgICAgcmV0dXJuIHN0YXRlLm1lcmdlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddLCBJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5tZXNzYWdlcykpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX0hJREVfTUVTU0FHRToge1xuICAgICAgaWYgKGFjdGlvbi5tZXNzYWdlVHlwZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY3Rpb24uZGF0YUlkID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlXSk7XG4gICAgICB9XG4gICAgICBsZXQgcm93TWVzc2FnZSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWRdKTtcbiAgICAgIGlmIChyb3dNZXNzYWdlKSB7XG4gICAgICAgIGlmIChhY3Rpb24ua2V5UGF0aCkge1xuICAgICAgICAgIHJvd01lc3NhZ2UgPSByb3dNZXNzYWdlLmRlbGV0ZUluKGFjdGlvbi5rZXlQYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocm93TWVzc2FnZS5zaXplID09PSAwIHx8ICFhY3Rpb24ua2V5UGF0aCkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWRdLFxuICAgICAgICAgIHJvd01lc3NhZ2UsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9TSE9XX01FU1NBR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5yb3dJbmRleCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfSElERV9NRVNTQUdFOiB7XG4gICAgICBpZiAoYWN0aW9uLm1lc3NhZ2VUeXBlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJ10pO1xuICAgICAgfVxuICAgICAgaWYgKGFjdGlvbi5yb3dJbmRleCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZV0pO1xuICAgICAgfVxuICAgICAgbGV0IHJvd01lc3NhZ2UgPSBzdGF0ZS5nZXRJbihbXG4gICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsXG4gICAgICAgIGFjdGlvbi5tZXNzYWdlVHlwZSxcbiAgICAgICAgYWN0aW9uLnJvd0luZGV4LFxuICAgICAgXSk7XG4gICAgICBpZiAocm93TWVzc2FnZSkge1xuICAgICAgICBpZiAoYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByb3dNZXNzYWdlID0gcm93TWVzc2FnZS5kZWxldGVJbihhY3Rpb24ua2V5UGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvd01lc3NhZ2Uuc2l6ZSA9PT0gMCB8fCAhYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW1xuICAgICAgICAgICAgYWN0aW9uLmlkLFxuICAgICAgICAgICAgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsXG4gICAgICAgICAgICBhY3Rpb24ubWVzc2FnZVR5cGUsXG4gICAgICAgICAgICBhY3Rpb24ucm93SW5kZXgsXG4gICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5yb3dJbmRleF0sXG4gICAgICAgICAgcm93TWVzc2FnZSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0VMRUNUSU9OX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRDZWxsJ10sIGFjdGlvbi5zZWxlY3RlZENlbGwpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0U6IHtcbiAgICAgIGNvbnN0IG5ld1N0YXRlID0gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnbGFzdENsaWNrZWRSb3dJbmRleCddLCBhY3Rpb24ucm93SW5kZXgpO1xuXG4gICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSBzaGlmdCBrZXkgaXMgcHJlc3NlZFxuICAgICAgLy8gU2VsZWN0IGFsbCByb3dzIGZyb20gbGFzdENsaWNrZWRSb3cgdG8gY3VycmVudGx5IGNsaWNrZWQgcm93XG4gICAgICBpZiAoYWN0aW9uLnNoaWZ0UHJlc3NlZCkge1xuICAgICAgICBjb25zdCBsYXN0Um93SW5kZXggPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGZhbHNlKTtcbiAgICAgICAgaWYgKGxhc3RSb3dJbmRleCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICBjb25zdCBzZWxlY3RSb3dJZHMgPSBbXTtcbiAgICAgICAgICBpZiAobGFzdFJvd0luZGV4IDwgYWN0aW9uLnJvd0luZGV4KSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gbGFzdFJvd0luZGV4OyBpIDw9IGFjdGlvbi5yb3dJbmRleDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGRhdGFJZCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJywgaSwgLi4uYWN0aW9uLmlkS2V5UGF0aF0pO1xuICAgICAgICAgICAgICBpZiAoZGF0YUlkKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0Um93SWRzLnB1c2goZGF0YUlkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gYWN0aW9uLnJvd0luZGV4OyBpIDw9IGxhc3RSb3dJbmRleDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGRhdGFJZCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJywgaSwgLi4uYWN0aW9uLmlkS2V5UGF0aF0pO1xuICAgICAgICAgICAgICBpZiAoZGF0YUlkKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0Um93SWRzLnB1c2goZGF0YUlkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAgIC5zZXRJbihcbiAgICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICAgICAgTGlzdChzZWxlY3RSb3dJZHMpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5yb3dJbmRleCwgLi4uYWN0aW9uLmlkS2V5UGF0aF0pO1xuICAgICAgY29uc3QgZm91bmRJbmRleCA9IHN0YXRlXG4gICAgICAgIC5nZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLCBMaXN0KCkpLmluZGV4T2YoZGF0YUlkKTtcbiAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xuICAgICAgICBpZiAoYWN0aW9uLmN0cmxQcmVzc2VkKSB7XG4gICAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgICAudXBkYXRlSW4oXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICAgIExpc3QoKSwgaXRlbXMgPT4gaXRlbXMucHVzaChkYXRhSWQpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgICAgTGlzdChbZGF0YUlkXSksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY3Rpb24uY3RybFByZXNzZWQpIHtcbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgLnVwZGF0ZUluKFxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICAgIGl0ZW1zID0+IGl0ZW1zLmRlbGV0ZShmb3VuZEluZGV4KSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgIExpc3QoW2RhdGFJZF0pLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VMRUNUX0FMTF9JVEVNU19DSEFOR0U6XG4gICAgICBpZiAoXG4gICAgICAgIHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIExpc3QoKSkuc2l6ZVxuICAgICAgICA9PT0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgTGlzdCgpKS5zaXplXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgIHN0YXRlXG4gICAgICAgICAgICAuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgTGlzdCgpKVxuICAgICAgICAgICAgLm1hcChpdGVtID0+IGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DTEVBUl9TRUxFQ1RFRF9JVEVNUzpcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVE9HR0xFX0ZJTFRFUklORzoge1xuICAgICAgaWYgKCFhY3Rpb24uaXNGaWx0ZXJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLCBNYXAoeyBpc0ZpbHRlcmluZzogZmFsc2UgfSkpXG4gICAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdmaWx0ZXJpbmdEYXRhJ10sIE1hcCh7IGlzRmlsdGVyaW5nOiB0cnVlIH0pKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0ZJTFRFUl9EQVRBX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdmaWx0ZXJpbmdEYXRhJywgJ2ZpbHRlckRhdGEnXSxcbiAgICAgICAgICBhY3Rpb24uZmlsdGVyRGF0YSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQVBQTFlfRklMVEVSUzpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2RhdGEnXSxcbiAgICAgICAgICBhY3Rpb24uZGF0YSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VUX0ZJTFRFUlM6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLFxuICAgICAgICAgIGFjdGlvbi5maWx0ZXJpbmdEYXRhLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9VUERBVEVfRVhJU1RJTkdfQ0VMTF9WQUxVRToge1xuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2FsbERhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxuICAgICAgICApO1xuICAgICAgaWYgKHN0YXRlLmhhc0luKFthY3Rpb24uaWQsICdkYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdKSkge1xuICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ld1N0YXRlO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VUX0VESVRfREFUQTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNFZGl0aW5nJ10sIHRydWUpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10sIGFjdGlvbi5jZWxsTWVzc2FnZXMpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTjpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdjb2x1bW5TZXR0aW5nc01vZGFsJywgJ29wZW4nXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRTpcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdjb2x1bW5TZXR0aW5nc01vZGFsJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICd2aXNpYmxlQ29sdW1ucyddLCBJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5PcmRlcikpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgfVxufVxuIl19