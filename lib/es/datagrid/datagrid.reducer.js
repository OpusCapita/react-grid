import Immutable, { Map, List } from 'immutable';
import { TYPES } from './datagrid.actions';
import { INITIAL_STATE } from './datagrid.constants';

export default function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_FORCE_REFRESH:
      // no need to alter redux state on force refesh
      return state;

    case TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], Immutable.fromJS(action.config)).setIn([action.id, 'selectedItems'], Immutable.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], Map({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], List([Immutable.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], List(), function (items) {
        return items.push(Immutable.fromJS(action.columnDefaultValues));
      });

    case TYPES.PLATFORM_DATAGRID_REMOVE_ITEM:
      return state.deleteIn([action.id, 'data', action.index]).deleteIn([action.id, 'allData', action.index]);

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], List()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], Map({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_EXTEND_DATA:
      {
        var allData = state.getIn([action.id, 'allData']);
        var extendedData = allData.concat(action.data);
        return state.setIn([action.id, 'data'], extendedData).setIn([action.id, 'allData'], extendedData);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData2 = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData2.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData2 = _allData2.push(savedItem);
          } else {
            _allData2 = _allData2.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData2).setIn([action.id, 'allData'], _allData2).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], Immutable.fromJS(action.messages));

    case TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], List(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], List()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], List(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], List([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], List([dataId]));
      }

    case TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], List()).size === state.getIn([action.id, 'data'], List()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], List()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: true }));
      }

    case TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], Immutable.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbIkltbXV0YWJsZSIsIk1hcCIsIkxpc3QiLCJUWVBFUyIsIklOSVRJQUxfU1RBVEUiLCJkYXRhZ3JpZFJlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInR5cGUiLCJQTEFURk9STV9EQVRBR1JJRF9JTlZBTElEQVRFIiwiZGVsZXRlSW4iLCJpZCIsIlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0giLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQSIsInNldEluIiwiZGF0YSIsImZyb21KUyIsImNvbmZpZyIsInNlbGVjdGVkSXRlbXMiLCJtZXJnZUluIiwiaXNFZGl0aW5nIiwiaXNDcmVhdGluZyIsImlzQnVzeSIsIlBMQVRGT1JNX0RBVEFHUklEX0JVU1kiLCJQTEFURk9STV9EQVRBR1JJRF9SRUFEWSIsIlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQiLCJhbGxEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfU09SVF9DSEFOR0UiLCJzb3J0Q29sdW1uIiwic29ydE9yZGVyIiwiUExBVEZPUk1fREFUQUdSSURfUkVTSVpFX0NPTFVNTiIsImNvbHVtbldpZHRocyIsIlBMQVRGT1JNX0RBVEFHUklEX0VESVQiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEUiLCJjb2x1bW5EZWZhdWx0VmFsdWVzIiwiUExBVEZPUk1fREFUQUdSSURfQUREX05FV19JVEVNIiwidXBkYXRlSW4iLCJpdGVtcyIsInB1c2giLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTSIsImluZGV4IiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUyIsImdldEluIiwiZmlsdGVyIiwidmFsIiwiaWR4IiwiaW5kZXhlcyIsImluZGV4T2YiLCJQTEFURk9STV9EQVRBR1JJRF9DQU5DRUwiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFIiwiUExBVEZPUk1fREFUQUdSSURfRVhURU5EX0RBVEEiLCJleHRlbmRlZERhdGEiLCJjb25jYXQiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX1NVQ0NFU1MiLCJzYXZlZEl0ZW1zIiwiZm9yRWFjaCIsInNhdmVkSXRlbUpTIiwic2F2ZWRJdGVtIiwiZm91bmRJbmRleCIsImZpbmRJbmRleCIsImQiLCJpZEtleVBhdGgiLCJtZXJnZURlZXBJbiIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfUEFSVElBTF9TVUNDRVNTIiwiY3JlYXRlRGF0YSIsImVkaXREYXRhIiwiZ2V0IiwidW5kZWZpbmVkIiwiZGVsZXRlIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX1NVQ0NFU1MiLCJmaWx0ZXJOb3QiLCJyZW1vdmVkSWRzIiwiaXRlbSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfRURJVF9DRUxMX1ZBTFVFX0NIQU5HRSIsImRhdGFJZCIsImtleVBhdGgiLCJ2YWx1ZSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRSIsInJvd0luZGV4IiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0UiLCJtZXNzYWdlVHlwZSIsIm1lc3NhZ2VJZCIsInZhbHVlcyIsIm1lc3NhZ2VWYWx1ZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRVMiLCJtZXNzYWdlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfSElERV9NRVNTQUdFIiwicm93TWVzc2FnZSIsInNpemUiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9TSE9XX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9ISURFX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NFTEVDVElPTl9DSEFOR0UiLCJzZWxlY3RlZENlbGwiLCJQTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0UiLCJuZXdTdGF0ZSIsInNoaWZ0UHJlc3NlZCIsImxhc3RSb3dJbmRleCIsInNlbGVjdFJvd0lkcyIsImkiLCJjdHJsUHJlc3NlZCIsIlBMQVRGT1JNX0RBVEFHUklEX1NFTEVDVF9BTExfSVRFTVNfQ0hBTkdFIiwibWFwIiwiUExBVEZPUk1fREFUQUdSSURfQ0xFQVJfU0VMRUNURURfSVRFTVMiLCJQTEFURk9STV9EQVRBR1JJRF9UT0dHTEVfRklMVEVSSU5HIiwiaXNGaWx0ZXJpbmciLCJQTEFURk9STV9EQVRBR1JJRF9GSUxURVJfREFUQV9DSEFOR0UiLCJmaWx0ZXJEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfQVBQTFlfRklMVEVSUyIsIlBMQVRGT1JNX0RBVEFHUklEX1VQREFURV9FWElTVElOR19DRUxMX1ZBTFVFIiwiaGFzSW4iLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfRURJVF9EQVRBIiwiY2VsbE1lc3NhZ2VzIiwiUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX09QRU4iLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfQ0xPU0UiLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRSIsImNvbHVtbk9yZGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxTQUFQLElBQW9CQyxHQUFwQixFQUF5QkMsSUFBekIsUUFBcUMsV0FBckM7QUFDQSxTQUFTQyxLQUFULFFBQXNCLG9CQUF0QjtBQUNBLFNBQVNDLGFBQVQsUUFBOEIsc0JBQTlCOztBQUVBLGVBQWUsU0FBU0MsZUFBVCxHQUF3RDtBQUFBLE1BQS9CQyxLQUErQix1RUFBdkJGLGFBQXVCO0FBQUEsTUFBUkcsTUFBUTs7QUFDckUsVUFBUUEsT0FBT0MsSUFBZjtBQUNFLFNBQUtMLE1BQU1NLDRCQUFYO0FBQ0UsYUFBT0gsTUFDSkksUUFESSxDQUNL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QUFtRSxJQUFuRSxDQUFQOztBQUVGLFNBQUtSLE1BQU1rSCw2Q0FBWDtBQUNFLGFBQU8vRyxNQUFNSSxRQUFOLENBQWUsQ0FBQ0gsT0FBT0ksRUFBUixFQUFZLFNBQVosRUFBdUIscUJBQXZCLENBQWYsQ0FBUDs7QUFFRixTQUFLUixNQUFNbUgsc0NBQVg7QUFDRSxhQUFPaEgsTUFDSlEsS0FESSxDQUNFLENBQUNQLE9BQU9JLEVBQVIsRUFBWSxRQUFaLEVBQXNCLGdCQUF0QixDQURGLEVBQzJDWCxVQUFVZ0IsTUFBVixDQUFpQlQsT0FBT2dILFdBQXhCLENBRDNDLENBQVA7O0FBR0Y7QUFDRSxhQUFPakgsS0FBUDtBQWxhSjtBQW9hRCIsImZpbGUiOiJkYXRhZ3JpZC5yZWR1Y2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEltbXV0YWJsZSwgeyBNYXAsIExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuL2RhdGFncmlkLmFjdGlvbnMnO1xuaW1wb3J0IHsgSU5JVElBTF9TVEFURSB9IGZyb20gJy4vZGF0YWdyaWQuY29uc3RhbnRzJztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZGF0YWdyaWRSZWR1Y2VyKHN0YXRlID0gSU5JVElBTF9TVEFURSwgYWN0aW9uKSB7XG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0lOVkFMSURBVEU6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0g6XG4gICAgICAvLyBubyBuZWVkIHRvIGFsdGVyIHJlZHV4IHN0YXRlIG9uIGZvcmNlIHJlZmVzaFxuICAgICAgcmV0dXJuIHN0YXRlO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhY3Rpb24uZGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29uZmlnKSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLnNlbGVjdGVkSXRlbXMpKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0J1c3k6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQlVTWTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFQURZOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQ6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFjdGlvbi5kYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWN0aW9uLmFsbERhdGEpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TT1JUX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdzb3J0aW5nRGF0YSddLCBNYXAoe1xuICAgICAgICAgIHNvcnRDb2x1bW46IGFjdGlvbi5zb3J0Q29sdW1uLFxuICAgICAgICAgIHNvcnRPcmRlcjogYWN0aW9uLnNvcnRPcmRlcixcbiAgICAgICAgfSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnY29sdW1uV2lkdGhzJ10sIGFjdGlvbi5jb2x1bW5XaWR0aHMpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KFtJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKV0pKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNDcmVhdGluZzogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FERF9ORVdfSVRFTTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAudXBkYXRlSW4oW1xuICAgICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgICAnY3JlYXRlRGF0YScsXG4gICAgICAgIF0sIExpc3QoKSwgaXRlbXMgPT4gaXRlbXMucHVzaChJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uaW5kZXhdKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnLCBhY3Rpb24uaW5kZXhdKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNOlxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJywgYWN0aW9uLmluZGV4XSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9ORVdfSVRFTVM6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10sXG4gICAgICAgICAgc3RhdGVcbiAgICAgICAgICAgIC5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KCkpXG4gICAgICAgICAgICAuZmlsdGVyKCh2YWwsIGlkeCkgPT4gYWN0aW9uLmluZGV4ZXMuaW5kZXhPZihpZHgpID09PSAtMSksXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NBTkNFTDpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCBNYXAoe1xuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXG4gICAgICAgICAgaXNDcmVhdGluZzogZmFsc2UsXG4gICAgICAgIH0pKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsICdlcnJvciddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0VYVEVORF9EQVRBOiB7XG4gICAgICBjb25zdCBhbGxEYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSk7XG4gICAgICBjb25zdCBleHRlbmRlZERhdGEgPSBhbGxEYXRhLmNvbmNhdChhY3Rpb24uZGF0YSk7XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGV4dGVuZGVkRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGV4dGVuZGVkRGF0YSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFX1NVQ0NFU1M6IHtcbiAgICAgIGxldCBhbGxEYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSk7XG4gICAgICBhY3Rpb24uc2F2ZWRJdGVtcy5mb3JFYWNoKChzYXZlZEl0ZW1KUykgPT4ge1xuICAgICAgICBjb25zdCBzYXZlZEl0ZW0gPSBJbW11dGFibGUuZnJvbUpTKHNhdmVkSXRlbUpTKTtcbiAgICAgICAgY29uc3QgZm91bmRJbmRleCA9IGFsbERhdGEuZmluZEluZGV4KGQgPT4gKFxuICAgICAgICAgIGQuZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IHNhdmVkSXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKVxuICAgICAgICApKTtcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEucHVzaChzYXZlZEl0ZW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLm1lcmdlRGVlcEluKFtmb3VuZEluZGV4XSwgc2F2ZWRJdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhbGxEYXRhKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNCdXN5OiBmYWxzZSxcbiAgICAgICAgICBpc0VkaXRpbmc6IGZhbHNlLFxuICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsICdlcnJvciddKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfUEFSVElBTF9TVUNDRVNTOiB7XG4gICAgICBsZXQgYWxsRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pO1xuICAgICAgbGV0IGNyZWF0ZURhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKTtcbiAgICAgIGxldCBlZGl0RGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKTtcbiAgICAgIGNvbnN0IGlzQ3JlYXRpbmcgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0NyZWF0aW5nJ10pO1xuICAgICAgYWN0aW9uLnNhdmVkSXRlbXMuZm9yRWFjaCgoc2F2ZWRJdGVtSlMpID0+IHtcbiAgICAgICAgY29uc3Qgc2F2ZWRJdGVtID0gSW1tdXRhYmxlLmZyb21KUyhzYXZlZEl0ZW1KUyk7XG4gICAgICAgIGxldCBmb3VuZEluZGV4ID0gYWxsRGF0YS5maW5kSW5kZXgoZCA9PiAoXG4gICAgICAgICAgZC5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSA9PT0gc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpXG4gICAgICAgICkpO1xuICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5wdXNoKHNhdmVkSXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEubWVyZ2VEZWVwSW4oW2ZvdW5kSW5kZXhdLCBzYXZlZEl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0NyZWF0aW5nKSB7XG4gICAgICAgICAgZm91bmRJbmRleCA9IHNhdmVkSXRlbS5nZXQoJ3Jvd0luZGV4Jyk7XG4gICAgICAgICAgaWYgKGZvdW5kSW5kZXggIT09IHVuZGVmaW5lZCAmJiBmb3VuZEluZGV4ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjcmVhdGVEYXRhID0gY3JlYXRlRGF0YS5kZWxldGUoZm91bmRJbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVkaXREYXRhID0gZWRpdERhdGEuZGVsZXRlKHNhdmVkSXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBhbGxEYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWxsRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10sIGNyZWF0ZURhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSwgZWRpdERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9TVUNDRVNTOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpXG4gICAgICAgIC51cGRhdGVJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBkYXRhID0+IGRhdGEuZmlsdGVyTm90KGl0ZW0gPT4gKFxuICAgICAgICAgIGFjdGlvbi5yZW1vdmVkSWRzLmluZGV4T2YoaXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSkgPiAtMVxuICAgICAgICApKSlcbiAgICAgICAgLnVwZGF0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGRhdGEgPT4gZGF0YS5maWx0ZXJOb3QoaXRlbSA9PiAoXG4gICAgICAgICAgYWN0aW9uLnJlbW92ZWRJZHMuaW5kZXhPZihpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSA+IC0xXG4gICAgICAgICkpKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9GQUlMOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0VESVRfQ0VMTF9WQUxVRV9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdlZGl0RGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICBhY3Rpb24udmFsdWUsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICBhY3Rpb24udmFsdWUsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgeyBpZDogYWN0aW9uLm1lc3NhZ2VJZCwgdmFsdWVzOiBhY3Rpb24ubWVzc2FnZVZhbHVlcyB9LFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRVM6XG4gICAgICByZXR1cm4gc3RhdGUubWVyZ2VJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLm1lc3NhZ2VzKSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfSElERV9NRVNTQUdFOiB7XG4gICAgICBpZiAoYWN0aW9uLm1lc3NhZ2VUeXBlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10pO1xuICAgICAgfVxuICAgICAgaWYgKGFjdGlvbi5kYXRhSWQgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGVdKTtcbiAgICAgIH1cbiAgICAgIGxldCByb3dNZXNzYWdlID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0pO1xuICAgICAgaWYgKHJvd01lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcm93TWVzc2FnZSA9IHJvd01lc3NhZ2UuZGVsZXRlSW4oYWN0aW9uLmtleVBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyb3dNZXNzYWdlLnNpemUgPT09IDAgfHwgIWFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWRdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhdGUuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0sXG4gICAgICAgICAgcm93TWVzc2FnZSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1NIT1dfTUVTU0FHRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLnJvd0luZGV4LCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgeyBpZDogYWN0aW9uLm1lc3NhZ2VJZCwgdmFsdWVzOiBhY3Rpb24ubWVzc2FnZVZhbHVlcyB9LFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9ISURFX01FU1NBR0U6IHtcbiAgICAgIGlmIChhY3Rpb24ubWVzc2FnZVR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSk7XG4gICAgICB9XG4gICAgICBpZiAoYWN0aW9uLnJvd0luZGV4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlXSk7XG4gICAgICB9XG4gICAgICBsZXQgcm93TWVzc2FnZSA9IHN0YXRlLmdldEluKFtcbiAgICAgICAgYWN0aW9uLmlkLFxuICAgICAgICAnY3JlYXRlQ2VsbE1lc3NhZ2VzJyxcbiAgICAgICAgYWN0aW9uLm1lc3NhZ2VUeXBlLFxuICAgICAgICBhY3Rpb24ucm93SW5kZXgsXG4gICAgICBdKTtcbiAgICAgIGlmIChyb3dNZXNzYWdlKSB7XG4gICAgICAgIGlmIChhY3Rpb24ua2V5UGF0aCkge1xuICAgICAgICAgIHJvd01lc3NhZ2UgPSByb3dNZXNzYWdlLmRlbGV0ZUluKGFjdGlvbi5rZXlQYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocm93TWVzc2FnZS5zaXplID09PSAwIHx8ICFhY3Rpb24ua2V5UGF0aCkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbXG4gICAgICAgICAgICBhY3Rpb24uaWQsXG4gICAgICAgICAgICAnY3JlYXRlQ2VsbE1lc3NhZ2VzJyxcbiAgICAgICAgICAgIGFjdGlvbi5tZXNzYWdlVHlwZSxcbiAgICAgICAgICAgIGFjdGlvbi5yb3dJbmRleCxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhdGUuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLnJvd0luZGV4XSxcbiAgICAgICAgICByb3dNZXNzYWdlLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TRUxFQ1RJT05fQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSwgYWN0aW9uLnNlbGVjdGVkQ2VsbCk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0lURU1fU0VMRUNUSU9OX0NIQU5HRToge1xuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGFjdGlvbi5yb3dJbmRleCk7XG5cbiAgICAgIC8vIEhhbmRsZSBjYXNlIHdoZXJlIHNoaWZ0IGtleSBpcyBwcmVzc2VkXG4gICAgICAvLyBTZWxlY3QgYWxsIHJvd3MgZnJvbSBsYXN0Q2xpY2tlZFJvdyB0byBjdXJyZW50bHkgY2xpY2tlZCByb3dcbiAgICAgIGlmIChhY3Rpb24uc2hpZnRQcmVzc2VkKSB7XG4gICAgICAgIGNvbnN0IGxhc3RSb3dJbmRleCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2xhc3RDbGlja2VkUm93SW5kZXgnXSwgZmFsc2UpO1xuICAgICAgICBpZiAobGFzdFJvd0luZGV4ICE9PSBmYWxzZSkge1xuICAgICAgICAgIGNvbnN0IHNlbGVjdFJvd0lkcyA9IFtdO1xuICAgICAgICAgIGlmIChsYXN0Um93SW5kZXggPCBhY3Rpb24ucm93SW5kZXgpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBsYXN0Um93SW5kZXg7IGkgPD0gYWN0aW9uLnJvd0luZGV4OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBpLCAuLi5hY3Rpb24uaWRLZXlQYXRoXSk7XG4gICAgICAgICAgICAgIGlmIChkYXRhSWQpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RSb3dJZHMucHVzaChkYXRhSWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBhY3Rpb24ucm93SW5kZXg7IGkgPD0gbGFzdFJvd0luZGV4OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBpLCAuLi5hY3Rpb24uaWRLZXlQYXRoXSk7XG4gICAgICAgICAgICAgIGlmIChkYXRhSWQpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RSb3dJZHMucHVzaChkYXRhSWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgICAgLnNldEluKFxuICAgICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgICAgICBMaXN0KHNlbGVjdFJvd0lkcyksXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGFJZCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJywgYWN0aW9uLnJvd0luZGV4LCAuLi5hY3Rpb24uaWRLZXlQYXRoXSk7XG4gICAgICBjb25zdCBmb3VuZEluZGV4ID0gc3RhdGVcbiAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIExpc3QoKSkuaW5kZXhPZihkYXRhSWQpO1xuICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSB7XG4gICAgICAgIGlmIChhY3Rpb24uY3RybFByZXNzZWQpIHtcbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAgIC51cGRhdGVJbihcbiAgICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICAgICAgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKGRhdGFJZCksXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgIC5zZXRJbihcbiAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGFjdGlvbi5jdHJsUHJlc3NlZCkge1xuICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAudXBkYXRlSW4oXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgICAgaXRlbXMgPT4gaXRlbXMuZGVsZXRlKGZvdW5kSW5kZXgpLFxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgTGlzdChbZGF0YUlkXSksXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TRUxFQ1RfQUxMX0lURU1TX0NIQU5HRTpcbiAgICAgIGlmIChcbiAgICAgICAgc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSwgTGlzdCgpKS5zaXplXG4gICAgICAgID09PSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBMaXN0KCkpLnNpemVcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgc3RhdGVcbiAgICAgICAgICAgIC5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBMaXN0KCkpXG4gICAgICAgICAgICAubWFwKGl0ZW0gPT4gaXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSksXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NMRUFSX1NFTEVDVEVEX0lURU1TOlxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9UT0dHTEVfRklMVEVSSU5HOiB7XG4gICAgICBpZiAoIWFjdGlvbi5pc0ZpbHRlcmluZykge1xuICAgICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdmaWx0ZXJpbmdEYXRhJ10sIE1hcCh7IGlzRmlsdGVyaW5nOiBmYWxzZSB9KSlcbiAgICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSwgTWFwKHsgaXNGaWx0ZXJpbmc6IHRydWUgfSkpO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRklMVEVSX0RBVEFfQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnLCAnZmlsdGVyRGF0YSddLFxuICAgICAgICAgIGFjdGlvbi5maWx0ZXJEYXRhLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9BUFBMWV9GSUxURVJTOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnZGF0YSddLFxuICAgICAgICAgIGFjdGlvbi5kYXRhLFxuICAgICAgICApO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9VUERBVEVfRVhJU1RJTkdfQ0VMTF9WQUxVRToge1xuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2FsbERhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxuICAgICAgICApO1xuICAgICAgaWYgKHN0YXRlLmhhc0luKFthY3Rpb24uaWQsICdkYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdKSkge1xuICAgICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ld1N0YXRlO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VUX0VESVRfREFUQTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNFZGl0aW5nJ10sIHRydWUpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10sIGFjdGlvbi5jZWxsTWVzc2FnZXMpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTjpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdjb2x1bW5TZXR0aW5nc01vZGFsJywgJ29wZW4nXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRTpcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdjb2x1bW5TZXR0aW5nc01vZGFsJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICd2aXNpYmxlQ29sdW1ucyddLCBJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5PcmRlcikpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgfVxufVxuIl19