import Immutable, { Map, List } from 'immutable';
import { TYPES } from './datagrid.actions';
import { INITIAL_STATE } from './datagrid.constants';

export default function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_FORCE_REFRESH:
      // no need to alter redux state on force refesh
      return state;

    case TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], Immutable.fromJS(action.config)).setIn([action.id, 'selectedItems'], Immutable.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], Map({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], List([Immutable.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], List(), function (items) {
        return items.push(Immutable.fromJS(action.columnDefaultValues));
      });

    case TYPES.PLATFORM_DATAGRID_REMOVE_ITEM:
      {
        var itemId = state.getIn([action.id, 'data', action.index].concat(action.idKeyPath));
        var allDataIndex = state.getIn([action.id, 'allData'], List()).findIndex(function (item) {
          return item.getIn(action.idKeyPath) === itemId;
        });
        return state.deleteIn([action.id, 'data', action.index]).deleteIn([action.id, 'allData', allDataIndex]).deleteIn([action.id, 'editData', itemId]);
      }

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], List()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], Map({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_EXTEND_DATA:
      {
        var allData = state.getIn([action.id, 'allData']);
        var extendedData = allData.concat(action.data);
        return state.setIn([action.id, 'data'], extendedData).setIn([action.id, 'allData'], extendedData);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData2 = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData2.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData2 = _allData2.push(savedItem);
          } else {
            _allData2 = _allData2.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData2).setIn([action.id, 'allData'], _allData2).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], Immutable.fromJS(action.messages));

    case TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], List(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], List()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], List(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], List([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], List([dataId]));
      }

    case TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], List()).size === state.getIn([action.id, 'data'], List()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], List()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: true }));
      }

    case TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case TYPES.PLATFORM_DATAGRID_SET_FILTERS:
      return state.setIn([action.id, 'config', 'filteringData'], action.filteringData);

    case TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], Immutable.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbIkltbXV0YWJsZSIsIk1hcCIsIkxpc3QiLCJUWVBFUyIsIklOSVRJQUxfU1RBVEUiLCJkYXRhZ3JpZFJlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInR5cGUiLCJQTEFURk9STV9EQVRBR1JJRF9JTlZBTElEQVRFIiwiZGVsZXRlSW4iLCJpZCIsIlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0giLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQSIsInNldEluIiwiZGF0YSIsImZyb21KUyIsImNvbmZpZyIsInNlbGVjdGVkSXRlbXMiLCJtZXJnZUluIiwiaXNFZGl0aW5nIiwiaXNDcmVhdGluZyIsImlzQnVzeSIsIlBMQVRGT1JNX0RBVEFHUklEX0JVU1kiLCJQTEFURk9STV9EQVRBR1JJRF9SRUFEWSIsIlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQiLCJhbGxEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfU09SVF9DSEFOR0UiLCJzb3J0Q29sdW1uIiwic29ydE9yZGVyIiwiUExBVEZPUk1fREFUQUdSSURfUkVTSVpFX0NPTFVNTiIsImNvbHVtbldpZHRocyIsIlBMQVRGT1JNX0RBVEFHUklEX0VESVQiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEUiLCJjb2x1bW5EZWZhdWx0VmFsdWVzIiwiUExBVEZPUk1fREFUQUdSSURfQUREX05FV19JVEVNIiwidXBkYXRlSW4iLCJpdGVtcyIsInB1c2giLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTSIsIml0ZW1JZCIsImdldEluIiwiaW5kZXgiLCJpZEtleVBhdGgiLCJhbGxEYXRhSW5kZXgiLCJmaW5kSW5kZXgiLCJpdGVtIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNIiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUyIsImZpbHRlciIsInZhbCIsImlkeCIsImluZGV4ZXMiLCJpbmRleE9mIiwiUExBVEZPUk1fREFUQUdSSURfQ0FOQ0VMIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRSIsIlBMQVRGT1JNX0RBVEFHUklEX0VYVEVORF9EQVRBIiwiZXh0ZW5kZWREYXRhIiwiY29uY2F0IiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9TVUNDRVNTIiwic2F2ZWRJdGVtcyIsImZvckVhY2giLCJzYXZlZEl0ZW1KUyIsInNhdmVkSXRlbSIsImZvdW5kSW5kZXgiLCJkIiwibWVyZ2VEZWVwSW4iLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX1BBUlRJQUxfU1VDQ0VTUyIsImNyZWF0ZURhdGEiLCJlZGl0RGF0YSIsImdldCIsInVuZGVmaW5lZCIsImRlbGV0ZSIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfRkFJTCIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9TVUNDRVNTIiwiZmlsdGVyTm90IiwicmVtb3ZlZElkcyIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9GQUlMIiwiUExBVEZPUk1fREFUQUdSSURfRURJVF9DRUxMX1ZBTFVFX0NIQU5HRSIsImRhdGFJZCIsImtleVBhdGgiLCJ2YWx1ZSIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRSIsInJvd0luZGV4IiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0UiLCJtZXNzYWdlVHlwZSIsIm1lc3NhZ2VJZCIsInZhbHVlcyIsIm1lc3NhZ2VWYWx1ZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NIT1dfTUVTU0FHRVMiLCJtZXNzYWdlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfSElERV9NRVNTQUdFIiwicm93TWVzc2FnZSIsInNpemUiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9TSE9XX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9ISURFX01FU1NBR0UiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX1NFTEVDVElPTl9DSEFOR0UiLCJzZWxlY3RlZENlbGwiLCJQTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0UiLCJuZXdTdGF0ZSIsInNoaWZ0UHJlc3NlZCIsImxhc3RSb3dJbmRleCIsInNlbGVjdFJvd0lkcyIsImkiLCJjdHJsUHJlc3NlZCIsIlBMQVRGT1JNX0RBVEFHUklEX1NFTEVDVF9BTExfSVRFTVNfQ0hBTkdFIiwibWFwIiwiUExBVEZPUk1fREFUQUdSSURfQ0xFQVJfU0VMRUNURURfSVRFTVMiLCJQTEFURk9STV9EQVRBR1JJRF9UT0dHTEVfRklMVEVSSU5HIiwiaXNGaWx0ZXJpbmciLCJQTEFURk9STV9EQVRBR1JJRF9GSUxURVJfREFUQV9DSEFOR0UiLCJmaWx0ZXJEYXRhIiwiUExBVEZPUk1fREFUQUdSSURfQVBQTFlfRklMVEVSUyIsIlBMQVRGT1JNX0RBVEFHUklEX1NFVF9GSUxURVJTIiwiZmlsdGVyaW5nRGF0YSIsIlBMQVRGT1JNX0RBVEFHUklEX1VQREFURV9FWElTVElOR19DRUxMX1ZBTFVFIiwiaGFzSW4iLCJQTEFURk9STV9EQVRBR1JJRF9TRVRfRURJVF9EQVRBIiwiY2VsbE1lc3NhZ2VzIiwiUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX09QRU4iLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfQ0xPU0UiLCJQTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRSIsImNvbHVtbk9yZGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxTQUFQLElBQW9CQyxHQUFwQixFQUF5QkMsSUFBekIsUUFBcUMsV0FBckM7QUFDQSxTQUFTQyxLQUFULFFBQXNCLG9CQUF0QjtBQUNBLFNBQVNDLGFBQVQsUUFBOEIsc0JBQTlCOztBQUVBLGVBQWUsU0FBU0MsZUFBVCxHQUF3RDtBQUFBLE1BQS9CQyxLQUErQix1RUFBdkJGLGFBQXVCO0FBQUEsTUFBUkcsTUFBUTs7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b3J0IEltbXV0YWJsZSwgeyBNYXAsIExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuL2RhdGFncmlkLmFjdGlvbnMnO1xuaW1wb3J0IHsgSU5JVElBTF9TVEFURSB9IGZyb20gJy4vZGF0YWdyaWQuY29uc3RhbnRzJztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZGF0YWdyaWRSZWR1Y2VyKHN0YXRlID0gSU5JVElBTF9TVEFURSwgYWN0aW9uKSB7XG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0lOVkFMSURBVEU6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0ZPUkNFX1JFRlJFU0g6XG4gICAgICAvLyBubyBuZWVkIHRvIGFsdGVyIHJlZHV4IHN0YXRlIG9uIGZvcmNlIHJlZmVzaFxuICAgICAgcmV0dXJuIHN0YXRlO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TRVRfREFUQTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhY3Rpb24uZGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29uZmlnKSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLnNlbGVjdGVkSXRlbXMpKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0J1c3k6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQlVTWTpcbiAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgdHJ1ZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFQURZOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQ6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFjdGlvbi5kYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWN0aW9uLmFsbERhdGEpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TT1JUX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdzb3J0aW5nRGF0YSddLCBNYXAoe1xuICAgICAgICAgIHNvcnRDb2x1bW46IGFjdGlvbi5zb3J0Q29sdW1uLFxuICAgICAgICAgIHNvcnRPcmRlcjogYWN0aW9uLnNvcnRPcmRlcixcbiAgICAgICAgfSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnY29sdW1uV2lkdGhzJ10sIGFjdGlvbi5jb2x1bW5XaWR0aHMpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KFtJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKV0pKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCB7XG4gICAgICAgICAgaXNDcmVhdGluZzogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FERF9ORVdfSVRFTTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAudXBkYXRlSW4oW1xuICAgICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgICAnY3JlYXRlRGF0YScsXG4gICAgICAgIF0sIExpc3QoKSwgaXRlbXMgPT4gaXRlbXMucHVzaChJbW11dGFibGUuZnJvbUpTKGFjdGlvbi5jb2x1bW5EZWZhdWx0VmFsdWVzKSkpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfSVRFTToge1xuICAgICAgY29uc3QgaXRlbUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uaW5kZXgsIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgIGNvbnN0IGFsbERhdGFJbmRleCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIExpc3QoKSlcbiAgICAgICAgLmZpbmRJbmRleChpdGVtID0+IChpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpID09PSBpdGVtSWQpKTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uaW5kZXhdKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnLCBhbGxEYXRhSW5kZXhdKVxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJywgaXRlbUlkXSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU06XG4gICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnLCBhY3Rpb24uaW5kZXhdKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUzpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSxcbiAgICAgICAgICBzdGF0ZVxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10sIExpc3QoKSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHZhbCwgaWR4KSA9PiBhY3Rpb24uaW5kZXhlcy5pbmRleE9mKGlkeCkgPT09IC0xKSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0FOQ0VMOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIE1hcCh7XG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcbiAgICAgICAgfSkpXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRVhURU5EX0RBVEE6IHtcbiAgICAgIGNvbnN0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcbiAgICAgIGNvbnN0IGV4dGVuZGVkRGF0YSA9IGFsbERhdGEuY29uY2F0KGFjdGlvbi5kYXRhKTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgZXh0ZW5kZWREYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgZXh0ZW5kZWREYXRhKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfU1VDQ0VTUzoge1xuICAgICAgbGV0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcbiAgICAgIGFjdGlvbi5zYXZlZEl0ZW1zLmZvckVhY2goKHNhdmVkSXRlbUpTKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkSXRlbSA9IEltbXV0YWJsZS5mcm9tSlMoc2F2ZWRJdGVtSlMpO1xuICAgICAgICBjb25zdCBmb3VuZEluZGV4ID0gYWxsRGF0YS5maW5kSW5kZXgoZCA9PiAoXG4gICAgICAgICAgZC5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSA9PT0gc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpXG4gICAgICAgICkpO1xuICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5wdXNoKHNhdmVkSXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEubWVyZ2VEZWVwSW4oW2ZvdW5kSW5kZXhdLCBzYXZlZEl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWxsRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcbiAgICAgICAgICBpc0J1c3k6IGZhbHNlLFxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXG4gICAgICAgICAgaXNDcmVhdGluZzogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9QQVJUSUFMX1NVQ0NFU1M6IHtcbiAgICAgIGxldCBhbGxEYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSk7XG4gICAgICBsZXQgY3JlYXRlRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pO1xuICAgICAgbGV0IGVkaXREYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pO1xuICAgICAgY29uc3QgaXNDcmVhdGluZyA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQ3JlYXRpbmcnXSk7XG4gICAgICBhY3Rpb24uc2F2ZWRJdGVtcy5mb3JFYWNoKChzYXZlZEl0ZW1KUykgPT4ge1xuICAgICAgICBjb25zdCBzYXZlZEl0ZW0gPSBJbW11dGFibGUuZnJvbUpTKHNhdmVkSXRlbUpTKTtcbiAgICAgICAgbGV0IGZvdW5kSW5kZXggPSBhbGxEYXRhLmZpbmRJbmRleChkID0+IChcbiAgICAgICAgICBkLmdldEluKGFjdGlvbi5pZEtleVBhdGgpID09PSBzYXZlZEl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aClcbiAgICAgICAgKSk7XG4gICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLnB1c2goc2F2ZWRJdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5tZXJnZURlZXBJbihbZm91bmRJbmRleF0sIHNhdmVkSXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQ3JlYXRpbmcpIHtcbiAgICAgICAgICBmb3VuZEluZGV4ID0gc2F2ZWRJdGVtLmdldCgncm93SW5kZXgnKTtcbiAgICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gdW5kZWZpbmVkICYmIGZvdW5kSW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNyZWF0ZURhdGEgPSBjcmVhdGVEYXRhLmRlbGV0ZShmb3VuZEluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWRpdERhdGEgPSBlZGl0RGF0YS5kZWxldGUoc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFsbERhdGEpXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddLCBhbGxEYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgY3JlYXRlRGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdlZGl0RGF0YSddLCBlZGl0RGF0YSlcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9TQVZFX0ZBSUw6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFOlxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX1NVQ0NFU1M6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSlcbiAgICAgICAgLnVwZGF0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10sIGRhdGEgPT4gZGF0YS5maWx0ZXJOb3QoaXRlbSA9PiAoXG4gICAgICAgICAgYWN0aW9uLnJlbW92ZWRJZHMuaW5kZXhPZihpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSA+IC0xXG4gICAgICAgICkpKVxuICAgICAgICAudXBkYXRlSW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgZGF0YSA9PiBkYXRhLmZpbHRlck5vdChpdGVtID0+IChcbiAgICAgICAgICBhY3Rpb24ucmVtb3ZlZElkcy5pbmRleE9mKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpID4gLTFcbiAgICAgICAgKSkpXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX0ZBSUw6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRURJVF9DRUxMX1ZBTFVFX0NIQU5HRTpcbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2VkaXREYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfVkFMVUVfQ0hBTkdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YScsIGFjdGlvbi5yb3dJbmRleCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICB7IGlkOiBhY3Rpb24ubWVzc2FnZUlkLCB2YWx1ZXM6IGFjdGlvbi5tZXNzYWdlVmFsdWVzIH0sXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFUzpcbiAgICAgIHJldHVybiBzdGF0ZS5tZXJnZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24ubWVzc2FnZXMpKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9ISURFX01FU1NBR0U6IHtcbiAgICAgIGlmIChhY3Rpb24ubWVzc2FnZVR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XG4gICAgICB9XG4gICAgICBpZiAoYWN0aW9uLmRhdGFJZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZV0pO1xuICAgICAgfVxuICAgICAgbGV0IHJvd01lc3NhZ2UgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkXSk7XG4gICAgICBpZiAocm93TWVzc2FnZSkge1xuICAgICAgICBpZiAoYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByb3dNZXNzYWdlID0gcm93TWVzc2FnZS5kZWxldGVJbihhY3Rpb24ua2V5UGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvd01lc3NhZ2Uuc2l6ZSA9PT0gMCB8fCAhYWN0aW9uLmtleVBhdGgpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24uZGF0YUlkXSxcbiAgICAgICAgICByb3dNZXNzYWdlLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfU0hPV19NRVNTQUdFOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcbiAgICAgICAgICB7IGlkOiBhY3Rpb24ubWVzc2FnZUlkLCB2YWx1ZXM6IGFjdGlvbi5tZXNzYWdlVmFsdWVzIH0sXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX0hJREVfTUVTU0FHRToge1xuICAgICAgaWYgKGFjdGlvbi5tZXNzYWdlVHlwZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY3Rpb24ucm93SW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGVdKTtcbiAgICAgIH1cbiAgICAgIGxldCByb3dNZXNzYWdlID0gc3RhdGUuZ2V0SW4oW1xuICAgICAgICBhY3Rpb24uaWQsXG4gICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxuICAgICAgICBhY3Rpb24ubWVzc2FnZVR5cGUsXG4gICAgICAgIGFjdGlvbi5yb3dJbmRleCxcbiAgICAgIF0pO1xuICAgICAgaWYgKHJvd01lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcm93TWVzc2FnZSA9IHJvd01lc3NhZ2UuZGVsZXRlSW4oYWN0aW9uLmtleVBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyb3dNZXNzYWdlLnNpemUgPT09IDAgfHwgIWFjdGlvbi5rZXlQYXRoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFtcbiAgICAgICAgICAgIGFjdGlvbi5pZCxcbiAgICAgICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxuICAgICAgICAgICAgYWN0aW9uLm1lc3NhZ2VUeXBlLFxuICAgICAgICAgICAgYWN0aW9uLnJvd0luZGV4LFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZS5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXhdLFxuICAgICAgICAgIHJvd01lc3NhZ2UsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX1NFTEVDVElPTl9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddLCBhY3Rpb24uc2VsZWN0ZWRDZWxsKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfSVRFTV9TRUxFQ1RJT05fQ0hBTkdFOiB7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2xhc3RDbGlja2VkUm93SW5kZXgnXSwgYWN0aW9uLnJvd0luZGV4KTtcblxuICAgICAgLy8gSGFuZGxlIGNhc2Ugd2hlcmUgc2hpZnQga2V5IGlzIHByZXNzZWRcbiAgICAgIC8vIFNlbGVjdCBhbGwgcm93cyBmcm9tIGxhc3RDbGlja2VkUm93IHRvIGN1cnJlbnRseSBjbGlja2VkIHJvd1xuICAgICAgaWYgKGFjdGlvbi5zaGlmdFByZXNzZWQpIHtcbiAgICAgICAgY29uc3QgbGFzdFJvd0luZGV4ID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnbGFzdENsaWNrZWRSb3dJbmRleCddLCBmYWxzZSk7XG4gICAgICAgIGlmIChsYXN0Um93SW5kZXggIT09IGZhbHNlKSB7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0Um93SWRzID0gW107XG4gICAgICAgICAgaWYgKGxhc3RSb3dJbmRleCA8IGFjdGlvbi5yb3dJbmRleCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGxhc3RSb3dJbmRleDsgaSA8PSBhY3Rpb24ucm93SW5kZXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgICAgICAgICAgaWYgKGRhdGFJZCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFjdGlvbi5yb3dJbmRleDsgaSA8PSBsYXN0Um93SW5kZXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgICAgICAgICAgaWYgKGRhdGFJZCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICAgIExpc3Qoc2VsZWN0Um93SWRzKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcbiAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBzdGF0ZVxuICAgICAgICAuZ2V0SW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSwgTGlzdCgpKS5pbmRleE9mKGRhdGFJZCk7XG4gICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgaWYgKGFjdGlvbi5jdHJsUHJlc3NlZCkge1xuICAgICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgICAgLnVwZGF0ZUluKFxuICAgICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxuICAgICAgICAgICAgICBMaXN0KCksIGl0ZW1zID0+IGl0ZW1zLnB1c2goZGF0YUlkKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgLnNldEluKFxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICAgIExpc3QoW2RhdGFJZF0pLFxuICAgICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYWN0aW9uLmN0cmxQcmVzc2VkKSB7XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgIC51cGRhdGVJbihcbiAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXG4gICAgICAgICAgICBpdGVtcyA9PiBpdGVtcy5kZWxldGUoZm91bmRJbmRleCksXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFTEVDVF9BTExfSVRFTVNfQ0hBTkdFOlxuICAgICAgaWYgKFxuICAgICAgICBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLCBMaXN0KCkpLnNpemVcbiAgICAgICAgPT09IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSkuc2l6ZVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAuc2V0SW4oXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSxcbiAgICAgICAgICBzdGF0ZVxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSlcbiAgICAgICAgICAgIC5tYXAoaXRlbSA9PiBpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0xFQVJfU0VMRUNURURfSVRFTVM6XG4gICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1RPR0dMRV9GSUxURVJJTkc6IHtcbiAgICAgIGlmICghYWN0aW9uLmlzRmlsdGVyaW5nKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSwgTWFwKHsgaXNGaWx0ZXJpbmc6IGZhbHNlIH0pKVxuICAgICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLCBNYXAoeyBpc0ZpbHRlcmluZzogdHJ1ZSB9KSk7XG4gICAgfVxuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9GSUxURVJfREFUQV9DSEFOR0U6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YScsICdmaWx0ZXJEYXRhJ10sXG4gICAgICAgICAgYWN0aW9uLmZpbHRlckRhdGEsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX0ZJTFRFUlM6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdkYXRhJ10sXG4gICAgICAgICAgYWN0aW9uLmRhdGEsXG4gICAgICAgICk7XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFVF9GSUxURVJTOlxuICAgICAgcmV0dXJuIHN0YXRlXG4gICAgICAgIC5zZXRJbihcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSxcbiAgICAgICAgICBhY3Rpb24uZmlsdGVyaW5nRGF0YSxcbiAgICAgICAgKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVVBEQVRFX0VYSVNUSU5HX0NFTExfVkFMVUU6IHtcbiAgICAgIGNvbnN0IG5ld1N0YXRlID0gc3RhdGVcbiAgICAgICAgLnNldEluKFxuICAgICAgICAgIFthY3Rpb24uaWQsICdhbGxEYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcbiAgICAgICAgKTtcbiAgICAgIGlmIChzdGF0ZS5oYXNJbihbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSkpIHtcbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlXG4gICAgICAgICAgLnNldEluKFxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXG4gICAgICAgICAgICBhY3Rpb24udmFsdWUsXG4gICAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICB9XG5cbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFVF9FRElUX0RBVEE6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10sIGFjdGlvbi5kYXRhKVxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddLCBhY3Rpb24uY2VsbE1lc3NhZ2VzKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX09QRU46XG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnY29sdW1uU2V0dGluZ3NNb2RhbCcsICdvcGVuJ10sIHRydWUpO1xuXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfQ0xPU0U6XG4gICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnY29sdW1uU2V0dGluZ3NNb2RhbCddKTtcblxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX1NBVkU6XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAndmlzaWJsZUNvbHVtbnMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29sdW1uT3JkZXIpKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn1cbiJdfQ==