import Immutable, { Map, List } from 'immutable';
import { TYPES } from './datagrid.actions';
import { INITIAL_STATE } from './datagrid.constants';

export default function datagridReducer() {
  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INITIAL_STATE;
  var action = arguments[1];

  switch (action.type) {
    case TYPES.PLATFORM_DATAGRID_INVALIDATE:
      return state.deleteIn([action.id, 'data']).deleteIn([action.id, 'allData']).deleteIn([action.id, 'session']).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_SET_DATA:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.data).setIn([action.id, 'config'], Immutable.fromJS(action.config)).setIn([action.id, 'selectedItems'], Immutable.fromJS(action.selectedItems)).mergeIn([action.id, 'session'], {
        isEditing: false,
        isCreating: false,
        isBusy: false
      }).deleteIn([action.id, 'selectedCell']).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages']).deleteIn([action.id, 'cellMessages']);

    case TYPES.PLATFORM_DATAGRID_BUSY:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_READY:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_APPLY_SORT:
      return state.setIn([action.id, 'data'], action.data).setIn([action.id, 'allData'], action.allData);

    case TYPES.PLATFORM_DATAGRID_SORT_CHANGE:
      return state.setIn([action.id, 'config', 'sortingData'], Map({
        sortColumn: action.sortColumn,
        sortOrder: action.sortOrder
      }));

    case TYPES.PLATFORM_DATAGRID_RESIZE_COLUMN:
      return state.setIn([action.id, 'config', 'columnWidths'], action.columnWidths);

    case TYPES.PLATFORM_DATAGRID_EDIT:
      return state.setIn([action.id, 'session', 'isEditing'], true);

    case TYPES.PLATFORM_DATAGRID_CREATE:
      return state.setIn([action.id, 'createData'], List([Immutable.fromJS(action.columnDefaultValues)])).deleteIn([action.id, 'selectedCell']).mergeIn([action.id, 'session'], {
        isCreating: true
      });

    case TYPES.PLATFORM_DATAGRID_ADD_NEW_ITEM:
      return state.updateIn([action.id, 'createData'], List(), function (items) {
        return items.push(Immutable.fromJS(action.columnDefaultValues));
      });

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEM:
      return state.deleteIn([action.id, 'createData', action.index]);

    case TYPES.PLATFORM_DATAGRID_REMOVE_NEW_ITEMS:
      return state.setIn([action.id, 'createData'], state.getIn([action.id, 'createData'], List()).filter(function (val, idx) {
        return action.indexes.indexOf(idx) === -1;
      }));

    case TYPES.PLATFORM_DATAGRID_CANCEL:
      return state.mergeIn([action.id, 'session'], Map({
        isEditing: false,
        isCreating: false
      })).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);

    case TYPES.PLATFORM_DATAGRID_SAVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_SAVE_SUCCESS:
      {
        var allData = state.getIn([action.id, 'allData']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            allData = allData.push(savedItem);
          } else {
            allData = allData.mergeDeepIn([foundIndex], savedItem);
          }
        });
        return state.setIn([action.id, 'data'], allData).setIn([action.id, 'allData'], allData).mergeIn([action.id, 'session'], {
          isBusy: false,
          isEditing: false,
          isCreating: false
        }).deleteIn([action.id, 'editData']).deleteIn([action.id, 'createData']).deleteIn([action.id, 'createCellMessages', 'error']).deleteIn([action.id, 'cellMessages', 'error']);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_PARTIAL_SUCCESS:
      {
        var _allData = state.getIn([action.id, 'allData']);
        var createData = state.getIn([action.id, 'createData']);
        var editData = state.getIn([action.id, 'editData']);
        var isCreating = state.getIn([action.id, 'session', 'isCreating']);
        action.savedItems.forEach(function (savedItemJS) {
          var savedItem = Immutable.fromJS(savedItemJS);
          var foundIndex = _allData.findIndex(function (d) {
            return d.getIn(action.idKeyPath) === savedItem.getIn(action.idKeyPath);
          });
          if (foundIndex === -1) {
            _allData = _allData.push(savedItem);
          } else {
            _allData = _allData.mergeDeepIn([foundIndex], savedItem);
          }
          if (isCreating) {
            foundIndex = savedItem.get('rowIndex');
            if (foundIndex !== undefined && foundIndex !== null) {
              createData = createData.delete(foundIndex);
            }
          } else {
            editData = editData.delete(savedItem.getIn(action.idKeyPath));
          }
        });
        return state.setIn([action.id, 'data'], _allData).setIn([action.id, 'allData'], _allData).setIn([action.id, 'createData'], createData).setIn([action.id, 'editData'], editData).setIn([action.id, 'session', 'isBusy'], false);
      }

    case TYPES.PLATFORM_DATAGRID_SAVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_REMOVE:
      return state.setIn([action.id, 'session', 'isBusy'], true);

    case TYPES.PLATFORM_DATAGRID_REMOVE_SUCCESS:
      return state.setIn([action.id, 'session', 'isBusy'], false).updateIn([action.id, 'data'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).updateIn([action.id, 'allData'], function (data) {
        return data.filterNot(function (item) {
          return action.removedIds.indexOf(item.getIn(action.idKeyPath)) > -1;
        });
      }).deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_REMOVE_FAIL:
      return state.setIn([action.id, 'session', 'isBusy'], false);

    case TYPES.PLATFORM_DATAGRID_EDIT_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'editData', action.dataId].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_VALUE_CHANGE:
      return state.setIn([action.id, 'createData', action.rowIndex].concat(action.keyPath), action.value);

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CELL_SHOW_MESSAGES:
      return state.mergeIn([action.id, 'cellMessages'], Immutable.fromJS(action.messages));

    case TYPES.PLATFORM_DATAGRID_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'cellMessages']);
        }
        if (action.dataId === null) {
          return state.deleteIn([action.id, 'cellMessages', action.messageType]);
        }
        var rowMessage = state.getIn([action.id, 'cellMessages', action.messageType, action.dataId]);
        if (rowMessage) {
          if (action.keyPath) {
            rowMessage = rowMessage.deleteIn(action.keyPath);
          }
          if (rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'cellMessages', action.messageType, action.dataId]);
          }
          return state.setIn([action.id, 'cellMessages', action.messageType, action.dataId], rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_SHOW_MESSAGE:
      return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex].concat(action.keyPath), { id: action.messageId, values: action.messageValues });

    case TYPES.PLATFORM_DATAGRID_CREATE_CELL_HIDE_MESSAGE:
      {
        if (action.messageType === null) {
          return state.deleteIn([action.id, 'createCellMessages']);
        }
        if (action.rowIndex === null) {
          return state.deleteIn([action.id, 'createCellMessages', action.messageType]);
        }
        var _rowMessage = state.getIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
        if (_rowMessage) {
          if (action.keyPath) {
            _rowMessage = _rowMessage.deleteIn(action.keyPath);
          }
          if (_rowMessage.size === 0 || !action.keyPath) {
            return state.deleteIn([action.id, 'createCellMessages', action.messageType, action.rowIndex]);
          }
          return state.setIn([action.id, 'createCellMessages', action.messageType, action.rowIndex], _rowMessage);
        }
        return state;
      }

    case TYPES.PLATFORM_DATAGRID_CELL_SELECTION_CHANGE:
      return state.setIn([action.id, 'selectedCell'], action.selectedCell);

    case TYPES.PLATFORM_DATAGRID_ITEM_SELECTION_CHANGE:
      {
        var newState = state.setIn([action.id, 'session', 'lastClickedRowIndex'], action.rowIndex);

        // Handle case where shift key is pressed
        // Select all rows from lastClickedRow to currently clicked row
        if (action.shiftPressed) {
          var lastRowIndex = state.getIn([action.id, 'session', 'lastClickedRowIndex'], false);
          if (lastRowIndex !== false) {
            var selectRowIds = [];
            if (lastRowIndex < action.rowIndex) {
              for (var i = lastRowIndex; i <= action.rowIndex; i += 1) {
                var _dataId = state.getIn([action.id, 'data', i].concat(action.idKeyPath));
                if (_dataId) {
                  selectRowIds.push(_dataId);
                }
              }
            } else {
              for (var _i = action.rowIndex; _i <= lastRowIndex; _i += 1) {
                var _dataId2 = state.getIn([action.id, 'data', _i].concat(action.idKeyPath));
                if (_dataId2) {
                  selectRowIds.push(_dataId2);
                }
              }
            }
            return newState.setIn([action.id, 'selectedItems'], List(selectRowIds));
          }
        }

        var dataId = state.getIn([action.id, 'data', action.rowIndex].concat(action.idKeyPath));
        var foundIndex = state.getIn([action.id, 'selectedItems'], List()).indexOf(dataId);
        if (foundIndex === -1) {
          if (action.ctrlPressed) {
            return newState.updateIn([action.id, 'selectedItems'], List(), function (items) {
              return items.push(dataId);
            });
          }
          return newState.setIn([action.id, 'selectedItems'], List([dataId]));
        }
        if (action.ctrlPressed) {
          return newState.updateIn([action.id, 'selectedItems'], function (items) {
            return items.delete(foundIndex);
          });
        }
        return newState.setIn([action.id, 'selectedItems'], List([dataId]));
      }

    case TYPES.PLATFORM_DATAGRID_SELECT_ALL_ITEMS_CHANGE:
      if (state.getIn([action.id, 'selectedItems'], List()).size === state.getIn([action.id, 'data'], List()).size) {
        return state.deleteIn([action.id, 'selectedItems']);
      }
      return state.setIn([action.id, 'selectedItems'], state.getIn([action.id, 'data'], List()).map(function (item) {
        return item.getIn(action.idKeyPath);
      }));

    case TYPES.PLATFORM_DATAGRID_CLEAR_SELECTED_ITEMS:
      return state.deleteIn([action.id, 'selectedItems']);

    case TYPES.PLATFORM_DATAGRID_TOGGLE_FILTERING:
      {
        if (!action.isFiltering) {
          return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: false })).setIn([action.id, 'data'], state.getIn([action.id, 'allData']));
        }
        return state.setIn([action.id, 'config', 'filteringData'], Map({ isFiltering: true }));
      }

    case TYPES.PLATFORM_DATAGRID_FILTER_DATA_CHANGE:
      return state.setIn([action.id, 'config', 'filteringData', 'filterData'], action.filterData);

    case TYPES.PLATFORM_DATAGRID_APPLY_FILTERS:
      return state.setIn([action.id, 'data'], action.data);

    case TYPES.PLATFORM_DATAGRID_UPDATE_EXISTING_CELL_VALUE:
      {
        var _newState = state.setIn([action.id, 'allData', action.dataId].concat(action.keyPath), action.value);
        if (state.hasIn([action.id, 'data', action.dataId].concat(action.keyPath))) {
          return _newState.setIn([action.id, 'data', action.dataId].concat(action.keyPath), action.value);
        }
        return _newState;
      }

    case TYPES.PLATFORM_DATAGRID_SET_EDIT_DATA:
      return state.setIn([action.id, 'session', 'isEditing'], true).setIn([action.id, 'editData'], action.data).setIn([action.id, 'cellMessages'], action.cellMessages);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_OPEN:
      return state.setIn([action.id, 'session', 'columnSettingsModal', 'open'], true);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_MODAL_CLOSE:
      return state.deleteIn([action.id, 'session', 'columnSettingsModal']);

    case TYPES.PLATFORM_DATAGRID_COLUMN_SETTINGS_SAVE:
      return state.setIn([action.id, 'config', 'visibleColumns'], Immutable.fromJS(action.columnOrder));

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYXRhZ3JpZC9kYXRhZ3JpZC5yZWR1Y2VyLmpzIl0sIm5hbWVzIjpbIkltbXV0YWJsZSIsIk1hcCIsIkxpc3QiLCJUWVBFUyIsIklOSVRJQUxfU1RBVEUiLCJkYXRhZ3JpZFJlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInR5cGUiLCJQTEFURk9STV9EQVRBR1JJRF9JTlZBTElEQVRFIiwiZGVsZXRlSW4iLCJpZCIsIlBMQVRGT1JNX0RBVEFHUklEX1NFVF9EQVRBIiwic2V0SW4iLCJkYXRhIiwiZnJvbUpTIiwiY29uZmlnIiwic2VsZWN0ZWRJdGVtcyIsIm1lcmdlSW4iLCJpc0VkaXRpbmciLCJpc0NyZWF0aW5nIiwiaXNCdXN5IiwiUExBVEZPUk1fREFUQUdSSURfQlVTWSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFQURZIiwiUExBVEZPUk1fREFUQUdSSURfQVBQTFlfU09SVCIsImFsbERhdGEiLCJQTEFURk9STV9EQVRBR1JJRF9TT1JUX0NIQU5HRSIsInNvcnRDb2x1bW4iLCJzb3J0T3JkZXIiLCJQTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OIiwiY29sdW1uV2lkdGhzIiwiUExBVEZPUk1fREFUQUdSSURfRURJVCIsIlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURSIsImNvbHVtbkRlZmF1bHRWYWx1ZXMiLCJQTEFURk9STV9EQVRBR1JJRF9BRERfTkVXX0lURU0iLCJ1cGRhdGVJbiIsIml0ZW1zIiwicHVzaCIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9ORVdfSVRFTSIsImluZGV4IiwiUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUyIsImdldEluIiwiZmlsdGVyIiwidmFsIiwiaWR4IiwiaW5kZXhlcyIsImluZGV4T2YiLCJQTEFURk9STV9EQVRBR1JJRF9DQU5DRUwiLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFIiwiUExBVEZPUk1fREFUQUdSSURfU0FWRV9TVUNDRVNTIiwic2F2ZWRJdGVtcyIsImZvckVhY2giLCJzYXZlZEl0ZW1KUyIsInNhdmVkSXRlbSIsImZvdW5kSW5kZXgiLCJmaW5kSW5kZXgiLCJkIiwiaWRLZXlQYXRoIiwibWVyZ2VEZWVwSW4iLCJQTEFURk9STV9EQVRBR1JJRF9TQVZFX1BBUlRJQUxfU1VDQ0VTUyIsImNyZWF0ZURhdGEiLCJlZGl0RGF0YSIsImdldCIsInVuZGVmaW5lZCIsImRlbGV0ZSIsIlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfRkFJTCIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRSIsIlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9TVUNDRVNTIiwiZmlsdGVyTm90IiwicmVtb3ZlZElkcyIsIml0ZW0iLCJQTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfRkFJTCIsIlBMQVRGT1JNX0RBVEFHUklEX0VESVRfQ0VMTF9WQUxVRV9DSEFOR0UiLCJkYXRhSWQiLCJrZXlQYXRoIiwidmFsdWUiLCJQTEFURk9STV9EQVRBR1JJRF9DUkVBVEVfQ0VMTF9WQUxVRV9DSEFOR0UiLCJyb3dJbmRleCIsIlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0hPV19NRVNTQUdFIiwibWVzc2FnZVR5cGUiLCJtZXNzYWdlSWQiLCJ2YWx1ZXMiLCJtZXNzYWdlVmFsdWVzIiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0VTIiwibWVzc2FnZXMiLCJQTEFURk9STV9EQVRBR1JJRF9DRUxMX0hJREVfTUVTU0FHRSIsInJvd01lc3NhZ2UiLCJzaXplIiwiUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfU0hPV19NRVNTQUdFIiwiUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfSElERV9NRVNTQUdFIiwiUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TRUxFQ1RJT05fQ0hBTkdFIiwic2VsZWN0ZWRDZWxsIiwiUExBVEZPUk1fREFUQUdSSURfSVRFTV9TRUxFQ1RJT05fQ0hBTkdFIiwibmV3U3RhdGUiLCJzaGlmdFByZXNzZWQiLCJsYXN0Um93SW5kZXgiLCJzZWxlY3RSb3dJZHMiLCJpIiwiY3RybFByZXNzZWQiLCJQTEFURk9STV9EQVRBR1JJRF9TRUxFQ1RfQUxMX0lURU1TX0NIQU5HRSIsIm1hcCIsIlBMQVRGT1JNX0RBVEFHUklEX0NMRUFSX1NFTEVDVEVEX0lURU1TIiwiUExBVEZPUk1fREFUQUdSSURfVE9HR0xFX0ZJTFRFUklORyIsImlzRmlsdGVyaW5nIiwiUExBVEZPUk1fREFUQUdSSURfRklMVEVSX0RBVEFfQ0hBTkdFIiwiZmlsdGVyRGF0YSIsIlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX0ZJTFRFUlMiLCJQTEFURk9STV9EQVRBR1JJRF9VUERBVEVfRVhJU1RJTkdfQ0VMTF9WQUxVRSIsImhhc0luIiwiUExBVEZPUk1fREFUQUdSSURfU0VUX0VESVRfREFUQSIsImNlbGxNZXNzYWdlcyIsIlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9PUEVOIiwiUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX01PREFMX0NMT1NFIiwiUExBVEZPUk1fREFUQUdSSURfQ09MVU1OX1NFVFRJTkdTX1NBVkUiLCJjb2x1bW5PcmRlciJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsU0FBUCxJQUFvQkMsR0FBcEIsRUFBeUJDLElBQXpCLFFBQXFDLFdBQXJDO0FBQ0EsU0FBU0MsS0FBVCxRQUFzQixvQkFBdEI7QUFDQSxTQUFTQyxhQUFULFFBQThCLHNCQUE5Qjs7QUFFQSxlQUFlLFNBQVNDLGVBQVQsR0FBd0Q7QUFBQSxNQUEvQkMsS0FBK0IsdUVBQXZCRixhQUF1QjtBQUFBLE1BQVJHLE1BQVE7O0FBQ3JFLFVBQVFBLE9BQU9DLElBQWY7QUFDRSxTQUFLTCxNQUFNTSw0QkFBWDtBQUNFLGFBQU9ILE1BQ0pJLFFBREksQ0FDSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksTUFBWixDQURMLEVBRUpELFFBRkksQ0FFSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksU0FBWixDQUZMLEVBR0pELFFBSEksQ0FHSyxDQUFDSCxPQUFPSSxFQUFSLEVBQVksU0FB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QUNOLE9BQU9JLEVBQVIsRUFBWSxVQUFaLENBRkYsRUFFMkJKLE9BQU9PLElBRmxDLEVBR0pELEtBSEksQ0FHRSxDQUFDTixPQUFPSSxFQUFSLEVBQVksY0FBWixDQUhGLEVBRytCSixPQUFPdUcsWUFIdEMsQ0FBUDs7QUFLRixTQUFLM0csTUFBTTRHLDRDQUFYO0FBQ0UsYUFBT3pHLE1BQU1PLEtBQU4sQ0FBWSxDQUFDTixPQUFPSSxFQUFSLEVBQVksU0FBWixFQUF1QixxQkFBdkIsRUFBOEMsTUFBOUMsQ0FBWixFQUFtRSxJQUFuRSxDQUFQOztBQUVGLFNBQUtSLE1BQU02Ryw2Q0FBWDtBQUNFLGFBQU8xRyxNQUFNSSxRQUFOLENBQWUsQ0FBQ0gsT0FBT0ksRUFBUixFQUFZLFNBQVosRUFBdUIscUJBQXZCLENBQWYsQ0FBUDs7QUFFRixTQUFLUixNQUFNOEcsc0NBQVg7QUFDRSxhQUFPM0csTUFDSk8sS0FESSxDQUNFLENBQUNOLE9BQU9JLEVBQVIsRUFBWSxRQUFaLEVBQXNCLGdCQUF0QixDQURGLEVBQzJDWCxVQUFVZSxNQUFWLENBQWlCUixPQUFPMkcsV0FBeEIsQ0FEM0MsQ0FBUDs7QUFHRjtBQUNFLGFBQU81RyxLQUFQO0FBalpKO0FBbVpEIiwiZmlsZSI6ImRhdGFncmlkLnJlZHVjZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSW1tdXRhYmxlLCB7IE1hcCwgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XHJcbmltcG9ydCB7IFRZUEVTIH0gZnJvbSAnLi9kYXRhZ3JpZC5hY3Rpb25zJztcclxuaW1wb3J0IHsgSU5JVElBTF9TVEFURSB9IGZyb20gJy4vZGF0YWdyaWQuY29uc3RhbnRzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGRhdGFncmlkUmVkdWNlcihzdGF0ZSA9IElOSVRJQUxfU1RBVEUsIGFjdGlvbikge1xyXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfSU5WQUxJREFURTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdkYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVEYXRhJ10pXHJcbiAgICAgICAgLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcyddKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NFVF9EQVRBOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWN0aW9uLmRhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFjdGlvbi5kYXRhKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbmZpZykpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLnNlbGVjdGVkSXRlbXMpKVxyXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcclxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGlzQnVzeTogZmFsc2UsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQlVTWTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFQURZOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX1NPUlQ6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBhY3Rpb24uZGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWN0aW9uLmFsbERhdGEpO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU09SVF9DSEFOR0U6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ3NvcnRpbmdEYXRhJ10sIE1hcCh7XHJcbiAgICAgICAgICBzb3J0Q29sdW1uOiBhY3Rpb24uc29ydENvbHVtbixcclxuICAgICAgICAgIHNvcnRPcmRlcjogYWN0aW9uLnNvcnRPcmRlcixcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRVNJWkVfQ09MVU1OOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ2NvbmZpZycsICdjb2x1bW5XaWR0aHMnXSwgYWN0aW9uLmNvbHVtbldpZHRocyk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNFZGl0aW5nJ10sIHRydWUpO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgTGlzdChbSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29sdW1uRGVmYXVsdFZhbHVlcyldKSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkQ2VsbCddKVxyXG4gICAgICAgIC5tZXJnZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJ10sIHtcclxuICAgICAgICAgIGlzQ3JlYXRpbmc6IHRydWUsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9BRERfTkVXX0lURU06XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC51cGRhdGVJbihbXHJcbiAgICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgICAnY3JlYXRlRGF0YScsXHJcbiAgICAgICAgXSwgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLmNvbHVtbkRlZmF1bHRWYWx1ZXMpKSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfTkVXX0lURU06XHJcbiAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YScsIGFjdGlvbi5pbmRleF0pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfUkVNT1ZFX05FV19JVEVNUzpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSxcclxuICAgICAgICAgIHN0YXRlXHJcbiAgICAgICAgICAgIC5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddLCBMaXN0KCkpXHJcbiAgICAgICAgICAgIC5maWx0ZXIoKHZhbCwgaWR4KSA9PiBhY3Rpb24uaW5kZXhlcy5pbmRleE9mKGlkeCkgPT09IC0xKSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0FOQ0VMOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAubWVyZ2VJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbiddLCBNYXAoe1xyXG4gICAgICAgICAgaXNFZGl0aW5nOiBmYWxzZSxcclxuICAgICAgICAgIGlzQ3JlYXRpbmc6IGZhbHNlLFxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1NBVkVfU1VDQ0VTUzoge1xyXG4gICAgICBsZXQgYWxsRGF0YSA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10pO1xyXG4gICAgICBhY3Rpb24uc2F2ZWRJdGVtcy5mb3JFYWNoKChzYXZlZEl0ZW1KUykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNhdmVkSXRlbSA9IEltbXV0YWJsZS5mcm9tSlMoc2F2ZWRJdGVtSlMpO1xyXG4gICAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBhbGxEYXRhLmZpbmRJbmRleChkID0+IChcclxuICAgICAgICAgIGQuZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkgPT09IHNhdmVkSXRlbS5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKVxyXG4gICAgICAgICkpO1xyXG4gICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEucHVzaChzYXZlZEl0ZW0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5tZXJnZURlZXBJbihbZm91bmRJbmRleF0sIHNhdmVkSXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIGFsbERhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGFsbERhdGEpXHJcbiAgICAgICAgLm1lcmdlSW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nXSwge1xyXG4gICAgICAgICAgaXNCdXN5OiBmYWxzZSxcclxuICAgICAgICAgIGlzRWRpdGluZzogZmFsc2UsXHJcbiAgICAgICAgICBpc0NyZWF0aW5nOiBmYWxzZSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsICdlcnJvciddKVxyXG4gICAgICAgIC5kZWxldGVJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJywgJ2Vycm9yJ10pO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9QQVJUSUFMX1NVQ0NFU1M6IHtcclxuICAgICAgbGV0IGFsbERhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnYWxsRGF0YSddKTtcclxuICAgICAgbGV0IGNyZWF0ZURhdGEgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnY3JlYXRlRGF0YSddKTtcclxuICAgICAgbGV0IGVkaXREYXRhID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10pO1xyXG4gICAgICBjb25zdCBpc0NyZWF0aW5nID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNDcmVhdGluZyddKTtcclxuICAgICAgYWN0aW9uLnNhdmVkSXRlbXMuZm9yRWFjaCgoc2F2ZWRJdGVtSlMpID0+IHtcclxuICAgICAgICBjb25zdCBzYXZlZEl0ZW0gPSBJbW11dGFibGUuZnJvbUpTKHNhdmVkSXRlbUpTKTtcclxuICAgICAgICBsZXQgZm91bmRJbmRleCA9IGFsbERhdGEuZmluZEluZGV4KGQgPT4gKFxyXG4gICAgICAgICAgZC5nZXRJbihhY3Rpb24uaWRLZXlQYXRoKSA9PT0gc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpXHJcbiAgICAgICAgKSk7XHJcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICBhbGxEYXRhID0gYWxsRGF0YS5wdXNoKHNhdmVkSXRlbSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLm1lcmdlRGVlcEluKFtmb3VuZEluZGV4XSwgc2F2ZWRJdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzQ3JlYXRpbmcpIHtcclxuICAgICAgICAgIGZvdW5kSW5kZXggPSBzYXZlZEl0ZW0uZ2V0KCdyb3dJbmRleCcpO1xyXG4gICAgICAgICAgaWYgKGZvdW5kSW5kZXggIT09IHVuZGVmaW5lZCAmJiBmb3VuZEluZGV4ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGEgPSBjcmVhdGVEYXRhLmRlbGV0ZShmb3VuZEluZGV4KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZWRpdERhdGEgPSBlZGl0RGF0YS5kZWxldGUoc2F2ZWRJdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgYWxsRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSwgYWxsRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnXSwgY3JlYXRlRGF0YSlcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2VkaXREYXRhJ10sIGVkaXREYXRhKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdpc0J1c3knXSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0FWRV9GQUlMOlxyXG4gICAgICByZXR1cm4gc3RhdGUuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX1JFTU9WRV9TVUNDRVNTOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ3Nlc3Npb24nLCAnaXNCdXN5J10sIGZhbHNlKVxyXG4gICAgICAgIC51cGRhdGVJbihbYWN0aW9uLmlkLCAnZGF0YSddLCBkYXRhID0+IGRhdGEuZmlsdGVyTm90KGl0ZW0gPT4gKFxyXG4gICAgICAgICAgYWN0aW9uLnJlbW92ZWRJZHMuaW5kZXhPZihpdGVtLmdldEluKGFjdGlvbi5pZEtleVBhdGgpKSA+IC0xXHJcbiAgICAgICAgKSkpXHJcbiAgICAgICAgLnVwZGF0ZUluKFthY3Rpb24uaWQsICdhbGxEYXRhJ10sIGRhdGEgPT4gZGF0YS5maWx0ZXJOb3QoaXRlbSA9PiAoXHJcbiAgICAgICAgICBhY3Rpb24ucmVtb3ZlZElkcy5pbmRleE9mKGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpID4gLTFcclxuICAgICAgICApKSlcclxuICAgICAgICAuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ3NlbGVjdGVkSXRlbXMnXSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9SRU1PVkVfRkFJTDpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzQnVzeSddLCBmYWxzZSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9FRElUX0NFTExfVkFMVUVfQ0hBTkdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnZWRpdERhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXHJcbiAgICAgICAgICBhY3Rpb24udmFsdWUsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NSRUFURV9DRUxMX1ZBTFVFX0NIQU5HRTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NyZWF0ZURhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIGFjdGlvbi52YWx1ZSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0U6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ0VMTF9TSE9XX01FU1NBR0VTOlxyXG4gICAgICByZXR1cm4gc3RhdGUubWVyZ2VJbihbYWN0aW9uLmlkLCAnY2VsbE1lc3NhZ2VzJ10sIEltbXV0YWJsZS5mcm9tSlMoYWN0aW9uLm1lc3NhZ2VzKSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DRUxMX0hJREVfTUVTU0FHRToge1xyXG4gICAgICBpZiAoYWN0aW9uLm1lc3NhZ2VUeXBlID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFjdGlvbi5kYXRhSWQgPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZV0pO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCByb3dNZXNzYWdlID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0pO1xyXG4gICAgICBpZiAocm93TWVzc2FnZSkge1xyXG4gICAgICAgIGlmIChhY3Rpb24ua2V5UGF0aCkge1xyXG4gICAgICAgICAgcm93TWVzc2FnZSA9IHJvd01lc3NhZ2UuZGVsZXRlSW4oYWN0aW9uLmtleVBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocm93TWVzc2FnZS5zaXplID09PSAwIHx8ICFhY3Rpb24ua2V5UGF0aCkge1xyXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGUsIGFjdGlvbi5kYXRhSWRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFxyXG4gICAgICAgICAgW2FjdGlvbi5pZCwgJ2NlbGxNZXNzYWdlcycsIGFjdGlvbi5tZXNzYWdlVHlwZSwgYWN0aW9uLmRhdGFJZF0sXHJcbiAgICAgICAgICByb3dNZXNzYWdlLFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfU0hPV19NRVNTQUdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5rZXlQYXRoXSxcclxuICAgICAgICAgIHsgaWQ6IGFjdGlvbi5tZXNzYWdlSWQsIHZhbHVlczogYWN0aW9uLm1lc3NhZ2VWYWx1ZXMgfSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfQ1JFQVRFX0NFTExfSElERV9NRVNTQUdFOiB7XHJcbiAgICAgIGlmIChhY3Rpb24ubWVzc2FnZVR5cGUgPT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW2FjdGlvbi5pZCwgJ2NyZWF0ZUNlbGxNZXNzYWdlcyddKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYWN0aW9uLnJvd0luZGV4ID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdjcmVhdGVDZWxsTWVzc2FnZXMnLCBhY3Rpb24ubWVzc2FnZVR5cGVdKTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgcm93TWVzc2FnZSA9IHN0YXRlLmdldEluKFtcclxuICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgJ2NyZWF0ZUNlbGxNZXNzYWdlcycsXHJcbiAgICAgICAgYWN0aW9uLm1lc3NhZ2VUeXBlLFxyXG4gICAgICAgIGFjdGlvbi5yb3dJbmRleCxcclxuICAgICAgXSk7XHJcbiAgICAgIGlmIChyb3dNZXNzYWdlKSB7XHJcbiAgICAgICAgaWYgKGFjdGlvbi5rZXlQYXRoKSB7XHJcbiAgICAgICAgICByb3dNZXNzYWdlID0gcm93TWVzc2FnZS5kZWxldGVJbihhY3Rpb24ua2V5UGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyb3dNZXNzYWdlLnNpemUgPT09IDAgfHwgIWFjdGlvbi5rZXlQYXRoKSB7XHJcbiAgICAgICAgICByZXR1cm4gc3RhdGUuZGVsZXRlSW4oW1xyXG4gICAgICAgICAgICBhY3Rpb24uaWQsXHJcbiAgICAgICAgICAgICdjcmVhdGVDZWxsTWVzc2FnZXMnLFxyXG4gICAgICAgICAgICBhY3Rpb24ubWVzc2FnZVR5cGUsXHJcbiAgICAgICAgICAgIGFjdGlvbi5yb3dJbmRleCxcclxuICAgICAgICAgIF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RhdGUuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY3JlYXRlQ2VsbE1lc3NhZ2VzJywgYWN0aW9uLm1lc3NhZ2VUeXBlLCBhY3Rpb24ucm93SW5kZXhdLFxyXG4gICAgICAgICAgcm93TWVzc2FnZSxcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NFTExfU0VMRUNUSU9OX0NIQU5HRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZENlbGwnXSwgYWN0aW9uLnNlbGVjdGVkQ2VsbCk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9JVEVNX1NFTEVDVElPTl9DSEFOR0U6IHtcclxuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZS5zZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGFjdGlvbi5yb3dJbmRleCk7XHJcblxyXG4gICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSBzaGlmdCBrZXkgaXMgcHJlc3NlZFxyXG4gICAgICAvLyBTZWxlY3QgYWxsIHJvd3MgZnJvbSBsYXN0Q2xpY2tlZFJvdyB0byBjdXJyZW50bHkgY2xpY2tlZCByb3dcclxuICAgICAgaWYgKGFjdGlvbi5zaGlmdFByZXNzZWQpIHtcclxuICAgICAgICBjb25zdCBsYXN0Um93SW5kZXggPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2Vzc2lvbicsICdsYXN0Q2xpY2tlZFJvd0luZGV4J10sIGZhbHNlKTtcclxuICAgICAgICBpZiAobGFzdFJvd0luZGV4ICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0Um93SWRzID0gW107XHJcbiAgICAgICAgICBpZiAobGFzdFJvd0luZGV4IDwgYWN0aW9uLnJvd0luZGV4KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBsYXN0Um93SW5kZXg7IGkgPD0gYWN0aW9uLnJvd0luZGV4OyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICBjb25zdCBkYXRhSWQgPSBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnZGF0YScsIGksIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcclxuICAgICAgICAgICAgICBpZiAoZGF0YUlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RSb3dJZHMucHVzaChkYXRhSWQpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFjdGlvbi5yb3dJbmRleDsgaSA8PSBsYXN0Um93SW5kZXg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGRhdGFJZCA9IHN0YXRlLmdldEluKFthY3Rpb24uaWQsICdkYXRhJywgaSwgLi4uYWN0aW9uLmlkS2V5UGF0aF0pO1xyXG4gICAgICAgICAgICAgIGlmIChkYXRhSWQpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdFJvd0lkcy5wdXNoKGRhdGFJZCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICAgICAgTGlzdChzZWxlY3RSb3dJZHMpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZGF0YUlkID0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24ucm93SW5kZXgsIC4uLmFjdGlvbi5pZEtleVBhdGhdKTtcclxuICAgICAgY29uc3QgZm91bmRJbmRleCA9IHN0YXRlXHJcbiAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sIExpc3QoKSkuaW5kZXhPZihkYXRhSWQpO1xyXG4gICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcclxuICAgICAgICBpZiAoYWN0aW9uLmN0cmxQcmVzc2VkKSB7XHJcbiAgICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgICAgLnVwZGF0ZUluKFxyXG4gICAgICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICAgICAgTGlzdCgpLCBpdGVtcyA9PiBpdGVtcy5wdXNoKGRhdGFJZCksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgICAgLnNldEluKFxyXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcclxuICAgICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGFjdGlvbi5jdHJsUHJlc3NlZCkge1xyXG4gICAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgICAgLnVwZGF0ZUluKFxyXG4gICAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgICBpdGVtcyA9PiBpdGVtcy5kZWxldGUoZm91bmRJbmRleCksXHJcbiAgICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBuZXdTdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10sXHJcbiAgICAgICAgICBMaXN0KFtkYXRhSWRdKSxcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VMRUNUX0FMTF9JVEVNU19DSEFOR0U6XHJcbiAgICAgIGlmIChcclxuICAgICAgICBzdGF0ZS5nZXRJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLCBMaXN0KCkpLnNpemVcclxuICAgICAgICA9PT0gc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgTGlzdCgpKS5zaXplXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybiBzdGF0ZS5kZWxldGVJbihbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnc2VsZWN0ZWRJdGVtcyddLFxyXG4gICAgICAgICAgc3RhdGVcclxuICAgICAgICAgICAgLmdldEluKFthY3Rpb24uaWQsICdkYXRhJ10sIExpc3QoKSlcclxuICAgICAgICAgICAgLm1hcChpdGVtID0+IGl0ZW0uZ2V0SW4oYWN0aW9uLmlkS2V5UGF0aCkpLFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DTEVBUl9TRUxFQ1RFRF9JVEVNUzpcclxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZWxlY3RlZEl0ZW1zJ10pO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVE9HR0xFX0ZJTFRFUklORzoge1xyXG4gICAgICBpZiAoIWFjdGlvbi5pc0ZpbHRlcmluZykge1xyXG4gICAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAnZmlsdGVyaW5nRGF0YSddLCBNYXAoeyBpc0ZpbHRlcmluZzogZmFsc2UgfSkpXHJcbiAgICAgICAgICAuc2V0SW4oW2FjdGlvbi5pZCwgJ2RhdGEnXSwgc3RhdGUuZ2V0SW4oW2FjdGlvbi5pZCwgJ2FsbERhdGEnXSkpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnXSwgTWFwKHsgaXNGaWx0ZXJpbmc6IHRydWUgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfRklMVEVSX0RBVEFfQ0hBTkdFOlxyXG4gICAgICByZXR1cm4gc3RhdGVcclxuICAgICAgICAuc2V0SW4oXHJcbiAgICAgICAgICBbYWN0aW9uLmlkLCAnY29uZmlnJywgJ2ZpbHRlcmluZ0RhdGEnLCAnZmlsdGVyRGF0YSddLFxyXG4gICAgICAgICAgYWN0aW9uLmZpbHRlckRhdGEsXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0FQUExZX0ZJTFRFUlM6XHJcbiAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdkYXRhJ10sXHJcbiAgICAgICAgICBhY3Rpb24uZGF0YSxcclxuICAgICAgICApO1xyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfVVBEQVRFX0VYSVNUSU5HX0NFTExfVkFMVUU6IHtcclxuICAgICAgY29uc3QgbmV3U3RhdGUgPSBzdGF0ZVxyXG4gICAgICAgIC5zZXRJbihcclxuICAgICAgICAgIFthY3Rpb24uaWQsICdhbGxEYXRhJywgYWN0aW9uLmRhdGFJZCwgLi4uYWN0aW9uLmtleVBhdGhdLFxyXG4gICAgICAgICAgYWN0aW9uLnZhbHVlLFxyXG4gICAgICAgICk7XHJcbiAgICAgIGlmIChzdGF0ZS5oYXNJbihbYWN0aW9uLmlkLCAnZGF0YScsIGFjdGlvbi5kYXRhSWQsIC4uLmFjdGlvbi5rZXlQYXRoXSkpIHtcclxuICAgICAgICByZXR1cm4gbmV3U3RhdGVcclxuICAgICAgICAgIC5zZXRJbihcclxuICAgICAgICAgICAgW2FjdGlvbi5pZCwgJ2RhdGEnLCBhY3Rpb24uZGF0YUlkLCAuLi5hY3Rpb24ua2V5UGF0aF0sXHJcbiAgICAgICAgICAgIGFjdGlvbi52YWx1ZSxcclxuICAgICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ld1N0YXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGNhc2UgVFlQRVMuUExBVEZPUk1fREFUQUdSSURfU0VUX0VESVRfREFUQTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2lzRWRpdGluZyddLCB0cnVlKVxyXG4gICAgICAgIC5zZXRJbihbYWN0aW9uLmlkLCAnZWRpdERhdGEnXSwgYWN0aW9uLmRhdGEpXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjZWxsTWVzc2FnZXMnXSwgYWN0aW9uLmNlbGxNZXNzYWdlcyk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfTU9EQUxfT1BFTjpcclxuICAgICAgcmV0dXJuIHN0YXRlLnNldEluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnLCAnb3BlbiddLCB0cnVlKTtcclxuXHJcbiAgICBjYXNlIFRZUEVTLlBMQVRGT1JNX0RBVEFHUklEX0NPTFVNTl9TRVRUSU5HU19NT0RBTF9DTE9TRTpcclxuICAgICAgcmV0dXJuIHN0YXRlLmRlbGV0ZUluKFthY3Rpb24uaWQsICdzZXNzaW9uJywgJ2NvbHVtblNldHRpbmdzTW9kYWwnXSk7XHJcblxyXG4gICAgY2FzZSBUWVBFUy5QTEFURk9STV9EQVRBR1JJRF9DT0xVTU5fU0VUVElOR1NfU0FWRTpcclxuICAgICAgcmV0dXJuIHN0YXRlXHJcbiAgICAgICAgLnNldEluKFthY3Rpb24uaWQsICdjb25maWcnLCAndmlzaWJsZUNvbHVtbnMnXSwgSW1tdXRhYmxlLmZyb21KUyhhY3Rpb24uY29sdW1uT3JkZXIpKTtcclxuXHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gc3RhdGU7XHJcbiAgfVxyXG59XHJcbiJdfQ==